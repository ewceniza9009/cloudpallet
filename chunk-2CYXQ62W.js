import{a as It}from"./chunk-2POFJV4D.js";import{a as S,b as Lt}from"./chunk-L42SEAWI.js";import{g as xt}from"./chunk-Y4BMI5IS.js";import{c as kt,d as bt,e as wt,f as At,g as St,h as Dt}from"./chunk-WGGDG2GO.js";import{a as Mt,b as Pt,c as Ot}from"./chunk-4MA2X27T.js";import"./chunk-OUNZMEYF.js";import"./chunk-MS4AQ6UA.js";import{d as vt}from"./chunk-LDLFMV26.js";import"./chunk-KMQDKAAG.js";import{b as ut,c as ft}from"./chunk-RFTLLO7Q.js";import{b as ct,f as pt,i as dt,j as gt}from"./chunk-LJJEMR6T.js";import"./chunk-2PH2G5FJ.js";import"./chunk-4467KL4X.js";import"./chunk-3HUEUM62.js";import"./chunk-2G5JFWHB.js";import{b as it,g as nt,h as ot,j as A,n as rt,o as at,r as lt,u as st,w as mt}from"./chunk-AMYPGFIW.js";import"./chunk-KS7NA3UJ.js";import{o as tt,p as et}from"./chunk-2LKGOGN5.js";import{a as ht,b as yt}from"./chunk-NAFMYLXR.js";import{a as w}from"./chunk-2G4RJFBR.js";import{a as _t,i as Ct}from"./chunk-NCMEPRDZ.js";import{G as X,H as Z}from"./chunk-3GOW57GU.js";import{B as K,j as Y,m as q,o as H,t as J}from"./chunk-HYNCXMIA.js";import{$,Aa as u,Ab as V,F,Hc as W,L as T,Lc as P,Mc as b,Nc as Q,Ob as D,Pb as L,Qb as z,Sb as x,Tb as M,Ub as s,Vb as i,Wb as n,Xb as _,_ as y,cc as U,hb as a,hc as C,jc as k,k as E,la as O,nc as B,oc as j,pc as G,qa as f,ra as v,tc as d,ub as N,w as h,xc as o,yc as c,zc as R}from"./chunk-N46UG6V3.js";var Tt=()=>[25,50,100],I=(r,t)=>t.id;function $t(r,t){if(r&1&&(i(0,"mat-option",20),o(1),n()),r&2){let e=t.$implicit;s("value",e),a(),c(e.name)}}function Nt(r,t){if(r&1&&(i(0,"mat-option",20),o(1),n()),r&2){let e=t.$implicit;s("value",e),a(),c(e.name)}}function Vt(r,t){if(r&1&&(i(0,"mat-option",20),o(1),n()),r&2){let e=t.$implicit;s("value",e),a(),c(e.name)}}function zt(r,t){r&1&&(i(0,"div",28),_(1,"mat-progress-spinner",30),i(2,"p"),o(3,"Loading Activity..."),n()())}function Ut(r,t){r&1&&(i(0,"div",31)(1,"mat-icon"),o(2,"search_off"),n(),i(3,"h2"),o(4,"No Activity Found"),n(),i(5,"p"),o(6,"No transactions match the current filter criteria."),n()())}function Bt(r,t){r&1&&_(0,"div",50)}function jt(r,t){if(r&1&&(i(0,"div",33)(1,"div",34)(2,"div",35)(3,"mat-icon"),o(4),n()(),V(5,Bt,1,0,"div",36),n(),i(6,"div",37)(7,"mat-card",38)(8,"div",39)(9,"div",40)(10,"div",41)(11,"span",42),o(12),n(),i(13,"span",43),o(14,"performed"),n(),i(15,"span",44),o(16),n()(),i(17,"span",45),o(18),P(19,"date"),n()(),i(20,"div",46)(21,"div",47)(22,"mat-icon",48),o(23,"notes"),n(),i(24,"span",49),o(25),i(26,"strong"),o(27),n()()()()()()()()),r&2){let e=t.$implicit,l=t.$index,m=t.$count,p=k(3);a(4),c(p.getIconForAction(e.action)),a(),s("ngIf",l!==m-1),a(7),c(e.user),a(4),c(e.action),a(2),c(Q(19,7,e.timestamp,"MMM d, y, h:mm a")),a(7),R("",e.description," for account: "),a(2),c(e.account)}}function Gt(r,t){if(r&1&&(i(0,"div",32),x(1,jt,28,10,"div",33,z),n()),r&2){let e=k(2);a(),M(e.data())}}function Rt(r,t){if(r&1&&D(0,Ut,7,0,"div",31)(1,Gt,3,0,"div",32),r&2){let e=k();L(e.data().length===0?0:1)}}var Et=class r{fb=O(st);http=O(K);reportsApi=O(It);paginator;accountControl=new A(null);userControl=new A(null);truckControl=new A(null);filterForm=this.fb.group({startDate:[null],endDate:[null],accountId:[null],userId:[null],truckId:[null]});filterChange=new E;accounts=u([]);users=u([]);trucks=u([]);filteredAccounts$;filteredUsers$;filteredTrucks$;isLoading=u(!0);resultsLength=u(0);data=u([]);ngOnInit(){this.loadLookups(),this.setupFilters()}ngAfterViewInit(){F(this.paginator.page,this.filterChange.pipe(T(400))).pipe(y({}),$(()=>{this.isLoading.set(!0);let t=this.filterForm.value;return this.reportsApi.getActivityLog({page:this.paginator.pageIndex+1,pageSize:this.paginator.pageSize,startDate:t.startDate?t.startDate.toISOString():void 0,endDate:t.endDate?t.endDate.toISOString():void 0,accountId:t.accountId??void 0,userId:t.userId??void 0,truckId:t.truckId??void 0})}),h(t=>(this.isLoading.set(!1),this.resultsLength.set(t.totalCount),t.items))).subscribe(t=>this.data.set(t))}loadLookups(){this.http.get(`${w.apiUrl}/Lookups/accounts`).subscribe(t=>this.accounts.set(t)),this.http.get(`${w.apiUrl}/Admin/users`).subscribe(t=>this.users.set(t.map(e=>({id:e.id,name:`${e.firstName} ${e.lastName}`})))),this.http.get(`${w.apiUrl}/Lookups/trucks`).subscribe(t=>this.trucks.set(t.map(e=>({id:e.id,name:e.licensePlate}))))}setupFilters(){this.filteredAccounts$=this.accountControl.valueChanges.pipe(y(""),h(t=>this._filter(t,this.accounts()))),this.filteredUsers$=this.userControl.valueChanges.pipe(y(""),h(t=>this._filter(t,this.users()))),this.filteredTrucks$=this.truckControl.valueChanges.pipe(y(""),h(t=>this._filter(t,this.trucks())))}getDisplayName(t){return!t||typeof t=="string"?t||"":t.name}_filter(t,e){let l=(typeof t=="string"?t:t?.name||"").toLowerCase();return e.filter(m=>m.name.toLowerCase().includes(l))}onOptionSelected(t,e){e.setValue(t.option.value.id)}applyFilters(){this.filterForm.controls.accountId.setValue(this.getControlId(this.accountControl)),this.filterForm.controls.userId.setValue(this.getControlId(this.userControl)),this.filterForm.controls.truckId.setValue(this.getControlId(this.truckControl)),this.paginator.pageIndex=0,this.filterChange.next()}getControlId(t){let e=t.value;return e&&typeof e!="string"?e.id:null}resetFilters(){this.filterForm.reset(),this.accountControl.reset(),this.userControl.reset(),this.truckControl.reset(),this.applyFilters()}getIconForAction(t){switch(t.toLowerCase()){case"put away":return"move_to_inbox";case"repack":return"transform";case"picking":return"inventory";case"receiving":return"inventory_2";default:return"history"}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=N({type:r,selectors:[["app-activity-log"]],viewQuery:function(e,l){if(e&1&&B(S,5),e&2){let m;j(m=G())&&(l.paginator=m.first)}},decls:66,vars:22,consts:[["picker",""],["triggerAccount","matAutocompleteTrigger"],["accountAuto","matAutocomplete"],["triggerUser","matAutocompleteTrigger"],["userAuto","matAutocomplete"],["triggerTruck","matAutocompleteTrigger"],["truckAuto","matAutocomplete"],[1,"report-container"],[1,"header-section"],[1,"mat-headline-6"],[1,"mat-body-1"],[1,"filters-section"],[1,"filter-grid",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"custom-field"],[3,"formGroup"],["matStartDate","","formControlName","startDate","placeholder","Start date"],["matEndDate","","formControlName","endDate","placeholder","End date"],["matSuffix","",3,"for"],["matInput","","placeholder","Select Account",3,"click","formControl","matAutocomplete"],[3,"displayWith"],[3,"value"],["matSuffix",""],["matInput","","placeholder","Select User",3,"click","formControl","matAutocomplete"],["matInput","","placeholder","Select Truck",3,"click","formControl","matAutocomplete"],[1,"filter-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"content-wrapper"],[1,"spinner-container-page"],["showFirstLastButtons","",1,"custom-paginator",3,"length","pageSizeOptions"],["mode","indeterminate"],[1,"empty-list-message"],[1,"timeline-container"],[1,"timeline-item"],[1,"timeline-marker"],[1,"timeline-icon"],["class","timeline-line",4,"ngIf"],[1,"timeline-content"],[1,"timeline-card"],[1,"card-content-wrapper"],[1,"event-header"],[1,"user-info"],[1,"user-name"],[1,"action-text"],[1,"action-badge"],[1,"event-timestamp"],[1,"event-details"],[1,"detail-row"],[1,"detail-icon"],[1,"detail-text"],[1,"timeline-line"]],template:function(e,l){if(e&1){let m=U();i(0,"div",7)(1,"div",8)(2,"div")(3,"h1",9),o(4,"Activity Log"),n(),i(5,"p",10),o(6,"Search and review a detailed, chronological history of all user and system transactions."),n()()(),i(7,"div",11)(8,"div",12)(9,"mat-form-field",13)(10,"mat-label"),o(11,"Date Range"),n(),i(12,"mat-date-range-input",14),_(13,"input",15)(14,"input",16),n(),_(15,"mat-datepicker-toggle",17)(16,"mat-date-range-picker",null,0),n(),i(18,"mat-form-field",13)(19,"mat-label"),o(20,"Customer Account"),n(),i(21,"input",18,1),C("click",function(){f(m);let g=d(22);return v(g.openPanel())}),n(),i(23,"mat-autocomplete",19,2),x(25,$t,2,2,"mat-option",20,I),P(27,"async"),n(),i(28,"mat-icon",21),o(29,"business"),n()(),i(30,"mat-form-field",13)(31,"mat-label"),o(32,"User"),n(),i(33,"input",22,3),C("click",function(){f(m);let g=d(34);return v(g.openPanel())}),n(),i(35,"mat-autocomplete",19,4),x(37,Nt,2,2,"mat-option",20,I),P(39,"async"),n(),i(40,"mat-icon",21),o(41,"person"),n()(),i(42,"mat-form-field",13)(43,"mat-label"),o(44,"Truck"),n(),i(45,"input",23,5),C("click",function(){f(m);let g=d(46);return v(g.openPanel())}),n(),i(47,"mat-autocomplete",19,6),x(49,Vt,2,2,"mat-option",20,I),P(51,"async"),n(),i(52,"mat-icon",21),o(53,"local_shipping"),n()(),i(54,"div",24)(55,"button",25),C("click",function(){return f(m),v(l.resetFilters())}),o(56,"Clear"),n(),i(57,"button",26),C("click",function(){return f(m),v(l.applyFilters())}),i(58,"mat-icon"),o(59,"filter_list"),n(),i(60,"span"),o(61,"Apply"),n()()()()(),i(62,"div",27),D(63,zt,4,0,"div",28)(64,Rt,2,1),_(65,"mat-paginator",29),n()()}if(e&2){let m=d(17),p=d(24),g=d(36),Ft=d(48);a(8),s("formGroup",l.filterForm),a(4),s("formGroup",l.filterForm),a(3),s("for",m),a(6),s("formControl",l.accountControl)("matAutocomplete",p),a(2),s("displayWith",l.getDisplayName),a(2),M(b(27,15,l.filteredAccounts$)),a(8),s("formControl",l.userControl)("matAutocomplete",g),a(2),s("displayWith",l.getDisplayName),a(2),M(b(39,17,l.filteredUsers$)),a(8),s("formControl",l.truckControl)("matAutocomplete",Ft),a(2),s("displayWith",l.getDisplayName),a(2),M(b(51,19,l.filteredTrucks$)),a(14),L(l.isLoading()?63:64),a(2),s("length",l.resultsLength())("pageSizeOptions",W(21,Tt))}},dependencies:[J,Y,mt,it,nt,ot,rt,at,lt,Ct,_t,gt,dt,ct,pt,ft,ut,et,tt,Z,X,Dt,kt,bt,wt,At,St,Lt,S,yt,ht,Ot,Mt,vt,Pt,xt,q,H],styles:["[_nghost-%COMP%]{display:block;height:100%}.report-container[_ngcontent-%COMP%]{padding:1.5rem 2rem;max-width:1200px;margin:0 auto;display:flex;flex-direction:column;gap:2rem;height:100%;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--mat-sys-outline-variant)}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin:0 0 .5rem;color:var(--mat-sys-on-surface);letter-spacing:-.02em}.header-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--mat-sys-on-surface-variant);font-size:1rem;max-width:600px}.filters-section[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface);padding:0}.filter-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1.5rem;align-items:start}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{width:100%;max-width:none;margin-bottom:0}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{background-color:#fff!important;height:42px!important;padding:0 12px!important}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]     .mat-mdc-form-field-flex{height:100%!important;align-items:center!important;padding:0!important}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{padding:0!important;min-height:unset!important;border-top:0!important;width:auto!important}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]     .mat-mdc-input-element{padding:0!important;margin:0!important;top:0!important;position:relative!important;font-size:.9rem!important;line-height:42px!important;height:100%!important}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]     .mdc-line-ripple{display:none}.filter-actions[_ngcontent-%COMP%]{grid-column:4;display:flex;justify-content:flex-end;align-items:center;gap:.5rem;height:42px;margin-top:4px}.filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:100%;border-radius:4px}.content-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.spinner-container-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:1rem;padding:3rem;min-height:300px;color:var(--mat-sys-on-surface-variant);flex-grow:1}.empty-list-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:300px;text-align:center;gap:1rem;padding:2rem;color:var(--mat-sys-on-surface-variant);border:2px dashed var(--mat-sys-outline-variant-low);border-radius:12px}.empty-list-message[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:var(--mat-sys-outline);opacity:.5}.empty-list-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:500;color:var(--mat-sys-on-surface)}.empty-list-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1rem;max-width:400px}.timeline-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:1rem}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:1.5rem;position:relative;padding-bottom:2rem}.timeline-item[_ngcontent-%COMP%]:last-child{padding-bottom:0}.timeline-item[_ngcontent-%COMP%]:last-child   .timeline-line[_ngcontent-%COMP%]{display:none}.timeline-marker[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:40px;flex-shrink:0}.timeline-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background-color:var(--mat-sys-surface);border:2px solid var(--mat-sys-outline-variant);color:var(--mat-sys-primary);z-index:2;box-shadow:0 2px 4px #0000001a}.timeline-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.timeline-line[_ngcontent-%COMP%]{width:2px;flex-grow:1;background-color:var(--mat-sys-outline-variant);margin-top:.5rem;margin-bottom:.5rem}.timeline-content[_ngcontent-%COMP%]{flex-grow:1;padding-top:.25rem}.timeline-card[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);box-shadow:none;border-radius:12px;padding:0;background-color:var(--mat-sys-surface);transition:transform .2s ease,box-shadow .2s ease}.timeline-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0000000d}.card-content-wrapper[_ngcontent-%COMP%]{padding:1.25rem;display:flex;flex-direction:column;gap:1rem}.event-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.user-name[_ngcontent-%COMP%]{font-weight:600;color:var(--mat-sys-on-surface);font-size:1rem}.action-text[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant);font-size:.95rem}.action-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:6px;font-size:.85rem;font-weight:500;background-color:var(--mat-sys-surface-container-high);border:1px solid var(--mat-sys-outline-variant);color:var(--mat-sys-on-surface);text-transform:uppercase;letter-spacing:.05em}.event-timestamp[_ngcontent-%COMP%]{font-size:.9rem;color:var(--mat-sys-on-surface-variant)}.event-details[_ngcontent-%COMP%]{padding-top:.75rem;border-top:1px solid var(--mat-sys-outline-variant-low)}.detail-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem}.detail-row[_ngcontent-%COMP%]   .detail-icon[_ngcontent-%COMP%]{font-size:1.1rem;width:1.1rem;height:1.1rem;color:var(--mat-sys-primary);margin-top:2px}.detail-row[_ngcontent-%COMP%]   .detail-text[_ngcontent-%COMP%]{font-size:.95rem;color:var(--mat-sys-on-surface);line-height:1.4}.custom-paginator[_ngcontent-%COMP%]{background-color:transparent;border-top:1px solid var(--mat-sys-outline-variant)}@media (max-width: 768px){.report-container[_ngcontent-%COMP%]{padding:1rem}.filter-grid[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{width:100%;max-width:none}.filter-grid[_ngcontent-%COMP%]   .filter-actions[_ngcontent-%COMP%]{margin-left:0;width:100%}.filter-grid[_ngcontent-%COMP%]   .filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.event-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.25rem}.event-timestamp[_ngcontent-%COMP%]{font-size:.8rem}}"]})};export{Et as ActivityLogComponent};
