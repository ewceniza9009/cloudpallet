<h1 mat-dialog-title class="dialog-title">
  <mat-icon>scale</mat-icon>
  Process: {{ data.materialName }}
</h1>

<mat-dialog-content class="dialog-content">
  <mat-stepper linear #stepper="matStepper" class="process-stepper">
    <mat-step [stepControl]="infoForm" label="Details">
      <div class="step-header">
        <h3>Material Information</h3>
        <p>Enter the batch details and manufacturing date.</p>
      </div>
      <form [formGroup]="infoForm" class="step-form">
        <mat-form-field appearance="outline">
          <mat-label>Batch / Lot Number</mat-label>
          <input matInput formControlName="batchNumber" cdkFocusInitial>
          <mat-icon matSuffix>numbers</mat-icon>
        </mat-form-field>
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" formControlName="quantity" min="1">
            <mat-icon matSuffix>pin</mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Manufacture Date</mat-label>
            <input matInput type="date" formControlName="dateOfManufacture">
          </mat-form-field>
        </div>
        <mat-form-field appearance="outline">
          <mat-label>Expiry Date (Optional)</mat-label>
          <input matInput type="date" formControlName="expiryDate">
        </mat-form-field>
      </form>
      <div class="step-actions">
        <button mat-stroked-button color="primary" matStepperNext [disabled]="infoForm.invalid">
          <span>Continue to Weighing</span>
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
    </mat-step>

    <mat-step [stepControl]="weighingForm" label="Weighing">
       <div class="step-header">
        <h3>Pallet Weighing</h3>
        <p>Capture the gross weight from the integrated scale.</p>
      </div>
      <div class="weighing-step-content">
        <div class="weighing-controls">
          <button mat-stroked-button color="primary" (click)="onWeigh()" [disabled]="isWeighing()">
            @if (isWeighing()) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Capturing...</span>
            } @else {
              <ng-container>
                <mat-icon>scale</mat-icon>
                <span>Capture Weight from Scale</span>
              </ng-container>
            }
          </button>
        </div>
        <div class="weight-results" [formGroup]="weighingForm">
            <div class="weight-card">
              <span class="weight-label">Gross Weight</span>
              <span class="weight-value">{{ (weighingForm.get('grossWeight')?.value | number:'1.2-2') || '0.00' }} kg</span>
              <span class="weight-subtitle">Total weight including pallet</span>
            </div>
            <div class="weight-card net-card">
              <span class="weight-label">Net Weight</span>
              <span class="weight-value">{{ (weighingForm.get('netWeight')?.value | number:'1.2-2') || '0.00' }} kg</span>
               <span class="weight-subtitle">Material weight only (Tare: {{ data.palletTareWeight }} kg)</span>
            </div>
        </div>
      </div>
      <div class="step-actions">
        <button mat-button matStepperPrevious>
          <mat-icon>arrow_back</mat-icon>
          <span>Back</span>
        </button>
        <button mat-stroked-button color="primary" matStepperNext [disabled]="weighingForm.invalid">
          <span>Review & Submit</span>
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
    </mat-step>

    <mat-step label="Confirmation">
      <div class="step-header">
        <h3>Review & Submit</h3>
        <p>Verify all information before completing the process.</p>
      </div>
      <div class="confirmation-content">
          <h4>Process Summary</h4>
          <mat-list role="list">
            <mat-list-item role="listitem">
              <span matListItemTitle>Material</span>
              <span matListItemLine>{{ data.materialName }}</span>
            </mat-list-item>
             <mat-list-item role="listitem">
              <span matListItemTitle>Batch Number</span>
              <span matListItemLine>{{ infoForm.get('batchNumber')?.value }}</span>
            </mat-list-item>
             <mat-list-item role="listitem">
              <span matListItemTitle>Quantity</span>
              <span matListItemLine>{{ infoForm.get('quantity')?.value }}</span>
            </mat-list-item>
             <mat-list-item role="listitem" class="highlight">
              <span matListItemTitle>Net Weight</span>
              <span matListItemLine>{{ netWeight() | number:'1.2-2' }} kg</span>
            </mat-list-item>
          </mat-list>
          <div class="completion-note">
            <mat-icon>info_outline</mat-icon>
            <p>A unique barcode will be generated and this item will be added to inventory upon submission.</p>
          </div>
      </div>
       <div class="step-actions">
        <button mat-button matStepperPrevious>
          <mat-icon>arrow_back</mat-icon>
          <span>Back</span>
        </button>
        <button mat-stroked-button color="primary" (click)="onSubmit()" [disabled]="isSubmitting()">
          @if (isSubmitting()) {
            <ng-container>
              <mat-spinner diameter="20"></mat-spinner>
              <span>Processing...</span>
            </ng-container>
          } @else {
            <ng-container>
              <mat-icon>check_circle</mat-icon>
              <span>Complete Processing</span>
            </ng-container>
          }
        </button>
      </div>
    </mat-step>
  </mat-stepper>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancel</button>
</mat-dialog-actions>
