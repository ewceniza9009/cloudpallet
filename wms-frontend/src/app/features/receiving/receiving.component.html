<div class="receiving-list-container">
  <div class="header-section">
    <div>
      <h1 class="mat-headline-6">Goods Receiving</h1>
      <p class="mat-body-1">Manage and track all incoming inventory sessions.</p>
    </div>
    <button mat-flat-button color="primary" (click)="startNewSession()">
      <mat-icon>add</mat-icon>
      <span>Start New Session</span>
    </button>
  </div>

  <div class="search-section">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search</mat-label>
      <input matInput [(ngModel)]="searchTerm" (keyup.enter)="onSearch()" placeholder="Supplier or License Plate">
      <button mat-icon-button matSuffix (click)="onSearch()">
        <mat-icon>search</mat-icon>
      </button>
    </mat-form-field>

    <mat-form-field appearance="outline" class="date-field">
      <mat-label>Date</mat-label>
      <input matInput [matDatepicker]="picker" [(ngModel)]="searchDate" (dateChange)="onSearch()">
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <button mat-stroked-button (click)="clearSearch()">Clear</button>
  </div>

  <mat-card class="table-card">
    <mat-card-content>
      @if (isLoading()) {
      <div class="spinner-container">
        <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
      </div>
      } @else {
      <div class="sessions-table-container">
        @if(sessions().length > 0) {
        <table mat-table [dataSource]="sessions()" class="sessions-table">
          <ng-container matColumnDef="supplierName">
            <th mat-header-cell *matHeaderCellDef>Supplier</th>
            <td mat-cell *matCellDef="let session">
              <div class="cell-content">
                <mat-icon class="cell-icon">business</mat-icon>
                <span>{{ session.supplierName }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="licensePlate">
            <th mat-header-cell *matHeaderCellDef>Truck Plate</th>
            <td mat-cell *matCellDef="let session">
              <div class="cell-content">
                <mat-icon class="cell-icon">local_shipping</mat-icon>
                <span class="license-plate">{{ session.licensePlate || 'N/A' }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let session">
              <span class="status-badge" [ngClass]="'status-' + session.status.toLowerCase()">{{
                session.status
              }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="palletCount">
            <th mat-header-cell *matHeaderCellDef>Pallets</th>
            <td mat-cell *matCellDef="let session">
              <div class="cell-content">
                <mat-icon class="cell-icon">pallet</mat-icon>
                <span>{{ session.palletCount }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef>Date & Time</th>
            <td mat-cell *matCellDef="let session">
              <div class="timestamp">
                <div class="date">{{ session.timestamp | date : 'mediumDate' }}</div>
                <div class="time">{{ session.timestamp | date : 'shortTime' }}</div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let session" class="actions-cell">
      <a
        mat-stroked-button
        color="primary"
        [routerLink]="['/receiving', session.receivingId]"
      >
        @if (session.status === 'InProgress') {
          <ng-container>
            <mat-icon>play_arrow</mat-icon>
          </ng-container>
        } @else {
          <ng-container>
            <mat-icon>visibility</mat-icon>
          </ng-container>
        }
      </a>
      <button mat-icon-button color="warn" (click)="deleteSession(session.receivingId)" matTooltip="Delete Session" class="action-button">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns" class="session-row"></tr>
        </table>

        <mat-paginator
          [length]="totalCount()"
          [pageSize]="pageSize()"
          [pageIndex]="pageIndex()"
          [pageSizeOptions]="[5, 10, 20, 50]"
          (page)="onPageChange($event)"
          aria-label="Select page of sessions"
        >
        </mat-paginator>

        } @else {
        <div class="empty-sessions-state">
          <mat-icon>inventory_2</mat-icon>
          <h3>No Receiving Sessions Found</h3>
          <p>Get started by creating your first receiving session.</p>
        </div>
        }
      </div>
      }
    </mat-card-content>
  </mat-card>
</div>
