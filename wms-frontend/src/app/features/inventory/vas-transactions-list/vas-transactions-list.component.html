<div class="report-container">
  <div class="header-section">
    <div class="header-content">
      <h1>VAS Transactions</h1>
      <p class="subtitle">Manage Value-Added Services, amendments, and voids</p>
    </div>
  </div>

  <div class="filter-section">
    <form [formGroup]="filterForm" class="filter-grid">
      <div class="custom-field account-field">
        <label>Account</label>
        <input type="text" matInput formControlName="account" [matAutocomplete]="accountAuto" placeholder="Select account" #triggerAccount="matAutocompleteTrigger" (click)="triggerAccount.openPanel()">
        <mat-autocomplete #accountAuto="matAutocomplete" [displayWith]="displayAccount">
          <mat-option *ngFor="let account of accounts()" [value]="account">
            {{ account.name }}
          </mat-option>
        </mat-autocomplete>
        <mat-icon class="field-icon">business</mat-icon>
      </div>

      <div class="custom-field date-field">
        <label>Start Date</label>
        <input matInput [matDatepicker]="startPicker" formControlName="startDate" placeholder="Select date">
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </div>

      <div class="custom-field date-field">
        <label>End Date</label>
        <input matInput [matDatepicker]="endPicker" formControlName="endDate" placeholder="Select date">
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </div>

      <div class="filter-actions">
        <mat-checkbox formControlName="includeVoided" class="compact-checkbox">
          Include Voided
        </mat-checkbox>

        <button mat-flat-button color="primary" (click)="loadTransactions()" [disabled]="isLoading()">
          <mat-icon>search</mat-icon>
          <span>Load</span>
        </button>
      </div>
    </form>
  </div>

  @if (transactions().length === 0 && !isLoading()) {
    <div class="empty-list-message">
      <mat-icon>manage_search</mat-icon>
      <h3>No Transactions Found</h3>
      <p>Adjust your filters and click "Load" to view history.</p>
    </div>
  }

  @if (transactions().length > 0) {
    <div class="table-container">
      <table mat-table [dataSource]="transactions()" class="standard-table">
        <!-- Timestamp Column -->
        <ng-container matColumnDef="timestamp">
          <th mat-header-cell *matHeaderCellDef>Date & Time</th>
          <td mat-cell *matCellDef="let tx">
            <div class="cell-content">
              <span class="primary-text">{{ tx.timestamp | date:'MMM d, y' }}</span>
              <span class="secondary-text">{{ tx.timestamp | date:'h:mm a' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Service Column -->
        <ng-container matColumnDef="serviceType">
          <th mat-header-cell *matHeaderCellDef>Service</th>
          <td mat-cell *matCellDef="let tx">
            <span class="service-badge">{{ tx.serviceType }}</span>
          </td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Description</th>
          <td mat-cell *matCellDef="let tx" [matTooltip]="tx.description">
            <span class="truncate-text">{{ tx.description }}</span>
          </td>
        </ng-container>

        <!-- User Column -->
        <ng-container matColumnDef="userName">
          <th mat-header-cell *matHeaderCellDef>User</th>
          <td mat-cell *matCellDef="let tx">
            <div class="user-cell">
              <mat-icon>account_circle</mat-icon>
              <span>{{ tx.userName }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let tx">
            <span *ngIf="tx.isVoided" class="status-badge voided">VOIDED</span>
            <span *ngIf="tx.isAmended && !tx.isVoided" class="status-badge amended">AMENDED</span>
            <span *ngIf="!tx.isVoided && !tx.isAmended" class="status-badge active">ACTIVE</span>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let tx">
            <div class="actions-cell">
              <button mat-icon-button (click)="openAmendDialog(tx)" [disabled]="tx.isVoided" matTooltip="Amend">
                <mat-icon class="action-icon edit">edit</mat-icon>
              </button>
              <button mat-icon-button (click)="voidTransaction(tx)" [disabled]="tx.isVoided" matTooltip="Void">
                <mat-icon class="action-icon delete">block</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.voided-row]="row.isVoided"></tr>
      </table>
    </div>
  }
</div>