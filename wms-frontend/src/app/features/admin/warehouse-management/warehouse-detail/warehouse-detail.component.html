@if(isLoading()) {
<div class="spinner-container">
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  <span>Loading warehouse...</span>
</div>
} @else {
<div class="detail-container">
  <div class="detail-header">
    <div class="header-main">
      <a mat-icon-button (click)="back()" matTooltip="Back to List">
        <mat-icon>arrow_back</mat-icon>
      </a>
      <div class="title-group">
        <h2>
          {{
            warehouseId() ? warehouseForm.get("name")?.value : "New Warehouse"
          }}
        </h2>
        <p class="subtitle">
          {{
            warehouseId()
              ? "Update the details for this warehouse."
              : "Create a new warehouse facility."
          }}
        </p>
      </div>
    </div>
    <div class="header-actions">
      @if(warehouseId()) { @if(isEditMode()) {
      <button mat-stroked-button (click)="toggleEditMode(false)">
        <mat-icon>cancel</mat-icon>
        <span>Cancel</span>
      </button>
      <button
        mat-flat-button
        color="primary"
        (click)="save()"
        [disabled]="isSaving()"
      >
        @if(isSaving()) {
        <mat-progress-spinner
          diameter="20"
          mode="indeterminate"
        ></mat-progress-spinner>
        <span>Saving...</span>
        } @else {
        <ng-container>
          <mat-icon>save</mat-icon>
          <span>Save Changes</span>
        </ng-container>
        }
      </button>
      } @else {
      <button
        mat-stroked-button
        color="warn"
        (click)="delete()"
        [disabled]="isDeleting()"
      >
        @if(isDeleting()) {
        <mat-progress-spinner
          diameter="20"
          mode="indeterminate"
        ></mat-progress-spinner>
        <span>Deleting...</span>
        } @else {
        <ng-container>
          <mat-icon>delete</mat-icon>
          <span>Delete</span>
        </ng-container>
        }
      </button>
      <button mat-stroked-button color="primary" (click)="toggleEditMode(true)">
        <mat-icon>edit</mat-icon>
        <span>Edit</span>
      </button>
      } } @else {
      <button
        mat-flat-button
        color="primary"
        (click)="save()"
        [disabled]="isSaving()"
      >
        @if(isSaving()) {
        <mat-progress-spinner
          diameter="20"
          mode="indeterminate"
        ></mat-progress-spinner>
        <span>Saving...</span>
        } @else {
        <ng-container>
          <mat-icon>save</mat-icon>
          <span>Save Warehouse</span>
        </ng-container>
        }
      </button>
      }
    </div>
  </div>

  <form [formGroup]="warehouseForm" class="detail-form">
    <mat-card class="detail-card">
      <mat-card-header>
        <mat-card-title>Warehouse Details</mat-card-title>
      </mat-card-header>
      <mat-card-content class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Warehouse Name</mat-label>
          <input matInput formControlName="name" required />
          <mat-error *ngIf="warehouseForm.get('name')?.hasError('required')"
            >Name is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Operating Hours</mat-label>
          <input
            matInput
            formControlName="operatingHours"
            placeholder="e.g., 9:00 AM - 5:00 PM"
          />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Contact Phone</mat-label>
          <input matInput formControlName="contactPhone" required />
          <mat-error
            *ngIf="warehouseForm.get('contactPhone')?.hasError('required')"
            >Phone is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Contact Email</mat-label>
          <input
            matInput
            type="email"
            formControlName="contactEmail"
            required
          />
          <mat-error
            *ngIf="warehouseForm.get('contactEmail')?.hasError('required')"
            >Email is required</mat-error
          >
          <mat-error
            *ngIf="warehouseForm.get('contactEmail')?.hasError('email')"
            >Invalid email</mat-error
          >
        </mat-form-field>

        <div class="toggle-group full-width">
          <mat-slide-toggle formControlName="isActive" color="accent"
            >Is Active</mat-slide-toggle
          >
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="detail-card" formGroupName="address">
      <mat-card-header>
        <mat-card-title>Address</mat-card-title>
      </mat-card-header>
      <mat-card-content class="form-grid">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Street Address</mat-label>
          <input matInput formControlName="street" required />
          <mat-error
            *ngIf="addressFormGroup.get('street')?.hasError('required')"
            >Street is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>City</mat-label>
          <input matInput formControlName="city" required />
          <mat-error *ngIf="addressFormGroup.get('city')?.hasError('required')"
            >City is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>State / Province</mat-label>
          <input matInput formControlName="state" required />
          <mat-error *ngIf="addressFormGroup.get('state')?.hasError('required')"
            >State/Province is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Postal Code</mat-label>
          <input matInput formControlName="postalCode" required />
          <mat-error
            *ngIf="addressFormGroup.get('postalCode')?.hasError('required')"
            >Postal Code is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Country</mat-label>
          <input matInput formControlName="country" required />
          <mat-error
            *ngIf="addressFormGroup.get('country')?.hasError('required')"
            >Country is required</mat-error
          >
        </mat-form-field>
      </mat-card-content>
    </mat-card>
  </form>
</div>
}
