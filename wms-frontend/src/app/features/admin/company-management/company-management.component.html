<div class="management-container"> @if (isLoading()) {
  <div class="spinner-container">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <span>Loading Company Information...</span>
  </div>
  } @else {
  <div class="company-detail-wrapper">
    <div class="detail-header">
      <div class="header-main">
        <div class="title-group">
          <h2>Company Information</h2>
          <p class="subtitle">Manage your organization's details.</p>
        </div>
      </div>
      <div class="header-actions">
        @if(isEditMode()) {
        <button mat-stroked-button (click)="toggleEditMode(false)">
          <mat-icon>cancel</mat-icon>
          <span>Cancel</span>
        </button>
        <button mat-flat-button color="primary" (click)="save()" [disabled]="isSaving()">
          @if(isSaving()) {
          <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
          <span>Saving...</span>
          } @else {
          <ng-container>
            <mat-icon>save</mat-icon>
            <span>Save Changes</span>
          </ng-container>
          }
        </button>
        } @else {
        <button mat-stroked-button color="primary" (click)="toggleEditMode(true)">
          <mat-icon>edit</mat-icon>
          <span>Edit Details</span>
        </button>
        }
      </div>
    </div>

    <form [formGroup]="companyForm" class="detail-form">
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>Company Details</mat-card-title>
        </mat-card-header>
        <mat-card-content class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Company Name</mat-label>
            <input matInput formControlName="name" required />
            <mat-error *ngIf="companyForm.get('name')?.hasError('required')">Name is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Tax ID / Registration No.</mat-label>
            <input matInput formControlName="taxId" required />
            <mat-error *ngIf="companyForm.get('taxId')?.hasError('required')">Tax ID is required</mat-error>
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>Contact Information</mat-card-title>
        </mat-card-header>
        <mat-card-content class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Phone Number</mat-label>
            <input matInput formControlName="phoneNumber" required>
            <mat-error *ngIf="companyForm.get('phoneNumber')?.hasError('required')">Phone is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email Address</mat-label>
            <input matInput type="email" formControlName="email" required>
            <mat-error *ngIf="companyForm.get('email')?.hasError('required')">Email is required</mat-error>
            <mat-error *ngIf="companyForm.get('email')?.hasError('email')">Invalid email format</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Website (Optional)</mat-label>
            <input matInput formControlName="website">
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <mat-card class="detail-card" formGroupName="address">
        <mat-card-header>
          <mat-card-title>Address</mat-card-title>
        </mat-card-header>
        <mat-card-content class="form-grid">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Street Address</mat-label>
            <input matInput formControlName="street" required>
            <mat-error *ngIf="addressFormGroup.get('street')?.hasError('required')">Street is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" required>
            <mat-error *ngIf="addressFormGroup.get('city')?.hasError('required')">City is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>State / Province</mat-label>
            <input matInput formControlName="state" required>
            <mat-error *ngIf="addressFormGroup.get('state')?.hasError('required')">State/Province is
              required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Postal Code</mat-label>
            <input matInput formControlName="postalCode" required>
            <mat-error *ngIf="addressFormGroup.get('postalCode')?.hasError('required')">Postal Code is
              required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Country</mat-label>
            <input matInput formControlName="country" required>
            <mat-error *ngIf="addressFormGroup.get('country')?.hasError('required')">Country is required</mat-error>
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>GS1 Barcode Settings</mat-card-title>
        </mat-card-header>
        <mat-card-content class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>GS1 Company Prefix</mat-label>
            <input matInput formControlName="gs1CompanyPrefix" placeholder="e.g. 0123456" />
            <mat-hint>Used for SSCC generation</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Default Barcode Format</mat-label>
            <mat-select formControlName="defaultBarcodeFormat">
              <mat-option value="SSCC-18">SSCC-18</mat-option>
              <mat-option value="Code128">Code 128</mat-option>
              <mat-option value="QR">QR Code</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      @if(companyDetails(); as details) {
      <mat-card class="detail-card read-only-card">
        <mat-card-header>
          <mat-card-title>System Information</mat-card-title>
        </mat-card-header>
        <mat-card-content class="info-grid">
          <div class="info-item">
            <span class="info-label">Status</span>
            <span class="info-value">{{details.status}}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Subscription Plan</span>
            <span class="info-value">{{details.subscriptionPlan || 'N/A'}}</span>
          </div>
        </mat-card-content>
      </mat-card>
      }

    </form>
  </div>
  }
</div>
