<div class="list-container">
  <div class="list-header">
    <div class="header-content">
      <h2 class="list-title">Materials</h2>
      <p class="list-subtitle">Manage your inventory materials, SKUs, and product information</p>
    </div>
    <button mat-flat-button color="primary" (click)="createNew()" class="create-button">
      <mat-icon>add</mat-icon>
      <span>New Material</span>
    </button>
  </div>

  <div class="search-section">
    <mat-form-field appearance="outline" class="search-bar">
      <mat-label>Search materials...</mat-label>
      <input matInput [formControl]="searchControl" placeholder="Search by name or SKU">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
    </div>

  <div class="table-container">
    @if(isLoading()) {
      <div class="spinner-overlay">
        <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
        <span>Loading materials...</span>
      </div>
    }

    <table mat-table [dataSource]="dataSource" class="material-table" matSort (matSortChange)="refreshTrigger.next()">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="name">Material Name (SKU)</th>
        <td mat-cell *matCellDef="let material" class="name-cell">
          <div class="name-content">
            <span class="material-name">{{ material.name }}</span>
            <span class="material-sku">{{ material.sku }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="materialType">Type</th>
        <td mat-cell *matCellDef="let material">
          <span class="type-badge" [ngClass]="getMaterialTypeClass(material.materialType)">
            {{ material.materialType }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="temperature">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="requiredTempZone">Temp Zone</th>
        <td mat-cell *matCellDef="let material">
          <div class="temp-cell">
            <mat-icon [ngClass]="material.requiredTempZone.toLowerCase()">
              {{ material.requiredTempZone === 'FrozenStorage' ? 'ac_unit' : 'thermostat' }}
            </mat-icon>
            <span>{{ material.requiredTempZone }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="cost">
        <th mat-header-cell *matHeaderCellDef class="number-column" mat-sort-header="costPerUnit">Cost</th>
        <td mat-cell *matCellDef="let material" class="number-column">
          {{ material.costPerUnit | currency:'PHP':'symbol':'1.2-2' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="weight">
        <th mat-header-cell *matHeaderCellDef class="number-column" mat-sort-header="baseWeight">Weight</th>
        <td mat-cell *matCellDef="let material" class="number-column">
          {{ material.baseWeight | number:'1.1-3' }} kg
        </td>
      </ng-container>

      <ng-container matColumnDef="flags">
        <th mat-header-cell *matHeaderCellDef>Flags</th>
        <td mat-cell *matCellDef="let material">
          <div class="flags-container">
            @if(material.perishable) {
              <mat-icon class="flag-icon perishable" matTooltip="Perishable - {{ material.shelfLifeDays }} days">
                hourglass_empty
              </mat-icon>
            }
            @if(material.isHazardous) {
              <mat-icon class="flag-icon hazardous" matTooltip="Hazardous Material">
                warning
              </mat-icon>
            }
            @if(!material.isActive) {
              <mat-icon class="flag-icon inactive" matTooltip="Inactive">
                toggle_off
              </mat-icon>
            }
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="actions-column">Actions</th>
        <td mat-cell *matCellDef="let material" class="actions-column">
          <button mat-icon-button color="primary" [routerLink]="['/admin/materials/detail', material.id]" matTooltip="Edit Material">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="primary" [routerLink]="['/admin/materials/detail', material.id]" matTooltip="View Details">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" [routerLink]="['/admin/materials/detail', row.id]" class="material-row"></tr>

       <tr class="mat-row" *matNoDataRow [hidden]="isLoading()">
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            @if(searchControl.value) {
              <span>No data matching the filter "{{searchControl.value}}"</span>
            } @else {
               <div class="empty-state-inline">
                  <mat-icon>inventory_2</mat-icon>
                  <span>No materials defined.</span>
                  <button mat-stroked-button color="primary" (click)="$event.stopPropagation(); createNew()">
                      <mat-icon>add</mat-icon>Create One
                  </button>
               </div>
            }
        </td>
      </tr>
    </table>
  </div> <mat-paginator
      [length]="resultsLength()"
      [pageSize]="10"
      [pageSizeOptions]="[5, 10, 25, 100]"
      showFirstLastButtons
      aria-label="Select page of materials">
    </mat-paginator>
</div>
