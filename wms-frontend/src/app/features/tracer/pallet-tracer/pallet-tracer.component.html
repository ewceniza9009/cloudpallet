<div class="report-container">
  <div class="header-section">
    <div>
      <h1 class="mat-headline-6">Pallet Movement Tracer</h1>
      <p class="mat-body-1">Track the complete journey of a pallet with detailed movement history.</p>
    </div>
  </div>

  <div class="search-section">
    <form (submit)="onSearch($event)" class="search-form">
      <mat-form-field appearance="outline" class="custom-field search-field" subscriptSizing="dynamic">
        <mat-label>Enter Pallet Barcode (LPN)</mat-label>
        <input matInput [formControl]="searchControl" placeholder="Scan or type pallet identifier...">
        <mat-icon matSuffix>qr_code_scanner</mat-icon>
      </mat-form-field>
      <button mat-flat-button color="primary" type="submit" [disabled]="!searchControl.value || isLoading()" class="action-button">
        <mat-icon>search</mat-icon>
        <span>Trace</span>
      </button>
    </form>
  </div>

  @if (isLoading()) {
  <div class="spinner-container-page">
    <mat-progress-spinner mode="indeterminate" diameter="48"></mat-progress-spinner>
    <p>Tracking pallet movements...</p>
  </div>
  } @else {
  @if (searched() && palletHistory().length === 0) {
  <div class="empty-list-message">
    <mat-icon>search_off</mat-icon>
    <h2>No Movement History Found</h2>
    <p>No tracking records were found for pallet "{{searchControl.value}}". Please verify the barcode and try again.</p>
  </div>
  }

  @if (palletHistory().length > 0) {
  <div class="results-container">
    <div class="results-header">
      <h2>Tracking History for <strong>{{ searchControl.value }}</strong></h2>
      <span class="event-count">{{ palletHistory().length }} Events Found</span>
    </div>

    <div class="timeline-container">
      @for (item of palletHistory(); track $index) {
      <div class="timeline-item">
        <div class="timeline-marker">
          <div class="timeline-icon" [ngClass]="getColorClassForEventType(item.eventType)">
            <mat-icon>{{ getIconForEventType(item.eventType) }}</mat-icon>
          </div>
          <div class="timeline-line" *ngIf="!$last"></div>
        </div>
        
        <div class="timeline-content">
          <mat-card class="timeline-card">
            <div class="card-content-wrapper">
              <div class="event-info">
                <span class="event-type" [ngClass]="getColorClassForEventType(item.eventType)">{{ item.eventType | titlecase }}</span>
                <span class="event-time">{{ item.timestamp | date:'MMM d, y, h:mm a' }}</span>
              </div>
              
              <div class="event-details">
                <div class="detail-row">
                  <mat-icon class="detail-icon">location_on</mat-icon>
                  <span class="detail-text">{{ item.location }}</span>
                </div>
                @if (item.details) {
                <div class="detail-row">
                  <mat-icon class="detail-icon">notes</mat-icon>
                  <span class="detail-text">{{ item.details }}</span>
                </div>
                }
              </div>
            </div>
          </mat-card>
        </div>
      </div>
      }
    </div>
  </div>
  }
  }
</div>
