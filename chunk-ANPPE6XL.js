import{a as de,b as bt,c as yt}from"./chunk-DMQH6NGV.js";import{a as me}from"./chunk-RDGPNAAD.js";import{a as vt,b as le}from"./chunk-FXK2MYTD.js";import{a as re,b as xt}from"./chunk-OKTGWPHL.js";import{a as St}from"./chunk-GGWJBXVF.js";import{b as rt,c as lt,d as mt,e as dt,f as ct,g as st}from"./chunk-RE64XO5P.js";import{a as Qe,b as Ke,c as Ue,d as Ze,e as Ye,f as Je,g as Xe,h as et,i as tt,j as it,k as nt,l as ot,m as at}from"./chunk-GEIZTYKY.js";import"./chunk-WSA7XW7T.js";import"./chunk-MS4AQ6UA.js";import{d as ee,h as te,i as ie}from"./chunk-JD7VERCS.js";import{a as pt,b as ut,c as _t,e as ft,f as gt,g as Ct,h as ht}from"./chunk-YTDMGDSN.js";import"./chunk-S7GFW5PD.js";import{b as J,c as X}from"./chunk-7T4FYH4B.js";import{b as K,c as U,d as Be,f as Ge,i as Z,j as Y}from"./chunk-NRJELJJX.js";import{b as Fe,d as Pe}from"./chunk-PZORATZK.js";import"./chunk-PVDG46DZ.js";import{a as Ve}from"./chunk-HRGWCUCI.js";import{a as ne}from"./chunk-ORD52YGC.js";import{b as qe}from"./chunk-YC3EYHS2.js";import"./chunk-LOWV2IZF.js";import"./chunk-JYCF7ZPK.js";import{b as B,d as s,g as G,h as q,j as Oe,l as V,m as z,n as Ne,o as $,r as W,s as H,t as Ae,u as j,w as Q}from"./chunk-33GO6BEM.js";import"./chunk-RZ3EY26M.js";import"./chunk-5JMQ54DL.js";import{n as ke,p as N,q as A}from"./chunk-AFJ6IJZO.js";import{a as oe,b as ae}from"./chunk-67FWL4YT.js";import"./chunk-VD2AZ2LQ.js";import"./chunk-LWYKMW7M.js";import{a as ze,b as $e,c as We,f as He,i as je}from"./chunk-TFYOF5WW.js";import"./chunk-ZKJQ6NKM.js";import{H as k,I as O}from"./chunk-6GGLSGMC.js";import{j as F,q as Ie,t as P}from"./chunk-GEABFLPO.js";import{A as ye,C as ue,Cc as Re,E as _e,G as Me,Gc as we,Ib as Te,Ic as Le,Jb as S,Kb as v,Mb as L,Nb as T,Ob as R,Pb as d,Qb as o,Rb as i,Sb as c,V as Ee,W as fe,Wb as _,Xb as f,Zb as w,cb as r,cc as x,ec as u,f as Se,ga as h,ib as De,ic as ge,jc as Ce,k as ve,kc as he,la as E,ma as D,n as pe,pb as I,r as be,sc as a,tc as b,uc as y,va as g,vb as p}from"./chunk-FZDPWNP7.js";import{a as se}from"./chunk-AP4OEWII.js";function Ot(e,t){if(e&1&&(o(0,"mat-option",4),a(1),i()),e&2){let n=t.$implicit,l=u();d("value",n)("disabled",n==="Storage"&&l.data.location.zoneType!=="Storage"),r(),y(" ",n," ")}}function Nt(e,t){e&1&&(o(0,"mat-error"),a(1,"Capacity is required"),i())}function At(e,t){e&1&&(o(0,"mat-error"),a(1,"Must be >= 0"),i())}function Bt(e,t){e&1&&(c(0,"mat-progress-spinner",11),o(1,"span"),a(2,"Saving..."),i())}function Gt(e,t){e&1&&(_(0),o(1,"mat-icon"),a(2,"save"),i(),o(3,"span"),a(4,"Save Changes"),i(),f())}var ce=class e{constructor(t){this.data=t;this.editForm=this.fb.group({zoneType:[t.location.zoneType,s.required],capacityWeight:[t.location.capacityWeight,[s.required,s.min(0)]],isActive:[t.location.isActive]}),t.location.zoneType==="Storage"&&this.editForm.get("zoneType")?.disable()}fb=h(j);adminSetupApi=h(me);snackBar=h(ne);dialogRef=h(pt);isSaving=g(!1);editForm;locationTypes=["Storage","Picking","Staging"];onConfirm(){if(this.editForm.invalid)return;this.isSaving.set(!0);let t=this.editForm.getRawValue(),n={locationId:this.data.location.id,zoneType:t.zoneType,capacityWeight:t.capacityWeight,isActive:t.isActive};this.adminSetupApi.updateLocation(n.locationId,n).subscribe({next:()=>{this.snackBar.open("Location updated successfully.","OK",{duration:3e3}),this.dialogRef.close(!0)},error:l=>{this.snackBar.open(`Error: ${l.error?.title||"Failed to update location."}`,"Close",{duration:5e3}),this.isSaving.set(!1)}})}onCancel(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||e)(De(ut))};static \u0275cmp=I({type:e,selectors:[["app-edit-location-dialog"]],decls:29,vars:6,consts:[["mat-dialog-title","",1,"dialog-title"],[1,"edit-form",3,"formGroup"],["appearance","outline"],["formControlName","zoneType"],[3,"value","disabled"],["matInput","","type","number","formControlName","capacityWeight","min","0"],[4,"ngIf"],["formControlName","isActive","color","accent"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20","mode","indeterminate"]],template:function(n,l){if(n&1&&(o(0,"h2",0)(1,"mat-icon"),a(2,"edit_location_alt"),i(),o(3,"span"),a(4),i()(),o(5,"mat-dialog-content")(6,"form",1)(7,"mat-form-field",2)(8,"mat-label"),a(9,"Zone Type"),i(),o(10,"mat-select",3),T(11,Ot,2,3,"mat-option",4,L),i(),o(13,"mat-hint"),a(14,"Storage type (racks) cannot be changed."),i()(),o(15,"mat-form-field",2)(16,"mat-label"),a(17,"Capacity (kg)"),i(),c(18,"input",5),p(19,Nt,2,0,"mat-error",6)(20,At,2,0,"mat-error",6),i(),o(21,"mat-slide-toggle",7),a(22," Location is Active "),i()()(),o(23,"mat-dialog-actions",8)(24,"button",9),x("click",function(){return l.onCancel()}),a(25,"Cancel"),i(),o(26,"button",10),x("click",function(){return l.onConfirm()}),S(27,Bt,3,0)(28,Gt,5,0,"ng-container"),i()()),n&2){let m,M;r(4),y("Edit Location: ",l.data.location.barcode),r(2),d("formGroup",l.editForm),r(5),R(l.locationTypes),r(8),d("ngIf",(m=l.editForm.get("capacityWeight"))==null?null:m.hasError("required")),r(),d("ngIf",(M=l.editForm.get("capacityWeight"))==null?null:M.hasError("min")),r(6),d("disabled",l.editForm.invalid||l.isSaving()),r(),v(l.isSaving()?27:28)}},dependencies:[P,F,Q,V,B,z,G,q,H,$,W,ht,ft,Ct,gt,A,N,Y,Z,K,Be,U,X,J,ie,te,ee,ae,oe,O,k,le,vt],styles:[".dialog-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.edit-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;min-width:450px;padding-top:1rem;overflow-y:hidden}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%] + span[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:8px}"]})};var qt=()=>[10,25,100],Vt=(e,t)=>t.id;function zt(e,t){e&1&&(o(0,"div",0),c(1,"mat-progress-spinner",2),o(2,"span"),a(3,"Loading Room Details..."),i()())}function $t(e,t){if(e&1){let n=w();o(0,"button",21),x("click",function(){E(n);let m=u(2);return D(m.isEditMode.set(!0))}),o(1,"mat-icon"),a(2,"edit"),i(),o(3,"span"),a(4,"Edit Room"),i()()}}function Wt(e,t){e&1&&(c(0,"mat-progress-spinner",24),o(1,"span"),a(2,"Saving..."),i())}function Ht(e,t){if(e&1&&(_(0),o(1,"mat-icon"),a(2,"save"),i(),o(3,"span"),a(4),i(),f()),e&2){let n=u(3);r(4),b(n.isNewRoom()?"Create Room":"Save Changes")}}function jt(e,t){if(e&1){let n=w();o(0,"button",22),x("click",function(){E(n);let m=u(2);return D(m.back())}),o(1,"mat-icon"),a(2,"cancel"),i(),o(3,"span"),a(4,"Cancel"),i()(),o(5,"button",23),x("click",function(){E(n);let m=u(2);return D(m.saveRoom())}),S(6,Wt,3,0)(7,Ht,5,1,"ng-container"),i()}if(e&2){let n=u(2);r(5),d("disabled",n.isSaving()),r(),v(n.isSaving()?6:7)}}function Qt(e,t){if(e&1&&(o(0,"mat-option",18),a(1),i()),e&2){let n=t.$implicit;d("value",n.id),r(),b(n.name)}}function Kt(e,t){e&1&&(o(0,"mat-error"),a(1,"Warehouse is required"),i())}function Ut(e,t){if(e&1&&(o(0,"mat-form-field",14)(1,"mat-label"),a(2,"Parent Warehouse"),i(),o(3,"mat-select",25),T(4,Qt,2,2,"mat-option",18,Vt),i(),p(6,Kt,2,0,"mat-error",16),i()),e&2){let n,l=u(2);r(4),R(l.warehouses()),r(2),d("ngIf",(n=l.roomForm.get("warehouseId"))==null?null:n.hasError("required"))}}function Zt(e,t){e&1&&(o(0,"mat-error"),a(1,"Name is required"),i())}function Yt(e,t){if(e&1&&(o(0,"mat-option",18),a(1),i()),e&2){let n=t.$implicit;d("value",n),r(),b(n)}}function Jt(e,t){e&1&&(o(0,"mat-error"),a(1,"Service Type is required"),i())}function Xt(e,t){e&1&&(o(0,"mat-error"),a(1,"Required"),i())}function ei(e,t){e&1&&(o(0,"mat-error"),a(1,"Required"),i())}function ti(e,t){e&1&&(c(0,"mat-progress-spinner",24),o(1,"span"),a(2,"Generating..."),i())}function ii(e,t){e&1&&(_(0),o(1,"mat-icon"),a(2,"apps"),i(),o(3,"span"),a(4,"Generate"),i(),f())}function ni(e,t){if(e&1&&(o(0,"mat-option",18),a(1),i()),e&2){let n=t.$implicit;d("value",n),r(),b(n)}}function oi(e,t){e&1&&(c(0,"mat-progress-spinner",24),o(1,"span"),a(2,"Adding..."),i())}function ai(e,t){e&1&&(_(0),o(1,"mat-icon"),a(2,"add"),i(),o(3,"span"),a(4,"Add Location"),i(),f())}function ri(e,t){e&1&&(o(0,"div",65),c(1,"mat-progress-spinner",2),i())}function li(e,t){e&1&&(o(0,"th",66),a(1," Barcode "),i())}function mi(e,t){if(e&1&&(o(0,"td",67),a(1),i()),e&2){let n=t.$implicit;r(),y(" ",n.barcode," ")}}function di(e,t){e&1&&(o(0,"th",66),a(1," Bay "),i())}function ci(e,t){if(e&1&&(o(0,"td",68),a(1),i()),e&2){let n=t.$implicit;r(),y(" ",n.bay," ")}}function si(e,t){e&1&&(o(0,"th",66),a(1," Row "),i())}function pi(e,t){if(e&1&&(o(0,"td",68),a(1),i()),e&2){let n=t.$implicit;r(),y(" ",n.row," ")}}function ui(e,t){e&1&&(o(0,"th",66),a(1," Col "),i())}function _i(e,t){if(e&1&&(o(0,"td",68),a(1),i()),e&2){let n=t.$implicit;r(),y(" ",n.column," ")}}function fi(e,t){e&1&&(o(0,"th",66),a(1," Lvl "),i())}function gi(e,t){if(e&1&&(o(0,"td",68),a(1),i()),e&2){let n=t.$implicit;r(),y(" ",n.level," ")}}function Ci(e,t){e&1&&(o(0,"th",66),a(1," Zone "),i())}function hi(e,t){if(e&1&&(o(0,"td",68)(1,"span",69),a(2),i()()),e&2){let n=t.$implicit;r(2),b(n.zoneType)}}function xi(e,t){e&1&&(o(0,"th",66),a(1," Capacity "),i())}function Si(e,t){if(e&1&&(o(0,"td",68),a(1),we(2,"number"),i()),e&2){let n=t.$implicit;r(),y(" ",Le(2,1,n.capacityWeight,"1.0-0")," kg ")}}function vi(e,t){e&1&&(o(0,"th",66),a(1," Empty "),i())}function bi(e,t){if(e&1&&(o(0,"td",68)(1,"mat-icon",70),a(2),i()()),e&2){let n=t.$implicit;r(),d("color",n.isEmpty?"primary":"warn"),r(),b(n.isEmpty?"check_circle":"do_not_disturb_on")}}function yi(e,t){e&1&&(o(0,"th",66),a(1," Active "),i())}function Mi(e,t){if(e&1&&(o(0,"td",68)(1,"mat-icon",70),a(2),i()()),e&2){let n=t.$implicit;r(),d("color",n.isActive?"primary":"disabled"),r(),b(n.isActive?"toggle_on":"toggle_off")}}function Ei(e,t){e&1&&(o(0,"th",71),a(1," Actions "),i())}function Di(e,t){if(e&1){let n=w();o(0,"td",68)(1,"button",72),x("click",function(){let m=E(n).$implicit,M=u(3);return D(M.openEditLocationDialog(m))}),o(2,"mat-icon"),a(3,"edit"),i()(),o(4,"button",73),x("click",function(){let m=E(n).$implicit,M=u(3);return D(M.deleteLocation(m))}),o(5,"mat-icon"),a(6,"delete"),i()()()}if(e&2){let n=t.$implicit;r(4),d("disabled",!n.isEmpty)}}function Ti(e,t){e&1&&c(0,"tr",74)}function Ri(e,t){e&1&&c(0,"tr",75)}function wi(e,t){if(e&1&&(o(0,"tr",76)(1,"td",77),a(2," No locations found for this room. "),i()()),e&2){let n=u(3);r(),Te("colspan",n.displayedColumns.length)}}function Li(e,t){if(e&1){let n=w();o(0,"mat-accordion",26)(1,"mat-expansion-panel")(2,"mat-expansion-panel-header")(3,"mat-panel-title")(4,"mat-icon"),a(5,"grid_on"),i(),a(6," Generate Rack Locations"),i(),o(7,"mat-panel-description"),a(8,"Bulk-create locations for a new bay"),i()(),o(9,"form",27),x("ngSubmit",function(){E(n);let m=u(2);return D(m.onGenerateRacks())}),o(10,"mat-form-field",14)(11,"mat-label"),a(12,"Bay Name"),i(),c(13,"input",28),i(),o(14,"mat-form-field",14)(15,"mat-label"),a(16,"Zone Type"),i(),c(17,"input",29),i(),o(18,"mat-form-field",14)(19,"mat-label"),a(20,"Start Row"),i(),c(21,"input",30),i(),o(22,"mat-form-field",14)(23,"mat-label"),a(24,"End Row"),i(),c(25,"input",31),i(),o(26,"mat-form-field",14)(27,"mat-label"),a(28,"Start Column"),i(),c(29,"input",32),i(),o(30,"mat-form-field",14)(31,"mat-label"),a(32,"End Column"),i(),c(33,"input",33),i(),o(34,"mat-form-field",14)(35,"mat-label"),a(36,"Start Level"),i(),c(37,"input",34),i(),o(38,"mat-form-field",14)(39,"mat-label"),a(40,"End Level"),i(),c(41,"input",35),i(),o(42,"button",36),S(43,ti,3,0)(44,ii,5,0,"ng-container"),i()()(),o(45,"mat-expansion-panel")(46,"mat-expansion-panel-header")(47,"mat-panel-title")(48,"mat-icon"),a(49,"label"),i(),a(50," Add Simple Location"),i(),o(51,"mat-panel-description"),a(52,"Create a single Staging or Picking location"),i()(),o(53,"form",37),x("ngSubmit",function(){E(n);let m=u(2);return D(m.onAddSimpleLocation())}),o(54,"mat-form-field",14)(55,"mat-label"),a(56,"Location Name (Barcode)"),i(),c(57,"input",38),i(),o(58,"mat-form-field",14)(59,"mat-label"),a(60,"Zone Type"),i(),o(61,"mat-select",39),T(62,ni,2,2,"mat-option",18,L),i()(),o(64,"button",36),S(65,oi,3,0)(66,ai,5,0,"ng-container"),i()()()(),o(67,"mat-card",11)(68,"mat-card-header")(69,"mat-card-title"),a(70,"Existing Locations"),i()(),o(71,"mat-card-content",40)(72,"mat-form-field",41)(73,"mat-label"),a(74,"Search Locations by Barcode or Bay"),i(),c(75,"input",42),o(76,"mat-icon",43),a(77,"search"),i()(),o(78,"div",44),p(79,ri,2,0,"div",45),o(80,"table",46),_(81,47),p(82,li,2,0,"th",48)(83,mi,2,1,"td",49),f(),_(84,50),p(85,di,2,0,"th",48)(86,ci,2,1,"td",51),f(),_(87,52),p(88,si,2,0,"th",48)(89,pi,2,1,"td",51),f(),_(90,53),p(91,ui,2,0,"th",48)(92,_i,2,1,"td",51),f(),_(93,54),p(94,fi,2,0,"th",48)(95,gi,2,1,"td",51),f(),_(96,55),p(97,Ci,2,0,"th",48)(98,hi,3,1,"td",51),f(),_(99,56),p(100,xi,2,0,"th",48)(101,Si,3,4,"td",51),f(),_(102,57),p(103,vi,2,0,"th",48)(104,bi,3,2,"td",51),f(),_(105,58),p(106,yi,2,0,"th",48)(107,Mi,3,2,"td",51),f(),_(108,59),p(109,Ei,2,0,"th",60)(110,Di,7,1,"td",51),f(),p(111,Ti,1,0,"tr",61)(112,Ri,1,0,"tr",62)(113,wi,3,1,"tr",63),i(),c(114,"mat-paginator",64),i()()()}if(e&2){let n=u(2);r(9),d("formGroup",n.generateRackForm),r(33),d("disabled",n.generateRackForm.invalid||n.isGeneratingLocations()),r(),v(n.isGeneratingLocations()?43:44),r(10),d("formGroup",n.simpleLocationForm),r(9),R(n.locationTypes),r(2),d("disabled",n.simpleLocationForm.invalid||n.isAddingSimpleLocation()),r(),v(n.isAddingSimpleLocation()?65:66),r(10),d("formControl",n.locationSearchControl),r(4),d("ngIf",n.isLoadingTable()),r(),d("dataSource",n.dataSource),r(31),d("matHeaderRowDef",n.displayedColumns),r(),d("matRowDefColumns",n.displayedColumns),r(2),d("length",n.resultsLength())("pageSizeOptions",Re(13,qt))}}function Ii(e,t){if(e&1){let n=w();o(0,"div",1)(1,"div",3)(2,"div",4)(3,"a",5),x("click",function(){E(n);let m=u();return D(m.back())}),o(4,"mat-icon"),a(5,"arrow_back"),i()(),o(6,"div",6)(7,"h2"),a(8),i(),o(9,"p",7),a(10),i()()(),o(11,"div",8),S(12,$t,5,0,"button",9),S(13,jt,8,2),i()(),o(14,"form",10)(15,"mat-card",11)(16,"mat-card-header")(17,"mat-card-title"),a(18,"Room Details"),i()(),o(19,"mat-card-content",12),p(20,Ut,7,1,"mat-form-field",13),o(21,"mat-form-field",14)(22,"mat-label"),a(23,"Room Name"),i(),c(24,"input",15),p(25,Zt,2,0,"mat-error",16),i(),o(26,"mat-form-field",14)(27,"mat-label"),a(28,"Service Type"),i(),o(29,"mat-select",17),T(30,Yt,2,2,"mat-option",18,L),i(),p(32,Jt,2,0,"mat-error",16),i(),o(33,"mat-form-field",14)(34,"mat-label"),a(35,"Min Temp (\xB0C)"),i(),c(36,"input",19),p(37,Xt,2,0,"mat-error",16),i(),o(38,"mat-form-field",14)(39,"mat-label"),a(40,"Max Temp (\xB0C)"),i(),c(41,"input",20),p(42,ei,2,0,"mat-error",16),i()()()(),S(43,Li,115,14),i()}if(e&2){let n,l,m,M,xe,C=u();r(8),b(C.isNewRoom()?"Create New Room":(n=C.roomForm.get("name"))==null?null:n.value),r(2),b(C.isNewRoom()?"Define a new storage room or zone.":"Edit details and manage locations for this room."),r(2),v(!C.isNewRoom()&&!C.isEditMode()?12:-1),r(),v(C.isEditMode()?13:-1),r(),d("formGroup",C.roomForm),r(6),d("ngIf",C.isNewRoom()),r(5),d("ngIf",(l=C.roomForm.get("name"))==null?null:l.hasError("required")),r(5),R(C.serviceTypes),r(2),d("ngIf",(m=C.roomForm.get("serviceType"))==null?null:m.hasError("required")),r(5),d("ngIf",(M=C.roomForm.get("minTemp"))==null?null:M.hasError("required")),r(5),d("ngIf",(xe=C.roomForm.get("maxTemp"))==null?null:xe.hasError("required")),r(),v(C.isNewRoom()?-1:43)}}var Mt=class e{fb=h(j);route=h(Fe);router=h(Pe);adminSetupApi=h(me);snackBar=h(ne);dialog=h(_t);roomId=g(null);isNewRoom=g(!1);isLoading=g(!0);isSaving=g(!1);isDeleting=g(!1);isGeneratingLocations=g(!1);isAddingSimpleLocation=g(!1);isEditMode=g(!1);resultsLength=g(0);isLoadingTable=g(!0);roomDetails=g(null);warehouses=g([]);serviceTypes=["Storage","Blasting","Chilling","CoolStorage","DeepFrozenStorage","FrozenStorage","ULTStorage","Handling","Staging","CrossDock"];locationTypes=["Staging","Picking"];roomForm;generateRackForm;simpleLocationForm;locationSearchControl=new Oe("");_paginator;set paginator(t){t&&(this._paginator=t,this.trySetupTableListeners())}get paginator(){return this._paginator}_sort;set sort(t){t&&(this._sort=t,this.trySetupTableListeners())}get sort(){return this._sort}displayedColumns=["barcode","bay","row","column","level","zoneType","capacityWeight","isEmpty","isActive","actions"];dataSource=new at;refreshTable=new Se;tableListenersInitialized=!1;constructor(){this.roomForm=this.fb.group({warehouseId:["",s.required],name:["",s.required],minTemp:[-20,s.required],maxTemp:[-10,s.required],serviceType:["FrozenStorage",s.required]}),this.generateRackForm=this.fb.group({bay:["A01",s.required],startRow:[1,[s.required,s.min(1)]],endRow:[10,[s.required,s.min(1)]],startCol:[1,[s.required,s.min(1)]],endCol:[5,[s.required,s.min(1)]],startLevel:[1,[s.required,s.min(1)]],endLevel:[6,[s.required,s.min(1)]],zoneType:["Storage"]}),this.simpleLocationForm=this.fb.group({name:["STAGING-01",s.required],zoneType:["Staging",s.required]})}ngOnInit(){this.loadWarehouses(),this.route.paramMap.pipe(fe(t=>{let n=t.get("id");return n&&n!=="new"?(this.isNewRoom.set(!1),this.roomId.set(n),this.roomForm.get("warehouseId")?.disable(),this.adminSetupApi.getRoomById(n).pipe(_e(()=>(this.snackBar.open("Room not found.","Close",{duration:3e3}),this.router.navigate(["/setup/rooms"]),ve)))):(this.isNewRoom.set(!0),this.isLoading.set(!1),this.roomForm.enable(),this.isEditMode.set(!0),pe(null))})).subscribe(t=>{t&&(this.roomDetails.set(t),this.roomForm.patchValue({warehouseId:t.warehouseId,name:t.name,minTemp:t.minTemp,maxTemp:t.maxTemp,serviceType:t.serviceType}),this.isLoading.set(!1),this.roomForm.disable(),this.isEditMode.set(!1))})}trySetupTableListeners(){this.isNewRoom()||!this.paginator||!this.sort||this.tableListenersInitialized||(this.tableListenersInitialized=!0,setTimeout(()=>{this.sort.active="bay",this.sort.direction="asc"},0),this.sort.active="bay",this.sort.direction="asc",ye(this.sort.sortChange,this.paginator.page,this.refreshTable,this.locationSearchControl.valueChanges.pipe(Me(400))).pipe(Ee({}),fe(()=>{this.isLoadingTable.set(!0);let t={roomId:this.roomId(),page:this.paginator.pageIndex+1,pageSize:this.paginator.pageSize,sortBy:this.sort.active,sortDirection:this.sort.direction?this.sort.direction:void 0,searchTerm:this.locationSearchControl.value??void 0};return this.adminSetupApi.getLocationsForRoom(t).pipe(_e(()=>(this.snackBar.open("Failed to load locations.","Close"),pe(null))))}),be(t=>(this.isLoadingTable.set(!1),t?(this.resultsLength.set(t.totalCount),t.items):[]))).subscribe(t=>this.dataSource.data=t))}loadWarehouses(){this.adminSetupApi.getWarehouses().subscribe(t=>this.warehouses.set(t))}saveRoom(){if(this.roomForm.invalid){this.snackBar.open("Please fill in all required fields for the room.","Close");return}this.isSaving.set(!0);let t=this.roomForm.getRawValue();if(this.isNewRoom()){let n={warehouseId:t.warehouseId,name:t.name,minTemp:t.minTemp,maxTemp:t.maxTemp,serviceType:t.serviceType};this.adminSetupApi.createRoom(n).subscribe({next:l=>{this.snackBar.open("Room created successfully.","OK",{duration:3e3}),this.router.navigate(["/setup/rooms/detail",l],{replaceUrl:!0})},error:l=>this.handleSaveError(l)})}else this.router.navigate(["/setup/rooms"]),this.snackBar.open("Room update functionality not yet implemented.","OK"),this.isSaving.set(!1)}handleSaveError(t){this.isSaving.set(!1),this.snackBar.open(`Error: ${t.error?.title||"Failed to save room."}`,"Close",{duration:5e3})}onGenerateRacks(){if(this.generateRackForm.invalid)return;this.isGeneratingLocations.set(!0);let t=se({roomId:this.roomId()},this.generateRackForm.value);this.adminSetupApi.createLocationsInBay(t).subscribe({next:()=>{this.snackBar.open("Rack locations generated successfully!","OK",{duration:3e3});let l=(this.generateRackForm.get("bay")?.value||"A01").replace(/(\d+)$/,m=>(parseInt(m)+1).toString().padStart(m.length,"0"));this.generateRackForm.patchValue({bay:l}),this.refreshTable.next(),this.isGeneratingLocations.set(!1)},error:n=>{this.snackBar.open(`Error: ${n.error?.title||"Failed to generate locations."}`,"Close"),this.isGeneratingLocations.set(!1)}})}onAddSimpleLocation(){if(this.simpleLocationForm.invalid)return;this.isAddingSimpleLocation.set(!0);let t=se({roomId:this.roomId()},this.simpleLocationForm.value);this.adminSetupApi.createSimpleLocation(t).subscribe({next:()=>{this.snackBar.open("Simple location created!","OK",{duration:3e3});let l=(this.simpleLocationForm.get("name")?.value||"STAGING-01").replace(/(\d+)$/,m=>(parseInt(m)+1).toString().padStart(m.length,"0"));this.simpleLocationForm.patchValue({name:l}),this.refreshTable.next(),this.isAddingSimpleLocation.set(!1)},error:n=>{this.snackBar.open(`Error: ${n.error?.title||"Failed to create location."}`,"Close"),this.isAddingSimpleLocation.set(!1)}})}openEditLocationDialog(t){this.dialog.open(ce,{width:"550px",data:{location:t}}).afterClosed().pipe(ue(l=>l===!0)).subscribe(()=>{this.refreshTable.next()})}deleteLocation(t){if(!t.isEmpty){this.snackBar.open("Cannot delete a location that is not empty.","Close",{duration:4e3});return}this.dialog.open(St,{data:{title:"Delete Location",message:`Are you sure you want to delete location "${t.barcode}"? This action cannot be undone.`}}).afterClosed().pipe(ue(l=>l===!0)).subscribe(()=>{this.adminSetupApi.deleteLocation(t.id).subscribe({next:()=>{this.snackBar.open("Location deleted successfully.","OK",{duration:3e3}),this.refreshTable.next()},error:l=>this.snackBar.open(`Error: ${l.error?.title||"Failed to delete location."}`,"Close")})})}back(){this.router.navigate(["/setup/rooms"])}get addressFormGroup(){return this.roomForm.get("address")}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=I({type:e,selectors:[["app-room-detail"]],viewQuery:function(n,l){if(n&1&&(ge(re,5),ge(de,5)),n&2){let m;Ce(m=he())&&(l.paginator=m.first),Ce(m=he())&&(l.sort=m.first)}},decls:2,vars:1,consts:[[1,"spinner-container"],[1,"detail-container"],["mode","indeterminate"],[1,"detail-header"],[1,"header-main"],["mat-icon-button","","matTooltip","Back to Room List",3,"click"],[1,"title-group"],[1,"subtitle"],[1,"header-actions"],["mat-stroked-button","","color","primary"],[1,"detail-form",3,"formGroup"],[1,"detail-card"],[1,"form-grid","four-columns"],["appearance","outline",4,"ngIf"],["appearance","outline"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","serviceType","required",""],[3,"value"],["matInput","","type","number","formControlName","minTemp","required",""],["matInput","","type","number","formControlName","maxTemp","required",""],["mat-stroked-button","","color","primary",3,"click"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20","mode","indeterminate"],["formControlName","warehouseId","required",""],["multi","",1,"location-generators-accordion"],[1,"generator-form-grid",3,"ngSubmit","formGroup"],["matInput","","formControlName","bay","placeholder","e.g., A01, B02","required",""],["matInput","","formControlName","zoneType","readonly",""],["matInput","","type","number","formControlName","startRow","min","1"],["matInput","","type","number","formControlName","endRow","min","1"],["matInput","","type","number","formControlName","startCol","min","1"],["matInput","","type","number","formControlName","endCol","min","1"],["matInput","","type","number","formControlName","startLevel","min","1"],["matInput","","type","number","formControlName","endLevel","min","1"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[1,"generator-form-grid","simple-form",3,"ngSubmit","formGroup"],["matInput","","formControlName","name","placeholder","e.g., STAGING-01","required",""],["formControlName","zoneType","required",""],[1,"location-table-content"],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["matInput","",3,"formControl"],["matSuffix",""],[1,"table-container"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","barcode"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","barcode-cell",4,"matCellDef"],["matColumnDef","bay"],["mat-cell","",4,"matCellDef"],["matColumnDef","row"],["matColumnDef","column"],["matColumnDef","level"],["matColumnDef","zoneType"],["matColumnDef","capacityWeight"],["matColumnDef","isEmpty"],["matColumnDef","isActive"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"length","pageSizeOptions"],[1,"spinner-overlay"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"barcode-cell"],["mat-cell",""],[1,"detail-chip","zone-chip"],[3,"color"],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","Edit Location",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete Location",3,"click","disabled"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(n,l){n&1&&S(0,zt,4,0,"div",0)(1,Ii,44,11,"div",1),n&2&&v(l.isLoading()?0:1)},dependencies:[P,F,Q,V,B,z,G,q,Ae,H,Ne,$,W,je,ze,We,He,$e,Y,Z,K,U,Ge,X,J,ie,te,ee,A,N,ke,O,k,ae,oe,le,st,ct,rt,lt,dt,mt,ot,Qe,Ue,Xe,Ze,Ke,et,Ye,Je,tt,it,nt,xt,re,yt,de,bt,Ve,qe,Ie],styles:["[_nghost-%COMP%]{display:block}.spinner-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:1rem;padding:3rem;min-height:300px;color:var(--mat-sys-on-surface-variant)}.detail-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;padding-bottom:1rem;border-bottom:1px solid var(--mat-sys-outline-variant);margin-bottom:.5rem}.header-main[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-grow:1;min-width:0}.title-group[_ngcontent-%COMP%]{min-width:0}.title-group[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.title-group[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:var(--mat-sys-on-surface-variant)}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-shrink:0}.detail-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.detail-card[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);box-shadow:0 2px 4px #0000000a;border-radius:8px}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:1rem 1.5rem .5rem;border-bottom:1px solid var(--mat-sys-outline-variant);background-color:var(--mat-sys-surface-container-lowest)}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:500}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:1.5rem}.detail-card[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]{padding:.5rem 1.5rem 1rem;border-top:1px solid var(--mat-sys-outline-variant);background-color:var(--mat-sys-surface-container-lowest)}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.25rem 1.5rem}.form-grid.four-columns[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.full-width[_ngcontent-%COMP%]{grid-column:1/-1}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%] + span[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + mat-icon[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:8px}@media (max-width: 768px){.detail-container[_ngcontent-%COMP%]{padding:1rem}}.location-generators-accordion[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.location-generators-accordion[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);border-radius:8px!important;box-shadow:0 2px 4px #0000000a}.location-generators-accordion[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{font-weight:500}.location-generators-accordion[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.generator-form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem 1.5rem;align-items:end;padding-top:1rem}.generator-form-grid[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{grid-column:-2/-1;justify-self:end}.generator-form-grid.simple-form[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr auto}.location-table-content[_ngcontent-%COMP%]{padding:1.5rem .5rem!important}.table-container[_ngcontent-%COMP%]{position:relative;overflow:auto;width:100%;border:1px solid var(--mat-sys-outline-variant);border-radius:8px;margin-top:1rem}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:rgba(var(--mat-sys-surface-rgb),.8);display:flex;justify-content:center;align-items:center;z-index:5}.mat-mdc-table[_ngcontent-%COMP%]{width:100%}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:8px 12px}.barcode-cell[_ngcontent-%COMP%]{font-family:monospace;font-weight:500}.detail-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:12px;font-size:.75rem;font-weight:500;border:1px solid var(--mat-sys-outline-variant);background-color:var(--mat-sys-surface-container-low);color:var(--mat-sys-on-surface-variant);white-space:nowrap}"]})};export{Mt as RoomDetailComponent};
