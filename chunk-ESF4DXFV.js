import{a as qt}from"./chunk-XA53XGSR.js";import{a as T,b as Wt,c as jt}from"./chunk-R2PHWP7R.js";import{a as I,b as Qt}from"./chunk-34QA4HMZ.js";import{g as $t}from"./chunk-6VWEIHEL.js";import{a as wt,b as Ot,c as Dt,d as Et,e as Ht,f as Pt,g as It,h as Tt,i as At,j as Nt,k as Ft,l as Lt,m as Vt}from"./chunk-IE2HMRD4.js";import{a as Rt,b as Bt,c as zt}from"./chunk-Q74Q4XXZ.js";import"./chunk-MS4AQ6UA.js";import{d as vt}from"./chunk-AR7DOULP.js";import"./chunk-E4XFWEKX.js";import{b as St,c as xt}from"./chunk-JJ4H6OAC.js";import{b as ht,i as Ct,j as _t}from"./chunk-XOBVZ7HT.js";import"./chunk-FTTQQNBZ.js";import"./chunk-LJS4T7OK.js";import"./chunk-3AIDC2CP.js";import"./chunk-ISLNSOXI.js";import{b as mt,g as pt,h as ct,j as P,n as st,o as dt,r as ut,u as ft,w as gt}from"./chunk-OPXM5N2G.js";import"./chunk-2ATSTUKT.js";import{o as rt,p as lt}from"./chunk-362WG5KS.js";import{a as kt,b as bt}from"./chunk-JQRCIVV7.js";import{a as H}from"./chunk-2G4RJFBR.js";import{a as Mt,i as yt}from"./chunk-BKLGZBQH.js";import{G as ot,H as at}from"./chunk-PPJHYCVS.js";import{C as nt,j as Y,m as Z,o as tt,q as et,t as it}from"./chunk-DHGPXNCW.js";import{$ as j,$b as u,Aa as y,Ab as c,Ac as K,F as z,Hc as X,J as Q,L as W,Lc as M,Mc as w,Nb as G,Nc as L,Sb as D,Tb as E,Ub as p,Vb as o,Wb as n,Xb as d,_ as b,a as $,ac as f,cc as U,hb as r,hc as S,jc as J,k as R,la as O,nc as A,oc as N,pc as F,qa as C,ra as _,s as B,tc as x,ub as q,w as k,xc as a,yc as v,zc as g}from"./chunk-N46UG6V3.js";var Ut=()=>[25,50,100],V=(e,t)=>t.id;function Jt(e,t){if(e&1&&(o(0,"mat-option",14),a(1),n()),e&2){let i=t.$implicit;p("value",i),r(),v(i.name)}}function Kt(e,t){if(e&1&&(o(0,"mat-option",14),a(1),n()),e&2){let i=t.$implicit;p("value",i),r(),K("",i.name," (",i.sku,")")}}function Xt(e,t){if(e&1&&(o(0,"mat-option",14),a(1),n()),e&2){let i=t.$implicit;p("value",i),r(),v(i.name)}}function Yt(e,t){e&1&&(o(0,"div",45),d(1,"mat-progress-spinner",46),n())}function Zt(e,t){e&1&&(o(0,"th",47),a(1," Material "),n())}function te(e,t){if(e&1&&(o(0,"td",48)(1,"strong"),a(2),n(),d(3,"br"),o(4,"small"),a(5),n()()),e&2){let i=t.$implicit;r(2),v(i.materialName),r(3),v(i.sku)}}function ee(e,t){e&1&&(o(0,"th",47),a(1," Customer "),n())}function ie(e,t){if(e&1&&(o(0,"td",48),a(1),n()),e&2){let i=t.$implicit;r(),g(" ",i.accountName," ")}}function ne(e,t){e&1&&(o(0,"th",47),a(1," Supplier "),n())}function oe(e,t){if(e&1&&(o(0,"td",48),a(1),n()),e&2){let i=t.$implicit;r(),g(" ",i.supplierName," ")}}function ae(e,t){e&1&&(o(0,"th",47),a(1," Location "),n())}function re(e,t){if(e&1&&(o(0,"td",48)(1,"strong"),a(2),n(),d(3,"br"),o(4,"small"),a(5),n()()),e&2){let i=t.$implicit;r(2),v(i.location),r(3),v(i.room)}}function le(e,t){e&1&&(o(0,"th",49),a(1," Barcodes "),n())}function me(e,t){if(e&1&&(o(0,"td",48),a(1),d(2,"br"),a(3),n()),e&2){let i=t.$implicit;r(),g(" Pallet: ",i.palletBarcode," "),r(2),g(" LPN: ",i.lpnBarcode," ")}}function pe(e,t){e&1&&(o(0,"th",47),a(1," Batch "),n())}function ce(e,t){if(e&1&&(o(0,"td",48),a(1),n()),e&2){let i=t.$implicit;r(),g(" ",i.batchNumber," ")}}function se(e,t){e&1&&(o(0,"th",47),a(1," Expiry "),n())}function de(e,t){if(e&1&&(o(0,"td",48),a(1),M(2,"date"),n()),e&2){let i=t.$implicit;r(),g(" ",L(2,1,i.expiryDate,"shortDate")," ")}}function ue(e,t){e&1&&(o(0,"th",50),a(1," Qty "),n())}function fe(e,t){if(e&1&&(o(0,"td",51),a(1),M(2,"number"),n()),e&2){let i=t.$implicit;r(),g(" ",w(2,1,i.quantity)," ")}}function ge(e,t){e&1&&(o(0,"th",50),a(1," Weight (kg) "),n())}function he(e,t){if(e&1&&(o(0,"td",51),a(1),M(2,"number"),n()),e&2){let i=t.$implicit;r(),g(" ",L(2,1,i.weight,"1.2-2")," ")}}function Ce(e,t){e&1&&d(0,"tr",52)}function _e(e,t){e&1&&d(0,"tr",53)}function Se(e,t){if(e&1&&(o(0,"tr",54)(1,"td",55),a(2,"No data matching the filter criteria."),n()()),e&2){let i=J();r(),G("colspan",i.displayedColumns.length)}}var Gt=class e{fb=O(ft);http=O(nt);reportsApi=O(qt);paginator;sort;accountControl=new P(null);materialControl=new P(null);supplierControl=new P(null);filterForm=this.fb.group({accountId:[null],materialId:[null],supplierId:[null],batchNumber:[""],barcode:[""]});filterChange=new R;accounts=y([]);materials=y([]);suppliers=y([]);filteredAccounts$=this.accountControl.valueChanges.pipe(b(""),k(t=>this._filter(t,this.accounts())));filteredMaterials$=this.materialControl.valueChanges.pipe(b(""),k(t=>this._filter(t,this.materials(),!0)));filteredSuppliers$=this.supplierControl.valueChanges.pipe(b(""),k(t=>this._filter(t,this.suppliers())));isLoading=y(!0);resultsLength=y(0);dataSource=new Vt([]);displayedColumns=["materialName","accountName","supplierName","location","barcodes","batchNumber","expiryDate","quantity","weight"];ngOnInit(){this.loadLookups()}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),z(this.sort.sortChange,this.paginator.page,this.filterChange.pipe(W(300))).pipe(b({}),j(()=>{this.isLoading.set(!0),this.updateFilterFormIDs();let t=$({page:this.paginator.pageIndex+1,pageSize:this.paginator.pageSize,sortBy:this.sort.active,sortDirection:this.sort.direction||void 0},this.filterForm.value);return this.reportsApi.getStockOnHandReport(t).pipe(Q(()=>(console.error("Error fetching stock on hand data"),B(null))))}),k(t=>(this.isLoading.set(!1),t?(this.resultsLength.set(t.totalCount),t.items):(this.resultsLength.set(0),[])))).subscribe(t=>this.dataSource.data=t)}getDisplayName(t){return!t||typeof t=="string"?t||"":t.name}getMaterialDisplayName(t){return!t||typeof t=="string"?t||"":`${t.name} (${t.sku})`}_filter(t,i,l=!1){let m=(typeof t=="string"?t:t?.name||"").toLowerCase();return i.filter(s=>s.name.toLowerCase().includes(m)||l&&s.sku&&s.sku.toLowerCase().includes(m))}onOptionSelected(t,i){i.setValue(t.option.value.id)}updateFilterFormIDs(){this.filterForm.controls.accountId.setValue(this.getControlId(this.accountControl)),this.filterForm.controls.materialId.setValue(this.getControlId(this.materialControl)),this.filterForm.controls.supplierId.setValue(this.getControlId(this.supplierControl))}getControlId(t){let i=t.value;return i&&typeof i!="string"?i.id:null}applyFilters(){this.paginator.pageIndex=0,this.filterChange.next()}resetFilters(){this.filterForm.reset(),this.accountControl.reset(),this.materialControl.reset(),this.supplierControl.reset(),this.applyFilters()}loadLookups(){this.http.get(`${H.apiUrl}/Lookups/accounts`).subscribe(t=>{this.accounts.set(t),this.accountControl.updateValueAndValidity({emitEvent:!0})}),this.http.get(`${H.apiUrl}/Lookups/materials`).subscribe(t=>{this.materials.set(t),this.materialControl.updateValueAndValidity({emitEvent:!0})}),this.http.get(`${H.apiUrl}/Lookups/suppliers`).subscribe(t=>{this.suppliers.set(t),this.supplierControl.updateValueAndValidity({emitEvent:!0})})}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=q({type:e,selectors:[["app-stock-on-hand"]],viewQuery:function(i,l){if(i&1&&(A(I,5),A(T,5)),i&2){let m;N(m=F())&&(l.paginator=m.first),N(m=F())&&(l.sort=m.first)}},decls:94,vars:24,consts:[["accountAutoTrigger","matAutocompleteTrigger"],["accountAuto","matAutocomplete"],["materialAutoTrigger","matAutocompleteTrigger"],["materialAuto","matAutocomplete"],["supplierAutoTrigger","matAutocompleteTrigger"],["supplierAuto","matAutocomplete"],[1,"report-container"],[1,"header-section"],[1,"mat-headline-6"],[1,"mat-body-1"],[1,"filter-grid",3,"formGroup"],["appearance","outline",1,"custom-field"],["matInput","","placeholder","Select Account",3,"click","formControl","matAutocomplete"],[3,"displayWith"],[3,"value"],["matInput","","placeholder","Select Material",3,"click","formControl","matAutocomplete"],["matInput","","placeholder","Select Supplier",3,"click","formControl","matAutocomplete"],["matInput","","formControlName","batchNumber","placeholder","Enter Batch #"],["matInput","","formControlName","barcode","placeholder","Scan Barcode"],[1,"filter-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["mat-stroked-button",""],[1,"main-content-card"],[1,"table-wrapper"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","materialName"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","accountName"],["matColumnDef","supplierName"],["matColumnDef","location"],["matColumnDef","barcodes"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","batchNumber"],["matColumnDef","expiryDate"],["matColumnDef","quantity"],["mat-header-cell","","mat-sort-header","","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right",4,"matCellDef"],["matColumnDef","weight"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"length","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-header-cell","","mat-sort-header","",1,"align-right"],["mat-cell","",1,"align-right"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(i,l){if(i&1){let m=U();o(0,"div",6)(1,"div",7)(2,"div")(3,"h1",8),a(4,"Stock on Hand Report"),n(),o(5,"p",9),a(6,"A live snapshot of all inventory currently in storage."),n()()(),o(7,"div",10)(8,"mat-form-field",11)(9,"mat-label"),a(10,"Customer Account"),n(),o(11,"input",12,0),S("click",function(){C(m);let h=x(12);return _(h.openPanel())}),n(),o(13,"mat-autocomplete",13,1),D(15,Jt,2,2,"mat-option",14,V),M(17,"async"),n()(),o(18,"mat-form-field",11)(19,"mat-label"),a(20,"Material"),n(),o(21,"input",15,2),S("click",function(){C(m);let h=x(22);return _(h.openPanel())}),n(),o(23,"mat-autocomplete",13,3),D(25,Kt,2,3,"mat-option",14,V),M(27,"async"),n()(),o(28,"mat-form-field",11)(29,"mat-label"),a(30,"Supplier"),n(),o(31,"input",16,4),S("click",function(){C(m);let h=x(32);return _(h.openPanel())}),n(),o(33,"mat-autocomplete",13,5),D(35,Xt,2,2,"mat-option",14,V),M(37,"async"),n()(),o(38,"mat-form-field",11)(39,"mat-label"),a(40,"Batch Number"),n(),d(41,"input",17),n(),o(42,"mat-form-field",11)(43,"mat-label"),a(44,"Pallet or LPN Barcode"),n(),d(45,"input",18),n(),o(46,"div",19)(47,"button",20),S("click",function(){return C(m),_(l.resetFilters())}),a(48,"Clear"),n(),o(49,"button",21),S("click",function(){return C(m),_(l.applyFilters())}),o(50,"mat-icon"),a(51,"filter_list"),n(),o(52,"span"),a(53,"Apply"),n()(),o(54,"button",22)(55,"mat-icon"),a(56,"print"),n(),o(57,"span"),a(58,"Print"),n()()()(),o(59,"mat-card",23)(60,"div",24),c(61,Yt,2,0,"div",25),o(62,"table",26),S("matSortChange",function(){return C(m),_(l.applyFilters())}),u(63,27),c(64,Zt,2,0,"th",28)(65,te,6,2,"td",29),f(),u(66,30),c(67,ee,2,0,"th",28)(68,ie,2,1,"td",29),f(),u(69,31),c(70,ne,2,0,"th",28)(71,oe,2,1,"td",29),f(),u(72,32),c(73,ae,2,0,"th",28)(74,re,6,2,"td",29),f(),u(75,33),c(76,le,2,0,"th",34)(77,me,4,2,"td",29),f(),u(78,35),c(79,pe,2,0,"th",28)(80,ce,2,1,"td",29),f(),u(81,36),c(82,se,2,0,"th",28)(83,de,3,4,"td",29),f(),u(84,37),c(85,ue,2,0,"th",38)(86,fe,3,3,"td",39),f(),u(87,40),c(88,ge,2,0,"th",38)(89,he,3,4,"td",39),f(),c(90,Ce,1,0,"tr",41)(91,_e,1,0,"tr",42)(92,Se,3,1,"tr",43),n(),d(93,"mat-paginator",44),n()()()}if(i&2){let m=x(14),s=x(24),h=x(34);r(7),p("formGroup",l.filterForm),r(4),p("formControl",l.accountControl)("matAutocomplete",m),r(2),p("displayWith",l.getDisplayName),r(2),E(w(17,17,l.filteredAccounts$)),r(6),p("formControl",l.materialControl)("matAutocomplete",s),r(2),p("displayWith",l.getMaterialDisplayName),r(2),E(w(27,19,l.filteredMaterials$)),r(6),p("formControl",l.supplierControl)("matAutocomplete",h),r(2),p("displayWith",l.getDisplayName),r(2),E(w(37,21,l.filteredSuppliers$)),r(26),p("ngIf",l.isLoading()),r(),p("dataSource",l.dataSource),r(28),p("matHeaderRowDef",l.displayedColumns)("matHeaderRowDefSticky",!0),r(),p("matRowDefColumns",l.displayedColumns),r(2),p("length",l.resultsLength())("pageSizeOptions",X(23,Ut))}},dependencies:[it,Y,gt,mt,pt,ct,st,dt,ut,yt,Mt,_t,Ct,ht,xt,St,lt,rt,at,ot,Lt,wt,Dt,It,Et,Ot,Tt,Ht,Pt,At,Nt,Ft,Qt,I,jt,T,Wt,bt,kt,zt,Rt,vt,Bt,$t,Z,et,tt],styles:["[_nghost-%COMP%]{display:block}.report-container[_ngcontent-%COMP%]{padding:1.5rem 2.5rem;max-width:1600px;margin:0 auto;display:grid;gap:2rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:1rem;border-bottom:1px solid var(--mat-sys-outline-variant)}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.75rem}.header-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant);margin-top:4px}.filter-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1.5rem;align-items:start}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{width:100%;margin-bottom:0}.filter-grid[_ngcontent-%COMP%]   .custom-field.date-field[_ngcontent-%COMP%]{width:100%}.filter-actions[_ngcontent-%COMP%]{grid-column:4;display:flex;justify-content:flex-end;align-items:center;gap:.5rem;height:42px;margin-top:4px}.filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:100%}.main-content-card[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);box-shadow:0 4px 6px -1px #0000000d,0 2px 4px -2px #0000000d;border-radius:8px;padding:0;overflow:hidden;background:var(--mat-sys-surface)}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td.mat-cell[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{padding:0 1rem;border-bottom-color:var(--mat-sys-outline-variant)}table[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.5px;color:var(--mat-sys-on-surface-variant);height:48px;background-color:var(--mat-sys-surface-container-lowest)}table[_ngcontent-%COMP%]   td.mat-cell[_ngcontent-%COMP%]{font-size:.875rem;height:48px;color:var(--mat-sys-on-surface)}tr.mat-row[_ngcontent-%COMP%]:hover{background-color:var(--mat-sys-surface-container-high)}.align-right[_ngcontent-%COMP%]{text-align:right}.spinner-overlay[_ngcontent-%COMP%], .mat-row[matNoDataRow][_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fffc;display:flex;justify-content:center;align-items:center;z-index:5;font-style:italic;color:var(--mat-sys-on-surface-variant);padding:.5rem}  .custom-field{width:100%}  .custom-field .mat-mdc-text-field-wrapper{height:42px!important;padding:0 12px!important;background-color:#fff!important}  .custom-field .mat-mdc-form-field-flex{height:100%!important;align-items:center!important;padding:0!important}  .custom-field .mat-mdc-form-field-infix{padding:0!important;min-height:unset!important;border-top:0!important;width:auto!important}  .custom-field .mat-mdc-input-element{padding:0!important;margin:0!important;top:0!important;position:relative!important;font-size:.9rem!important;line-height:42px!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-prefix{padding:0 8px 0 0!important;display:flex!important;align-items:center!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-prefix .mat-icon{font-size:18px;width:18px;height:18px}  .custom-field .mat-mdc-form-field-icon-suffix{padding:0 0 0 8px!important;display:flex!important;align-items:center!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-suffix .mat-icon{font-size:18px;width:18px;height:18px}  .custom-field .mat-mdc-form-field-icon-suffix .mat-datepicker-toggle-default-icon{width:18px;height:18px}  .custom-field .mat-mdc-form-field-icon-suffix button.mat-icon-button{width:24px;height:24px;line-height:24px;padding:0}  .custom-field .mat-mdc-form-field-subscript-wrapper{display:none}  .custom-field .mdc-line-ripple{display:none}"]})};export{Gt as StockOnHandComponent};
