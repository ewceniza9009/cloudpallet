import{a as Je}from"./chunk-MKXLXLYI.js";import{a as I,b as Ue,c as qe}from"./chunk-DMQH6NGV.js";import{a as E,b as We}from"./chunk-OKTGWPHL.js";import{a as xe,b as be,c as we,d as Ve,e as Ee,f as Ie,g as Pe,h as ke,i as Oe,j as Te,k as Ae,l as Fe}from"./chunk-GEIZTYKY.js";import{c as Be,d as Qe,e as He,f as ze,g as je,h as Ge}from"./chunk-QUVVE6QU.js";import{a as Ne,b as Le,c as Re}from"./chunk-SVUTEW5N.js";import{a as $e}from"./chunk-WZ6CNNTO.js";import"./chunk-CICF6LUS.js";import"./chunk-WSA7XW7T.js";import"./chunk-MS4AQ6UA.js";import{d as ye}from"./chunk-JD7VERCS.js";import"./chunk-S7GFW5PD.js";import{b as _e,c as he}from"./chunk-7T4FYH4B.js";import{b as ue,f as fe,i as Ce,j as ge}from"./chunk-NRJELJJX.js";import"./chunk-HRGWCUCI.js";import"./chunk-YC3EYHS2.js";import"./chunk-LOWV2IZF.js";import"./chunk-JYCF7ZPK.js";import{b as oe,g as re,h as le,j as N,n as me,o as ce,r as pe,u as de,w as se}from"./chunk-33GO6BEM.js";import"./chunk-RZ3EY26M.js";import"./chunk-5JMQ54DL.js";import{p as ne,q as ae}from"./chunk-AFJ6IJZO.js";import{a as De,b as Se}from"./chunk-67FWL4YT.js";import"./chunk-VD2AZ2LQ.js";import{a as F}from"./chunk-LWYKMW7M.js";import{a as ve,i as Me}from"./chunk-TFYOF5WW.js";import"./chunk-ZKJQ6NKM.js";import{H as te,I as ie}from"./chunk-6GGLSGMC.js";import{B as ee,j as J,m as K,o as X,q as Y,t as Z}from"./chunk-GEABFLPO.js";import{A as R,Cc as U,G as $,Gc as S,Hc as V,Ib as H,Ic as q,Nb as P,Ob as k,Pb as c,Qb as a,Rb as n,Sb as s,V as b,W as B,Wb as g,Xb as _,Zb as z,cb as r,cc as h,ec as j,f as L,ga as w,ic as O,jc as T,kc as A,la as f,ma as C,oc as v,pb as Q,qc as G,r as x,sc as l,tc as M,uc as D,va as y,vb as d,vc as W}from"./chunk-FZDPWNP7.js";import"./chunk-AP4OEWII.js";var Ye=()=>[10,20,50,100],Ke=(t,e)=>e.id;function Ze(t,e){if(t&1&&(a(0,"mat-option",18),l(1),n()),t&2){let i=e.$implicit;c("value",i),r(),M(i.name)}}function et(t,e){if(t&1&&(a(0,"mat-option",18),l(1),n()),t&2){let i=e.$implicit;c("value",i),r(),M(i.name)}}function tt(t,e){t&1&&(a(0,"div",44),s(1,"mat-progress-spinner",45),n())}function it(t,e){t&1&&(a(0,"th",46),l(1," Date "),n())}function nt(t,e){if(t&1&&(a(0,"td",47),l(1),S(2,"date"),n()),t&2){let i=e.$implicit;r(),D(" ",q(2,1,i.timestamp,"short")," ")}}function at(t,e){t&1&&(a(0,"th",46),l(1," Material "),n())}function ot(t,e){if(t&1&&(a(0,"td",47)(1,"div",48)(2,"span",49),l(3),n(),a(4,"span",50),l(5),n()()()),t&2){let i=e.$implicit;r(3),M(i.materialName),r(2),M(i.sku)}}function rt(t,e){t&1&&(a(0,"th",46),l(1," Location "),n())}function lt(t,e){if(t&1&&(a(0,"td",47),l(1),n()),t&2){let i=e.$implicit;r(),D(" ",i.locationName," ")}}function mt(t,e){t&1&&(a(0,"th",51),l(1," Pallet "),n())}function ct(t,e){if(t&1&&(a(0,"td",47),l(1),n()),t&2){let i=e.$implicit;r(),D(" ",i.palletBarcode," ")}}function pt(t,e){t&1&&(a(0,"th",52),l(1," Variance "),n())}function dt(t,e){if(t&1&&(a(0,"td",53)(1,"span",54),l(2),S(3,"number"),n()()),t&2){let i=e.$implicit;r(),G("positive",i.varianceQuantity>0)("negative",i.varianceQuantity<0),r(),W(" ",i.varianceQuantity>0?"+":"","",V(3,6,i.varianceQuantity)," ")}}function st(t,e){t&1&&(a(0,"th",46),l(1," User "),n())}function ut(t,e){if(t&1&&(a(0,"td",47),l(1),n()),t&2){let i=e.$implicit;r(),D(" ",i.userName," ")}}function ft(t,e){t&1&&s(0,"tr",55)}function Ct(t,e){t&1&&s(0,"tr",56)}function gt(t,e){if(t&1&&(a(0,"tr",57)(1,"td",58),l(2,"No variances found matching the criteria."),n()()),t&2){let i=j();r(),H("colspan",i.displayedColumns.length)}}var Xe=class t{fb=w(de);http=w(ee);reportsApi=w(Je);paginator;sort;accountControl=new N(null);materialControl=new N(null);filterForm=this.fb.group({startDate:[null],endDate:[null],accountId:[null],materialId:[null]});filterChange=new L;accounts=y([]);materials=y([]);filteredAccounts$=this.accountControl.valueChanges.pipe(b(""),x(e=>this._filter(e,this.accounts())));filteredMaterials$=this.materialControl.valueChanges.pipe(b(""),x(e=>this._filter(e,this.materials())));isLoading=y(!0);resultsLength=y(0);data=y([]);displayedColumns=["timestamp","materialName","locationName","palletBarcode","varianceQuantity","userName"];ngOnInit(){this.loadLookups()}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),R(this.sort.sortChange,this.paginator.page,this.filterChange.pipe($(400))).pipe(b({}),B(()=>{this.isLoading.set(!0),this.updateFilterFormIDs();let e=this.filterForm.value;return this.reportsApi.getCycleCountVariances({page:this.paginator.pageIndex+1,pageSize:this.paginator.pageSize,sortBy:this.sort.active,sortDirection:this.sort.direction||void 0,startDate:e.startDate?e.startDate.toISOString():void 0,endDate:e.endDate?e.endDate.toISOString():void 0,accountId:e.accountId??void 0,materialId:e.materialId??void 0})}),x(e=>(this.isLoading.set(!1),this.resultsLength.set(e.totalCount),e.items))).subscribe(e=>this.data.set(e))}getDisplayName(e){return!e||typeof e=="string"?e||"":e.name}_filter(e,i){let o=(typeof e=="string"?e:e?.name||"").toLowerCase();return i.filter(m=>m.name.toLowerCase().includes(o))}onOptionSelected(e,i){let o=e.option.value;i.setValue(o.id)}updateFilterFormIDs(){this.filterForm.controls.accountId.setValue(this.getControlId(this.accountControl)),this.filterForm.controls.materialId.setValue(this.getControlId(this.materialControl))}getControlId(e){let i=e.value;return i&&typeof i!="string"?i.id:null}applyFilters(){this.paginator.pageIndex=0,this.filterChange.next()}resetFilters(){this.filterForm.reset(),this.accountControl.reset(),this.materialControl.reset(),this.filterChange.next()}loadLookups(){this.http.get(`${F.apiUrl}/Lookups/accounts`).subscribe(e=>{this.accounts.set(e),this.accountControl.updateValueAndValidity({emitEvent:!0})}),this.http.get(`${F.apiUrl}/Lookups/materials`).subscribe(e=>{this.materials.set(e),this.materialControl.updateValueAndValidity({emitEvent:!0})})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Q({type:t,selectors:[["app-cycle-count-variance"]],viewQuery:function(i,o){if(i&1&&(O(E,5),O(I,5)),i&2){let m;T(m=A())&&(o.paginator=m.first),T(m=A())&&(o.sort=m.first)}},decls:73,vars:21,consts:[["picker",""],["accountAutoTrigger","matAutocompleteTrigger"],["accountAuto","matAutocomplete"],["materialAutoTrigger","matAutocompleteTrigger"],["materialAuto","matAutocomplete"],[1,"report-container"],[1,"header-section"],[1,"mat-headline-6"],[1,"mat-body-1"],[1,"filter-grid"],["appearance","outline",1,"custom-field","date-field"],[3,"formGroup"],["matStartDate","","formControlName","startDate","placeholder","Start date"],["matEndDate","","formControlName","endDate","placeholder","End date"],["matSuffix","",3,"for"],["appearance","outline",1,"custom-field"],["matInput","","placeholder","Select Account",3,"click","formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value"],["type","hidden","formControlName","accountId"],["matInput","","placeholder","Select Material",3,"click","formControl","matAutocomplete"],["type","hidden","formControlName","materialId"],[1,"filter-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"main-content-card"],[1,"table-wrapper"],["class","spinner-overlay",4,"ngIf"],["mat-table","","matSort","",3,"dataSource","matSortActive","matSortDirection"],["matColumnDef","timestamp"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","materialName"],["matColumnDef","locationName"],["matColumnDef","palletBarcode"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","varianceQuantity"],["mat-header-cell","","mat-sort-header","","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right",4,"matCellDef"],["matColumnDef","userName"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"length","pageSizeOptions"],[1,"spinner-overlay"],["mode","indeterminate"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"cell-content"],[1,"primary-text"],[1,"secondary-text"],["mat-header-cell",""],["mat-header-cell","","mat-sort-header","",1,"align-right"],["mat-cell","",1,"align-right"],[1,"variance-badge"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(i,o){if(i&1){let m=z();a(0,"div",5)(1,"div",6)(2,"div")(3,"h1",7),l(4,"Cycle Count Variance Report"),n(),a(5,"p",8),l(6,"Review discrepancies found during physical inventory counts."),n()()(),a(7,"div",9)(8,"mat-form-field",10)(9,"mat-label"),l(10,"Date Range"),n(),a(11,"mat-date-range-input",11),s(12,"input",12)(13,"input",13),n(),s(14,"mat-datepicker-toggle",14)(15,"mat-date-range-picker",null,0),n(),a(17,"mat-form-field",15)(18,"mat-label"),l(19,"Customer Account"),n(),a(20,"input",16,1),h("click",function(){f(m);let p=v(21);return C(p.openPanel())}),n(),a(22,"mat-autocomplete",17,2),h("optionSelected",function(p){return f(m),C(o.onOptionSelected(p,o.filterForm.controls.accountId))}),P(24,Ze,2,2,"mat-option",18,Ke),S(26,"async"),n(),s(27,"input",19),n(),a(28,"mat-form-field",15)(29,"mat-label"),l(30,"Material"),n(),a(31,"input",20,3),h("click",function(){f(m);let p=v(32);return C(p.openPanel())}),n(),a(33,"mat-autocomplete",17,4),h("optionSelected",function(p){return f(m),C(o.onOptionSelected(p,o.filterForm.controls.materialId))}),P(35,et,2,2,"mat-option",18,Ke),S(37,"async"),n(),s(38,"input",21),n(),a(39,"div",22)(40,"button",23),h("click",function(){return f(m),C(o.resetFilters())}),l(41,"Clear"),n(),a(42,"button",24),h("click",function(){return f(m),C(o.applyFilters())}),a(43,"mat-icon"),l(44,"filter_list"),n(),a(45,"span"),l(46,"Apply"),n()()()(),a(47,"mat-card",25)(48,"div",26),d(49,tt,2,0,"div",27),a(50,"table",28),g(51,29),d(52,it,2,0,"th",30)(53,nt,3,4,"td",31),_(),g(54,32),d(55,at,2,0,"th",30)(56,ot,6,2,"td",31),_(),g(57,33),d(58,rt,2,0,"th",30)(59,lt,2,1,"td",31),_(),g(60,34),d(61,mt,2,0,"th",35)(62,ct,2,1,"td",31),_(),g(63,36),d(64,pt,2,0,"th",37)(65,dt,4,8,"td",38),_(),g(66,39),d(67,st,2,0,"th",30)(68,ut,2,1,"td",31),_(),d(69,ft,1,0,"tr",40)(70,Ct,1,0,"tr",41)(71,gt,3,1,"tr",42),n(),s(72,"mat-paginator",43),n()()()}if(i&2){let m=v(16),u=v(23),p=v(34);r(11),c("formGroup",o.filterForm),r(3),c("for",m),r(6),c("formControl",o.accountControl)("matAutocomplete",u),r(2),c("displayWith",o.getDisplayName),r(2),k(V(26,16,o.filteredAccounts$)),r(7),c("formControl",o.materialControl)("matAutocomplete",p),r(2),c("displayWith",o.getDisplayName),r(2),k(V(37,18,o.filteredMaterials$)),r(14),c("ngIf",o.isLoading()),r(),c("dataSource",o.data())("matSortActive","timestamp")("matSortDirection","desc"),r(19),c("matHeaderRowDef",o.displayedColumns),r(),c("matRowDefColumns",o.displayedColumns),r(2),c("length",o.resultsLength())("pageSizeOptions",U(20,Ye))}},dependencies:[Z,J,se,oe,re,le,me,ce,pe,Me,ve,ge,Ce,ue,fe,he,_e,ae,ne,ie,te,Ge,Be,Qe,He,ze,je,Fe,xe,we,Pe,Ve,be,ke,Ee,Ie,Oe,Te,Ae,We,E,qe,I,Ue,Se,De,$e,Re,Ne,ye,Le,K,Y,X],styles:[".report-container[_ngcontent-%COMP%]{padding:24px;max-width:1600px;margin:0 auto}.header-section[_ngcontent-%COMP%]{margin-bottom:24px}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#1a1f36;font-weight:500}.header-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0 0;color:#697386}.filter-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px;align-items:start}.filter-grid[_ngcontent-%COMP%]   .date-field[_ngcontent-%COMP%]{grid-column:span 2}.filter-grid[_ngcontent-%COMP%]   .filter-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding-top:4px;justify-content:flex-end;grid-column:span 2}.main-content-card[_ngcontent-%COMP%]{padding:0;overflow:hidden;border-radius:8px;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f}.table-wrapper[_ngcontent-%COMP%]{position:relative;min-height:200px;overflow-x:auto}.spinner-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffb3;z-index:10;display:flex;align-items:center;justify-content:center}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{background-color:#f7fafc;color:#4a5568;font-weight:600;font-size:.875rem;padding:16px;border-bottom:1px solid #e2e8f0}table[_ngcontent-%COMP%]   td.mat-cell[_ngcontent-%COMP%]{padding:16px;color:#2d3748;border-bottom:1px solid #edf2f7;font-size:.875rem}table[_ngcontent-%COMP%]   tr.mat-row[_ngcontent-%COMP%]:hover{background-color:#f8fafc}.cell-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.cell-content[_ngcontent-%COMP%]   .primary-text[_ngcontent-%COMP%]{font-weight:500;color:#2d3748}.cell-content[_ngcontent-%COMP%]   .secondary-text[_ngcontent-%COMP%]{font-size:.75rem;color:#718096}.align-right[_ngcontent-%COMP%]{text-align:right;justify-content:flex-end}.variance-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:16px;font-weight:600;font-size:.875rem}.variance-badge.positive[_ngcontent-%COMP%]{background-color:#e6fffa;color:#2c7a7b}.variance-badge.negative[_ngcontent-%COMP%]{background-color:#fff5f5;color:#c53030}"]})};export{Xe as CycleCountVarianceComponent};
