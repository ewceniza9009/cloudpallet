import{a as dt,b as mt,c as ct,h as pt}from"./chunk-UYAPIC3O.js";import{a as at,b as rt,c as lt}from"./chunk-Q74Q4XXZ.js";import{a as st}from"./chunk-D743XRKB.js";import"./chunk-OUNZMEYF.js";import"./chunk-JJ2A35WS.js";import"./chunk-MS4AQ6UA.js";import{d as pe,h as Ge,i as We}from"./chunk-AR7DOULP.js";import{a as fe,b as it,c as ot,f as ge,h as _e}from"./chunk-T7FV3XRB.js";import{a as oe,b as ae,c as Ue,d as re,e as le,f as se,h as de}from"./chunk-CFEBTJKT.js";import"./chunk-HQHXVMDV.js";import"./chunk-E4XFWEKX.js";import{b as me,c as ce}from"./chunk-JJ4H6OAC.js";import{b as N,d as qe,f as ze,i as V,j as $}from"./chunk-XOBVZ7HT.js";import"./chunk-PVDG46DZ.js";import{a as Qe}from"./chunk-FTTQQNBZ.js";import{a as ue,b as nt}from"./chunk-YNYX5A3H.js";import"./chunk-LJS4T7OK.js";import"./chunk-3AIDC2CP.js";import"./chunk-ISLNSOXI.js";import{b as X,d as Y,g as L,h as Z,j as ke,l as ee,m as Ve,n as $e,o as te,p as je,q as Be,r as ne,s as Re,u as ie,w as F}from"./chunk-OPXM5N2G.js";import"./chunk-2ATSTUKT.js";import{m as J,o as T,p as A}from"./chunk-362WG5KS.js";import{a as j,b as B}from"./chunk-JQRCIVV7.js";import{a as He}from"./chunk-SVDPSKVI.js";import{a as k}from"./chunk-2G4RJFBR.js";import{a as Ke,b as Je,c as Xe,d as Ze,f as et,i as tt}from"./chunk-BKLGZBQH.js";import{G as P,H as E}from"./chunk-PPJHYCVS.js";import{A as H,C as K,m as Fe,o as Ne,t as w}from"./chunk-DHGPXNCW.js";import{$b as W,Aa as f,Bc as Ye,C as we,H as Pe,Lc as q,Mc as Le,Nc as Se,Ob as h,Pb as M,Rb as Ae,Sb as v,Tb as b,Ub as c,Vb as n,Wb as i,Wc as z,Xb as x,Xc as De,_ as Ee,a as Me,ac as Q,b as xe,cc as S,da as be,ga as Te,hb as s,hc as p,jc as u,la as m,qa as _,ra as C,tc as U,ub as O,w as ve,wa as ye,xc as r,yc as y,zc as I}from"./chunk-N46UG6V3.js";function Oe(o,e){let a=!e?.manualCleanup?e?.injector?.get(ye)??m(ye):null,l=xt(e?.equal),d;e?.requireSync?d=f({kind:0},{equal:l}):d=f({kind:1,value:e?.initialValue},{equal:l});let R,G=o.subscribe({next:g=>d.set({kind:1,value:g}),error:g=>{d.set({kind:2,error:g}),R?.()},complete:()=>{R?.()}});if(e?.requireSync&&d().kind===0)throw new be(601,!1);return R=a?.onDestroy(G.unsubscribe.bind(G)),z(()=>{let g=d();switch(g.kind){case 1:return g.value;case 2:throw g.error;case 0:throw new be(601,!1)}},{equal:e?.equal})}function xt(o=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&o(e.value,t.value)}var D=class o{http=m(K);warehouseState=m(He);apiUrl=`${k.apiUrl}/Yard`;getTodaysAppointments(e,t){let a=this.warehouseState.selectedWarehouseId();if(!a)throw new Error("Warehouse not selected");let l=new H().set("warehouseId",a).set("startDate",e).set("endDate",t);return this.http.get(`${this.apiUrl}/appointments/today`,{params:l})}checkInTruck(e,t){let a={truckId:e,yardSpotId:t};return this.http.post(`${this.apiUrl}/check-in`,a)}getAvailableYardSpots(){let e=this.warehouseState.selectedWarehouseId();if(!e)throw new Error("Warehouse not selected");let t=new H().set("warehouseId",e);return this.http.get(`${k.apiUrl}/Lookups/available-yard-spots`,{params:t})}getOccupiedYardSpots(){let e=this.warehouseState.selectedWarehouseId();if(!e)throw new Error("Warehouse not selected");let t=new H().set("warehouseId",e);return this.http.get(`${this.apiUrl}/occupied-spots`,{params:t})}moveTruckToDock(e,t){let a={yardSpotId:e,appointmentId:t};return this.http.post(`${this.apiUrl}/move-to-dock`,a)}vacateYardSpot(e){let t={yardSpotId:e};return this.http.post(`${this.apiUrl}/vacate-spot`,t)}getManifest(e){return this.http.get(`${k.apiUrl}/Manifests/by-appointment/${e}`)}createManifest(e){return this.http.post(`${k.apiUrl}/Manifests`,e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=Te({token:o,factory:o.\u0275fac,providedIn:"root"})};var yt=(o,e)=>e.id;function St(o,e){o&1&&(n(0,"div",4),x(1,"mat-progress-spinner",9),i())}function Dt(o,e){if(o&1&&(n(0,"mat-option",12),r(1),i()),o&2){let t=e.$implicit;c("value",t.id),s(),y(t.spotNumber)}}function kt(o,e){o&1&&(n(0,"mat-hint"),r(1,"No available yard spots found."),i())}function Ot(o,e){if(o&1&&(n(0,"form",5)(1,"mat-form-field",10)(2,"mat-label"),r(3,"Available Yard Spots"),i(),n(4,"mat-select",11),v(5,Dt,2,2,"mat-option",12,yt),i(),h(7,kt,2,0,"mat-hint"),i()()),o&2){let t=u();c("formGroup",t.form),s(5),b(t.spots()),s(2),M(t.spots().length===0?7:-1)}}var Ce=class o{fb=m(ie);yardApi=m(D);dialogRef=m(fe);spots=f([]);isLoading=f(!0);form=this.fb.group({yardSpotId:["",Y.required]});ngOnInit(){this.yardApi.getAvailableYardSpots().subscribe({next:e=>{this.spots.set(e),this.isLoading.set(!1)},error:()=>this.isLoading.set(!1)})}onConfirm(){this.form.valid&&this.dialogRef.close(this.form.value.yardSpotId)}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=O({type:o,selectors:[["app-select-yard-spot-dialog"]],decls:15,vars:2,consts:[[1,"dialog-container"],[1,"dialog-header"],["mat-icon-button","",3,"click"],[1,"dialog-content"],[1,"spinner-container"],[3,"formGroup"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["mode","indeterminate","diameter","40"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","yardSpotId"],[3,"value"]],template:function(t,a){t&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),r(3,"Select Yard Spot"),i(),n(4,"button",2),p("click",function(){return a.onCancel()}),n(5,"mat-icon"),r(6,"close"),i()()(),n(7,"mat-dialog-content",3),h(8,St,2,0,"div",4)(9,Ot,8,2,"form",5),i(),n(10,"div",6)(11,"button",7),p("click",function(){return a.onCancel()}),r(12,"Cancel"),i(),n(13,"button",8),p("click",function(){return a.onConfirm()}),r(14," Confirm Check-In "),i()()()),t&2&&(s(8),M(a.isLoading()?8:9),s(5),c("disabled",a.form.invalid))},dependencies:[w,F,ee,L,Z,te,ne,_e,ge,A,T,J,$,V,N,qe,We,Ge,pe,B,j,E,P],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:400px;background:#fff}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 1.5rem 1rem;border-bottom:1px solid #e2e8f0}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:#0f172a}.dialog-content[_ngcontent-%COMP%]{padding:1.5rem!important;display:flex;flex-direction:column;gap:1.5rem}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.dialog-actions[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:.75rem;background:#f8fafc}"]})};var Et=(o,e)=>e.materialId,Tt=(o,e)=>e.id;function At(o,e){o&1&&(n(0,"div",6),x(1,"mat-progress-spinner",12),i())}function Yt(o,e){if(o&1&&(n(0,"mat-list-item")(1,"mat-icon",18),r(2,"inventory_2"),i(),n(3,"div",19),r(4),i(),n(5,"div",20),r(6),i()()),o&2){let t=e.$implicit;s(4),y(t.materialName),s(2),I("Quantity: ",t.expectedQuantity)}}function Lt(o,e){if(o&1&&(n(0,"div",7)(1,"div",13)(2,"span",14),r(3,"Manifest ID:"),i(),n(4,"span",15),r(5),i()(),n(6,"h3",16),r(7,"Items"),i(),n(8,"mat-list",17),v(9,Yt,7,2,"mat-list-item",null,Et),i()()),o&2){let t,a,l=u();s(5),y((t=l.existingManifest())==null?null:t.id),s(4),b((a=l.existingManifest())==null?null:a.lines)}}function Ft(o,e){if(o&1&&(n(0,"mat-option",27),r(1),i()),o&2){let t=e.$implicit;c("value",t),s(),y(t.name)}}function Nt(o,e){if(o&1){let t=S();n(0,"div",22)(1,"mat-form-field",24)(2,"mat-label"),r(3,"Material"),i(),n(4,"input",25,0),p("click",function(){_(t);let l=U(5);return C(l.openPanel())}),i(),n(6,"mat-autocomplete",26,1),v(8,Ft,2,2,"mat-option",27,Tt),q(10,"async"),i()(),n(11,"mat-form-field",28)(12,"mat-label"),r(13,"Qty"),i(),x(14,"input",29),i(),n(15,"button",30),p("click",function(){let l=_(t).$index,d=u(2);return C(d.removeLine(l))}),n(16,"mat-icon"),r(17,"delete_outline"),i()()()}if(o&2){let t=e.$index,a=U(7),l=u(2);c("formGroupName",t),s(4),c("matAutocomplete",a),s(2),c("displayWith",l.displayFn),s(2),b(Le(10,4,l.filteredMaterials[t])),s(7),c("disabled",l.lines.length===1)}}function Vt(o,e){if(o&1){let t=S();n(0,"form",8)(1,"div",21),v(2,Nt,18,6,"div",22,Ae),i(),n(4,"button",23),p("click",function(){_(t);let l=u();return C(l.addLine())}),n(5,"mat-icon"),r(6,"add"),i(),r(7," Add Line "),i()()}if(o&2){let t=u();c("formGroup",t.form),s(2),b(t.lines.controls)}}function $t(o,e){o&1&&(W(0),n(1,"mat-icon"),r(2,"hourglass_empty"),i(),n(3,"span"),r(4,"Saving..."),i(),Q())}function jt(o,e){o&1&&r(0," Save Manifest ")}function Bt(o,e){if(o&1){let t=S();n(0,"button",31),p("click",function(){_(t);let l=u();return C(l.save())}),h(1,$t,5,0,"ng-container")(2,jt,1,0),i()}if(o&2){let t=u();c("disabled",t.form.invalid||t.isSaving()),s(),M(t.isSaving()?1:2)}}var he=class o{fb=m(ie);yardApi=m(D);http=m(K);snackBar=m(ue);dialogRef=m(fe);data=m(it);appointmentId=this.data.appointmentId;existingManifest=f(null);isLoading=f(!0);isSaving=f(!1);form=this.fb.group({lines:this.fb.array([])});materials=[];filteredMaterials=[];get lines(){return this.form.get("lines")}ngOnInit(){this.loadMaterials().subscribe(()=>{this.loadManifest()})}loadMaterials(){return this.http.get(`${k.apiUrl}/Lookups/materials`).pipe(ve(e=>{this.materials=e}))}loadManifest(){this.yardApi.getManifest(this.appointmentId).subscribe({next:e=>{this.existingManifest.set(e),this.isLoading.set(!1)},error:e=>{this.isLoading.set(!1),this.addLine()}})}addLine(){let e=this.fb.group({material:["",Y.required],quantity:[1,[Y.required,Y.min(1)]]});this.lines.push(e),this.manageAutocomplete(this.lines.length-1)}removeLine(e){this.lines.removeAt(e),this.filteredMaterials.splice(e,1)}manageAutocomplete(e){let t=this.lines.at(e).get("material");t&&(this.filteredMaterials[e]=t.valueChanges.pipe(Ee(""),ve(a=>{let l=typeof a=="string"?a:a?.name;return l?this._filter(l):this.materials.slice()})))}_filter(e){let t=e.toLowerCase();return this.materials.filter(a=>a.name.toLowerCase().includes(t))}displayFn(e){return e&&e.name?e.name:""}save(){if(this.form.invalid)return;this.isSaving.set(!0);let e=this.form.value,t={appointmentId:this.appointmentId,lines:e.lines.map(a=>({materialId:a.material.id,expectedQuantity:a.quantity}))};this.yardApi.createManifest(t).subscribe({next:()=>{this.snackBar.open("Manifest created successfully","OK",{duration:3e3}),this.dialogRef.close(!0)},error:a=>{this.snackBar.open("Failed to create manifest","Close",{duration:5e3}),this.isSaving.set(!1)}})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=O({type:o,selectors:[["app-add-manifest-dialog"]],decls:15,vars:2,consts:[["trigger","matAutocompleteTrigger"],["auto","matAutocomplete"],[1,"dialog-container"],[1,"dialog-header"],["mat-icon-button","",3,"click"],[1,"dialog-content"],[1,"spinner-container"],[1,"manifest-details"],[3,"formGroup"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"disabled"],["mode","indeterminate","diameter","40"],[1,"manifest-info"],[1,"label"],[1,"value"],[1,"section-title"],[1,"compact-list"],["matListItemIcon","",1,"list-icon"],["matListItemTitle","",1,"item-title"],["matListItemLine","",1,"item-subtitle"],["formArrayName","lines",1,"lines-container"],[1,"line-item",3,"formGroupName"],["mat-stroked-button","","color","primary",1,"add-line-btn",3,"click"],["appearance","outline","subscriptSizing","dynamic",1,"material-field"],["type","text","matInput","","formControlName","material",3,"click","matAutocomplete"],[3,"displayWith"],[3,"value"],["appearance","outline","subscriptSizing","dynamic",1,"qty-field"],["matInput","","type","number","formControlName","quantity","min","1"],["mat-icon-button","","color","warn",1,"delete-btn",3,"click","disabled"],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(t,a){t&1&&(n(0,"div",2)(1,"div",3)(2,"h2"),r(3,"Cargo Manifest"),i(),n(4,"button",4),p("click",function(){return a.close()}),n(5,"mat-icon"),r(6,"close"),i()()(),n(7,"mat-dialog-content",5),h(8,At,2,0,"div",6)(9,Lt,11,1,"div",7)(10,Vt,8,1,"form",8),i(),n(11,"div",9)(12,"button",10),p("click",function(){return a.close()}),r(13,"Close"),i(),h(14,Bt,3,2,"button",11),i()()),t&2&&(s(8),M(a.isLoading()?8:a.existingManifest()?9:10),s(6),M(!a.existingManifest()&&!a.isLoading()?14:-1))},dependencies:[w,F,ee,X,Ve,L,Z,Re,te,ne,je,Be,_e,ge,A,T,J,$,V,N,ce,me,E,P,de,le,se,re,ae,oe,lt,at,pe,rt,B,j,Fe],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:500px;max-width:800px;background:#fff;max-height:80vh}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 1.5rem;border-bottom:1px solid #e2e8f0}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:#0f172a}.dialog-content[_ngcontent-%COMP%]{padding:1.5rem!important;display:flex;flex-direction:column;gap:1.5rem;overflow-y:auto}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem}.manifest-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.manifest-details[_ngcontent-%COMP%]   .manifest-info[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;font-size:.9rem;color:#64748b}.manifest-details[_ngcontent-%COMP%]   .manifest-info[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500;color:#0f172a}.manifest-details[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin:1rem 0 .5rem;font-size:1rem;font-weight:600;color:#0f172a}.compact-list[_ngcontent-%COMP%]   .mat-list-item[_ngcontent-%COMP%]{height:auto!important;padding:.5rem 0}.compact-list[_ngcontent-%COMP%]   .list-icon[_ngcontent-%COMP%]{color:#0f766e}.compact-list[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{font-weight:500;font-size:.95rem}.compact-list[_ngcontent-%COMP%]   .item-subtitle[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.lines-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.line-item[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.line-item[_ngcontent-%COMP%]   .material-field[_ngcontent-%COMP%]{flex:1}.line-item[_ngcontent-%COMP%]   .qty-field[_ngcontent-%COMP%]{width:100px}.line-item[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{margin-top:4px;color:#64748b}.line-item[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{color:#ef4444}.add-line-btn[_ngcontent-%COMP%]{align-self:flex-start}.dialog-actions[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:.75rem;background:#f8fafc}"]})};var Rt=(o,e)=>e.yardSpotId,Ut=(o,e)=>e.appointmentId;function qt(o,e){o&1&&(n(0,"div",5),x(1,"mat-progress-spinner",7),n(2,"p"),r(3,"Loading Yard Data..."),i()())}function zt(o,e){if(o&1){let t=S();n(0,"mat-list-item",14)(1,"mat-icon",22),r(2,"local_parking"),i(),n(3,"div",23),r(4),n(5,"strong"),r(6),i()(),n(7,"div",24),r(8),q(9,"date"),i(),n(10,"div",25)(11,"button",26),p("click",function(){let l=_(t).$implicit,d=u(2);return C(d.moveToDock(l))}),n(12,"mat-icon"),r(13,"move_to_inbox"),i(),n(14,"span"),r(15,"Move to Dock"),i()(),n(16,"button",27),p("click",function(){let l=_(t).$implicit,d=u(2);return C(d.vacateSpot(l))}),n(17,"mat-icon"),r(18,"delete_forever"),i(),n(19,"span"),r(20,"Vacate"),i()()()()}if(o&2){let t=e.$implicit;s(4),I(" ",t.spotNumber,": "),s(2),y(t.licensePlate),s(2),I(" Checked in at: ",Se(9,3,t.occupiedSince,"shortTime")," ")}}function Gt(o,e){o&1&&(n(0,"div",15)(1,"mat-icon"),r(2,"grass"),i(),n(3,"p"),r(4,"The yard is currently empty."),i()())}function Wt(o,e){o&1&&(n(0,"span",30),r(1,"In Yard"),i())}function Qt(o,e){o&1&&(n(0,"mat-icon"),r(1,"check_circle"),i(),n(2,"span"),r(3,"Checked In"),i())}function Ht(o,e){o&1&&(n(0,"mat-icon"),r(1,"login"),i(),n(2,"span"),r(3,"Check-In"),i())}function Kt(o,e){if(o&1){let t=S();n(0,"mat-list-item",14)(1,"mat-icon",28),r(2,"event_available"),i(),n(3,"div",29)(4,"span"),r(5),n(6,"strong"),r(7),i()(),h(8,Wt,2,0,"span",30),i(),n(9,"div",31)(10,"span"),r(11),q(12,"date"),i()(),n(13,"div",25)(14,"button",32),p("click",function(){let l=_(t).$implicit,d=u(2);return C(d.openManifestDialog(l))}),n(15,"mat-icon"),r(16,"description"),i(),n(17,"span"),r(18,"Manifest"),i()(),n(19,"button",33),p("click",function(){let l=_(t).$implicit,d=u(2);return C(d.checkIn(l))}),W(20),h(21,Qt,4,0)(22,Ht,4,0),Q(),i()()()}if(o&2){let t=e.$implicit;s(5),I("",t.carrierName," - "),s(2),y(t.licensePlate),s(),M(t.isCheckedIn?8:-1),s(3),Ye(" ",Se(12,8,t.appointmentTime,"shortTime")," \u2022 ",t.dockName," \u2022 ",t.status," "),s(8),c("disabled",t.isCheckedIn),s(2),M(t.isCheckedIn?21:22)}}function Jt(o,e){o&1&&(n(0,"div",15)(1,"mat-icon"),r(2,"celebration"),i(),n(3,"p"),r(4,"No more pending arrivals for today."),i()())}function Xt(o,e){if(o&1){let t=S();n(0,"div",6)(1,"mat-card",8)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Trucks in Yard"),i(),n(5,"mat-card-subtitle"),r(6,"Vehicles currently staged and awaiting a dock"),i()(),n(7,"div",9)(8,"mat-form-field",10)(9,"mat-label"),r(10,"Search by Plate or Spot"),i(),x(11,"input",11),n(12,"mat-icon",12),r(13,"search"),i()()(),n(14,"mat-card-content")(15,"mat-list",13),v(16,zt,21,6,"mat-list-item",14,Rt,!1,Gt,5,0,"div",15),i()()(),n(19,"mat-card",8)(20,"mat-card-header")(21,"div",16)(22,"div",17)(23,"mat-card-title"),r(24,"Scheduled Arrivals"),i(),n(25,"mat-card-subtitle"),r(26,"Trucks with appointments pending check-in"),i()(),n(27,"div",18)(28,"mat-form-field",19)(29,"mat-label"),r(30,"Date"),i(),n(31,"input",20),p("dateChange",function(l){_(t);let d=u();return C(d.onDateChange(l))}),i(),x(32,"mat-datepicker-toggle",21)(33,"mat-datepicker",null,0),i()()()(),n(35,"div",9)(36,"mat-form-field",10)(37,"mat-label"),r(38,"Search by Plate, Carrier, or Dock"),i(),x(39,"input",11),n(40,"mat-icon",12),r(41,"search"),i()()(),n(42,"mat-card-content")(43,"mat-list",13),v(44,Kt,23,11,"mat-list-item",14,Ut,!1,Jt,5,0,"div",15),i()()()()}if(o&2){let t=U(34),a=u();s(11),c("formControl",a.yardSearchControl),s(5),b(a.filteredOccupiedSpots()),s(15),c("matDatepicker",t)("value",a.selectedDate()),s(),c("for",t),s(7),c("formControl",a.arrivalsSearchControl),s(5),b(a.filteredPendingAppointments())}}var Mt=class o{yardApi=m(D);snackBar=m(ue);dialog=m(ot);pendingAppointments=f([]);occupiedSpots=f([]);isLoading=f(!0);selectedDate=f(new Date);arrivalsSearchControl=new ke("");yardSearchControl=new ke("");arrivalsSearchQuery=Oe(this.arrivalsSearchControl.valueChanges,{initialValue:""});yardSearchQuery=Oe(this.yardSearchControl.valueChanges,{initialValue:""});filteredPendingAppointments=z(()=>{let e=this.pendingAppointments(),t=(this.arrivalsSearchQuery()||"").toLowerCase();return t?e.filter(a=>a.licensePlate.toLowerCase().includes(t)||a.carrierName.toLowerCase().includes(t)||a.dockName.toLowerCase().includes(t)):e});filteredOccupiedSpots=z(()=>{let e=this.occupiedSpots(),t=(this.yardSearchQuery()||"").toLowerCase();return t?e.filter(a=>a.licensePlate.toLowerCase().includes(t)||a.spotNumber.toLowerCase().includes(t)):e});constructor(){De(()=>{let e=this.selectedDate();this.loadYardData(e)},{allowSignalWrites:!0})}ngOnInit(){}onDateChange(e){e.value&&this.selectedDate.set(e.value)}loadYardData(e){this.isLoading.set(!0);let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0)),a=new Date(t);a.setUTCDate(t.getUTCDate()+1),we({appointments:this.yardApi.getTodaysAppointments(t.toISOString(),a.toISOString()),occupied:this.yardApi.getOccupiedYardSpots()}).subscribe({next:({appointments:l,occupied:d})=>{let R=new Set(d.map(g=>g.truckId)),G=l.map(g=>xe(Me({},g),{isCheckedIn:R.has(g.truckId)||g.status==="InProgress"}));this.pendingAppointments.set(G),this.occupiedSpots.set(d),this.isLoading.set(!1)},error:()=>{this.snackBar.open("Failed to load yard data.","Close",{duration:5e3}),this.isLoading.set(!1)}})}checkIn(e){if(e.isCheckedIn){this.snackBar.open(`Truck ${e.licensePlate} is already checked in.`,"OK",{duration:3e3});return}this.dialog.open(Ce).afterClosed().pipe(Pe(a=>!!a)).subscribe(a=>{this.yardApi.checkInTruck(e.truckId,a).subscribe({next:()=>{this.snackBar.open("Truck checked in successfully!","OK",{duration:5e3}),this.loadYardData(this.selectedDate())},error:l=>{let d=l.error?.title||"Check-in failed.";this.snackBar.open(d,"Close",{duration:7e3})}})})}moveToDock(e){this.yardApi.moveTruckToDock(e.yardSpotId,e.appointmentId).subscribe({next:()=>{this.snackBar.open(`Truck from spot ${e.spotNumber} is moving to the dock.`,"OK",{duration:5e3}),this.loadYardData(this.selectedDate())},error:t=>this.snackBar.open(`Failed to move truck: ${t.error?.title||"An unknown error occurred."}`,"Close",{duration:7e3})})}vacateSpot(e){confirm(`Are you sure you want to vacate spot ${e.spotNumber}? This will remove the truck from the yard.`)&&this.yardApi.vacateYardSpot(e.yardSpotId).subscribe({next:()=>{this.snackBar.open(`Spot ${e.spotNumber} vacated successfully.`,"OK",{duration:5e3}),this.loadYardData(this.selectedDate())},error:t=>{this.snackBar.open(`Failed to vacate spot: ${t.error?.title||"Unknown error"}`,"Close",{duration:7e3})}})}openManifestDialog(e){this.dialog.open(he,{data:{appointmentId:e.appointmentId},width:"600px"})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=O({type:o,selectors:[["app-yard-management"]],decls:9,vars:1,consts:[["picker",""],[1,"report-container"],[1,"header-section"],[1,"mat-headline-6"],[1,"mat-body-1"],[1,"spinner-container-page"],[1,"yard-grid"],["mode","indeterminate"],[1,"list-card"],[1,"list-search-bar"],["appearance","outline","subscriptSizing","dynamic",1,"custom-field"],["matInput","",3,"formControl"],["matSuffix",""],["role","list"],["role","listitem"],[1,"empty-list-message"],[1,"header-with-controls"],[1,"header-text"],[1,"header-controls"],["appearance","outline","subscriptSizing","dynamic",1,"date-field"],["matInput","",3,"dateChange","matDatepicker","value"],["matIconSuffix","",3,"for"],["matListItemIcon","","color","primary"],["matListItemTitle",""],["matListItemLine",""],["matListItemMeta",""],["mat-stroked-button","","color","primary",3,"click"],["mat-stroked-button","","color","warn",2,"margin-left","8px",3,"click"],["matListItemIcon",""],["matListItemTitle","",1,"appointment-title"],[1,"in-yard-badge"],["matListItemLine","",1,"arrival-details-line"],["mat-stroked-button","","color","accent",2,"margin-right","8px",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(t,a){t&1&&(n(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),r(4,"Yard Management"),i(),n(5,"p",4),r(6,"Monitor trucks in the yard and check in new arrivals."),i()()(),h(7,qt,4,0,"div",5)(8,Xt,47,7,"div",6),i()),t&2&&(s(7),M(a.isLoading()?7:8))},dependencies:[w,tt,Ke,Xe,et,Ze,Je,de,le,se,re,ae,oe,Ue,A,T,E,P,nt,B,j,Qe,F,X,L,$e,ce,me,V,N,ze,$,pt,dt,mt,ct,st,Ne],styles:["[_nghost-%COMP%]{display:block;height:100%}.report-container[_ngcontent-%COMP%]{padding:1.5rem 2rem;max-width:1600px;margin:0 auto;display:flex;flex-direction:column;gap:2rem;height:100%;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--mat-sys-outline-variant)}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin:0 0 .5rem;color:var(--mat-sys-on-surface);letter-spacing:-.02em}.header-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--mat-sys-on-surface-variant);font-size:1rem;max-width:600px}.yard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:1.5rem;align-items:start}.list-card[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f;border-radius:16px;padding:0;display:flex;flex-direction:column;background-color:#fff;height:100%;transition:box-shadow .3s ease}.list-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d}.list-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--mat-sys-outline-variant-low);background-color:#fff;min-height:88px;display:flex;align-items:flex-start}.list-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#1e293b;letter-spacing:-.01em}.list-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b;margin-top:.25rem;font-weight:400}.list-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:0;flex-grow:1;overflow-y:auto}.header-with-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;width:100%;gap:1rem}.header-with-controls[_ngcontent-%COMP%]   .header-text[_ngcontent-%COMP%]{flex:1}.header-with-controls[_ngcontent-%COMP%]   .header-controls[_ngcontent-%COMP%]   .date-field[_ngcontent-%COMP%]{width:150px}.header-with-controls[_ngcontent-%COMP%]   .header-controls[_ngcontent-%COMP%]   .date-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{background-color:#f1f5f9;border-radius:8px;border:none;padding:0 12px;height:40px}.header-with-controls[_ngcontent-%COMP%]   .header-controls[_ngcontent-%COMP%]   .date-field[_ngcontent-%COMP%]     .mat-mdc-form-field-underline{display:none}.header-with-controls[_ngcontent-%COMP%]   .header-controls[_ngcontent-%COMP%]   .date-field[_ngcontent-%COMP%]     .mat-mdc-form-field-flex{height:40px;align-items:center}.list-search-bar[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-bottom:1px solid var(--mat-sys-outline-variant-low)}.custom-field[_ngcontent-%COMP%]{width:100%;--mat-form-field-container-height: 44px;--mat-form-field-container-vertical-padding: 0px}.custom-field[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{height:44px;padding-top:0;padding-bottom:0;background-color:#fff;border:1px solid var(--mat-sys-outline-variant);border-radius:8px}.custom-field[_ngcontent-%COMP%]     .mat-mdc-form-field-flex{height:100%;align-items:center;padding:0 12px}.custom-field[_ngcontent-%COMP%]     .mat-mdc-input-element{margin-top:-4px}.custom-field[_ngcontent-%COMP%]     .mat-mdc-form-field-icon-suffix{display:flex;align-items:center;color:#94a3b8}.custom-field[_ngcontent-%COMP%]     .mat-mdc-form-field-underline{display:none}.empty-list-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:300px;text-align:center;gap:1.5rem;color:#64748b;padding:2rem;background-color:#fcfcfc}.empty-list-message[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:#cbd5e1;opacity:.8}.empty-list-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;font-weight:500}.mat-mdc-list-item[_ngcontent-%COMP%]{height:auto!important;min-height:72px;padding:1rem 1.5rem!important;border-bottom:1px solid var(--mat-sys-outline-variant-low);transition:background-color .2s}.mat-mdc-list-item[_ngcontent-%COMP%]:hover{background-color:#f8fafc}.mat-mdc-list-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.appointment-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;font-weight:500;color:#1e293b}.in-yard-badge[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;background-color:#dcfce7;color:#166534;padding:2px 8px;border-radius:4px;white-space:nowrap;line-height:1.2;margin-left:.75rem}.arrival-details-line[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;font-size:.875rem;color:#64748b;margin-top:.25rem;white-space:normal!important;overflow:visible!important}.spinner-container-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:1rem;padding:3rem;min-height:300px;color:var(--mat-sys-on-surface-variant);flex-grow:1}@media (max-width: 768px){.report-container[_ngcontent-%COMP%]{padding:1rem}.yard-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{Mt as YardManagementComponent};
