import{a as W,b as H}from"./chunk-RN27ZARI.js";import"./chunk-CAC7JEQ5.js";import{a as j,b as A,c as R}from"./chunk-WU4RLJJ2.js";import"./chunk-JBTOMD6F.js";import{c as z,h as V}from"./chunk-YTDMGDSN.js";import"./chunk-7T4FYH4B.js";import"./chunk-NRJELJJX.js";import{a as F,b as q}from"./chunk-ORD52YGC.js";import"./chunk-33GO6BEM.js";import"./chunk-RZ3EY26M.js";import"./chunk-5JMQ54DL.js";import{n as G,p as D,q as T}from"./chunk-AFJ6IJZO.js";import{a as N,b as $}from"./chunk-67FWL4YT.js";import"./chunk-W24IOO4C.js";import"./chunk-VD2AZ2LQ.js";import"./chunk-LWYKMW7M.js";import{i as B}from"./chunk-TFYOF5WW.js";import"./chunk-ZKJQ6NKM.js";import{H as E,I as L}from"./chunk-6GGLSGMC.js";import{i as I,j as y,t as w}from"./chunk-GEABFLPO.js";import{C as h,Pb as d,Qb as i,Rb as o,Sb as O,Zb as P,cb as c,cc as u,ec as m,ga as _,la as f,ma as C,pb as b,qc as v,sc as a,tc as l,uc as S,va as k,vb as g}from"./chunk-FZDPWNP7.js";import{a as x,b as M}from"./chunk-AP4OEWII.js";function Q(r,e){r&1&&(i(0,"div",6),O(1,"mat-spinner",7),o())}function U(r,e){r&1&&(i(0,"div",8)(1,"mat-icon"),a(2,"assignment_turned_in"),o(),i(3,"p"),a(4,"No active pick lists assigned to you."),o()())}function J(r,e){if(r&1){let t=P();i(0,"div",26)(1,"button",27),u("click",function(){f(t);let p=m().$implicit,s=m(3);return C(s.openScanDialog(p))}),i(2,"mat-icon"),a(3,"qr_code_scanner"),o(),a(4," Scan "),o(),i(5,"button",28),u("click",function(){f(t);let p=m().$implicit,s=m(3);return C(s.markAsShort(p))}),i(6,"mat-icon"),a(7,"block"),o()()()}}function X(r,e){if(r&1&&(i(0,"div",17)(1,"div",18)(2,"span",19),a(3),o(),i(4,"span",20),a(5),o()(),i(6,"div",21)(7,"div",22),a(8),o(),i(9,"div",23),a(10),o(),i(11,"div",24),a(12,"Qty: "),i(13,"strong"),a(14),o(),a(15," units"),o()(),g(16,J,8,0,"div",25),o()),r&2){let t=e.$implicit;c(3),l(t.location),c(),v("confirmed",t.status==="Confirmed")("short",t.status==="Short"),c(),l(t.status),c(3),l(t.material),c(2),l(t.sku),c(4),l(t.quantity),c(2),d("ngIf",t.status==="Planned")}}function Y(r,e){if(r&1&&(i(0,"div",15),g(1,X,17,10,"div",16),o()),r&2){let t=m().$implicit;c(),d("ngForOf",t.items)}}function Z(r,e){if(r&1){let t=P();i(0,"div",9)(1,"div",10),u("click",function(){let p=f(t).$implicit,s=m();return C(s.toggleGroup(p.accountId))}),i(2,"div",11)(3,"span",12),a(4),o()(),i(5,"div",13)(6,"mat-chip-set")(7,"mat-chip"),a(8),o()(),i(9,"mat-icon"),a(10,"expand_more"),o()()(),g(11,Y,2,1,"div",14),o()}if(r&2){let t=e.$implicit,n=m();c(4),l(t.accountName),c(4),S("",t.items.length," Items"),c(),v("rotated",n.isGroupExpanded(t.accountId)),c(2),d("ngIf",n.isGroupExpanded(t.accountId))}}var K=class r{pickingApi=_(W);snackBar=_(F);dialog=_(z);pickListGroups=k([]);isLoading=k(!0);expandedGroups=k(new Set);ngOnInit(){this.loadPickList()}loadPickList(){this.isLoading.set(!0),this.pickingApi.getPickList().subscribe({next:e=>{this.pickListGroups.set(e),this.isLoading.set(!1),e.length>0&&this.toggleGroup(e[0].accountId)},error:e=>{console.error("Failed to load pick list",e),this.snackBar.open("Could not load pick list.","Close"),this.isLoading.set(!1)}})}toggleGroup(e){let t=this.expandedGroups(),n=new Set(t);n.has(e)?n.delete(e):n.add(e),this.expandedGroups.set(n)}isGroupExpanded(e){return this.expandedGroups().has(e)}openScanDialog(e){this.dialog.open(H,{width:"90vw",maxWidth:"400px",data:{pickId:e.pickId,material:e.material,location:e.location}}).afterClosed().pipe(h(n=>!!n)).subscribe(n=>{let p={pickTransactionId:e.pickId,scannedLocationCode:n.scannedLocationCode,scannedLpn:n.scannedLpn,actualWeight:n.actualWeight};this.pickingApi.confirmPickByScan(p).subscribe({next:()=>this.updateItemStatus(e.pickId,"Confirmed"),error:s=>this.snackBar.open(`Scan Confirmation Failed: ${s.error?.detail||s.error?.title||"Check console."}`,"Close",{duration:5e3})})})}markAsShort(e){if(!confirm("Mark this item as SHORT?"))return;let t={pickTransactionId:e.pickId,newStatus:"Short"};this.pickingApi.confirmPickManually(t).subscribe({next:()=>this.updateItemStatus(e.pickId,"Short"),error:n=>this.snackBar.open(`Failed to mark as short: ${n.error?.title||"Unknown error"}`,"Close",{duration:5e3})})}updateItemStatus(e,t){this.pickListGroups.update(n=>n.map(p=>M(x({},p),{items:p.items.map(s=>s.pickId===e?M(x({},s),{status:t}):s)}))),this.snackBar.open(`Item marked as ${t}.`,"OK",{duration:2e3})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-mobile-picking"]],decls:10,vars:4,consts:[[1,"picking-container"],[1,"header"],["mat-icon-button","",3,"click","disabled"],["class","loading-spinner",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","group-list",4,"ngFor","ngForOf"],[1,"loading-spinner"],["diameter","40"],[1,"empty-state"],[1,"group-list"],[1,"group-header",3,"click"],[1,"group-info"],[1,"account"],[1,"group-meta"],["class","group-items",4,"ngIf"],[1,"group-items"],["class","pick-item-card",4,"ngFor","ngForOf"],[1,"pick-item-card"],[1,"item-header"],[1,"location"],[1,"status"],[1,"item-details"],[1,"material"],[1,"sku"],[1,"qty"],["class","item-actions",4,"ngIf"],[1,"item-actions"],["mat-stroked-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),a(3,"My Tasks"),o(),i(4,"button",2),u("click",function(){return n.loadPickList()}),i(5,"mat-icon"),a(6,"refresh"),o()()(),g(7,Q,2,0,"div",3)(8,U,5,0,"div",4)(9,Z,12,5,"div",5),o()),t&2&&(c(4),d("disabled",n.isLoading()),c(3),d("ngIf",n.isLoading()),c(),d("ngIf",!n.isLoading()&&n.pickListGroups().length===0),c(),d("ngForOf",n.pickListGroups()))},dependencies:[w,I,y,B,T,D,G,L,E,R,j,A,q,V,$,N],styles:[".picking-container[_ngcontent-%COMP%]{padding-bottom:80px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:32px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:48px 16px;color:#9e9e9e}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}.group-list[_ngcontent-%COMP%]{margin-bottom:16px;border-radius:8px;background:#fff;box-shadow:0 1px 3px #0000001a;overflow:hidden}.group-header[_ngcontent-%COMP%]{padding:16px;background:#fff;cursor:pointer;border-bottom:1px solid #eee}.group-header[_ngcontent-%COMP%]   .group-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.group-header[_ngcontent-%COMP%]   .group-info[_ngcontent-%COMP%]   .account[_ngcontent-%COMP%]{font-weight:500}.group-header[_ngcontent-%COMP%]   .group-info[_ngcontent-%COMP%]   .order-id[_ngcontent-%COMP%]{color:#757575;font-size:12px}.group-header[_ngcontent-%COMP%]   .group-meta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.group-header[_ngcontent-%COMP%]   .group-meta[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transition:transform .2s;color:#757575}.group-header[_ngcontent-%COMP%]   .group-meta[_ngcontent-%COMP%]   mat-icon.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.group-items[_ngcontent-%COMP%]{background:#fafafa;padding:8px}.pick-item-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:12px;margin-bottom:8px;border:1px solid #e0e0e0}.pick-item-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.pick-item-card[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.pick-item-card[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1565c0;padding:2px 6px;border-radius:4px;font-weight:500;font-size:14px}.pick-item-card[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{font-size:12px;text-transform:uppercase;font-weight:500}.pick-item-card[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .status.confirmed[_ngcontent-%COMP%]{color:#2e7d32}.pick-item-card[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .status.short[_ngcontent-%COMP%]{color:#c62828}.pick-item-card[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{margin-bottom:12px}.pick-item-card[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .material[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.pick-item-card[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{color:#757575;font-size:12px}.pick-item-card[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{margin-top:4px}.pick-item-card[_ngcontent-%COMP%]   .item-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;border-top:1px dashed #e0e0e0;padding-top:8px}"]})};export{K as MobilePickingComponent};
