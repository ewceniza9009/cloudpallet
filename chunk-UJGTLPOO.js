import{a as Oe}from"./chunk-225REAVO.js";import{a as Fe}from"./chunk-LPW7ZKDP.js";import{a as ke,b as Te,c as Ie,h as Pe}from"./chunk-UYAPIC3O.js";import"./chunk-OUNZMEYF.js";import"./chunk-MS4AQ6UA.js";import{d as ge,h as Ce,i as ve}from"./chunk-AR7DOULP.js";import{c as Re}from"./chunk-T7FV3XRB.js";import"./chunk-E4XFWEKX.js";import{b as _e,c as fe}from"./chunk-JJ4H6OAC.js";import{b as me,c as de,d as ce,f as se,i as pe,j as ue}from"./chunk-XOBVZ7HT.js";import{b as G,d as $}from"./chunk-5Z22TBEB.js";import{a as Ee}from"./chunk-YNYX5A3H.js";import"./chunk-LJS4T7OK.js";import"./chunk-3AIDC2CP.js";import"./chunk-ISLNSOXI.js";import{b as W,d as h,g as X,h as Z,l as ee,m as te,o as ie,r as ne,s as ae,t as oe,u as re,w as le}from"./chunk-OPXM5N2G.js";import"./chunk-2ATSTUKT.js";import{m as Y,o as J,p as Q}from"./chunk-362WG5KS.js";import{a as De,b as ye}from"./chunk-JQRCIVV7.js";import{a as H}from"./chunk-2G4RJFBR.js";import{a as xe,b as Se,c as he,f as Me,i as be}from"./chunk-BKLGZBQH.js";import{G as K,H as j}from"./chunk-PPJHYCVS.js";import{C as z,j as L,t as U}from"./chunk-DHGPXNCW.js";import{$ as A,$b as T,Aa as g,Ab as M,H as N,Ob as C,Pb as v,Rb as k,Sb as b,Tb as E,Ub as m,Vb as n,Wb as i,Xb as u,a as y,ac as I,b as R,cc as D,hb as r,hc as x,jc as s,la as p,qa as _,ra as f,tc as P,ub as B,xc as o,yc as S,zc as q}from"./chunk-N46UG6V3.js";var Ve=(t,a)=>a.id;function Ne(t,a){t&1&&(n(0,"div",2),u(1,"mat-progress-spinner",4),n(2,"span"),o(3,"Loading rate..."),i()())}function Ae(t,a){t&1&&(u(0,"mat-progress-spinner",32),n(1,"span"),o(2,"Saving..."),i())}function Be(t,a){t&1&&(T(0),n(1,"mat-icon"),o(2,"save"),i(),n(3,"span"),o(4,"Save Changes"),i(),I())}function qe(t,a){if(t&1){let e=D();n(0,"button",30),x("click",function(){_(e);let l=s(3);return f(l.toggleEditMode(!1))}),n(1,"mat-icon"),o(2,"cancel"),i(),n(3,"span"),o(4,"Cancel"),i()(),n(5,"button",31),x("click",function(){_(e);let l=s(3);return f(l.save())}),C(6,Ae,3,0)(7,Be,5,0,"ng-container"),i()}if(t&2){let e=s(3);r(5),m("disabled",e.isSaving()),r(),v(e.isSaving()?6:7)}}function Le(t,a){t&1&&(u(0,"mat-progress-spinner",32),n(1,"span"),o(2,"Deleting..."),i())}function Ue(t,a){t&1&&(T(0),n(1,"mat-icon"),o(2,"delete"),i(),n(3,"span"),o(4,"Delete"),i(),I())}function ze(t,a){if(t&1){let e=D();n(0,"button",33),x("click",function(){_(e);let l=s(3);return f(l.delete())}),C(1,Le,3,0)(2,Ue,5,0,"ng-container"),i(),n(3,"button",34),x("click",function(){_(e);let l=s(3);return f(l.toggleEditMode(!0))}),n(4,"mat-icon"),o(5,"edit"),i(),n(6,"span"),o(7,"Edit"),i()()}if(t&2){let e=s(3);m("disabled",e.isDeleting()),r(),v(e.isDeleting()?1:2)}}function Ge(t,a){if(t&1&&C(0,qe,8,2)(1,ze,8,2),t&2){let e=s(2);v(e.isEditMode()?0:1)}}function $e(t,a){t&1&&(u(0,"mat-progress-spinner",32),n(1,"span"),o(2,"Saving..."),i())}function He(t,a){t&1&&(T(0),n(1,"mat-icon"),o(2,"save"),i(),n(3,"span"),o(4,"Save Rate"),i(),I())}function Ke(t,a){if(t&1){let e=D();n(0,"button",31),x("click",function(){_(e);let l=s(2);return f(l.save())}),C(1,$e,3,0)(2,He,5,0,"ng-container"),i()}if(t&2){let e=s(2);m("disabled",e.isSaving()),r(),v(e.isSaving()?1:2)}}function je(t,a){if(t&1&&(n(0,"mat-option",19),o(1),i()),t&2){let e=a.$implicit;m("value",e.id),r(),S(e.name)}}function Ye(t,a){if(t&1&&(n(0,"mat-option",19),o(1),i()),t&2){let e=a.$implicit;m("value",e),r(),S(e)}}function Je(t,a){t&1&&(n(0,"mat-error"),o(1,"Service Type is required"),i())}function Qe(t,a){if(t&1&&(n(0,"mat-option",19),o(1),i()),t&2){let e=a.$implicit;m("value",e),r(),S(e)}}function We(t,a){t&1&&(n(0,"mat-error"),o(1,"UOM is required"),i())}function Xe(t,a){if(t&1&&(n(0,"mat-option",19),o(1),i()),t&2){let e=a.$implicit;m("value",e),r(),S(e===""?"(No Tier / Default)":e)}}function Ze(t,a){t&1&&(n(0,"mat-error"),o(1,"Rate Value is required"),i())}function et(t,a){t&1&&(n(0,"mat-error"),o(1,"Must be >= 0"),i())}function tt(t,a){t&1&&(n(0,"mat-error"),o(1,"Start Date is required"),i())}function it(t,a){if(t&1){let e=D();n(0,"div",3)(1,"div",5)(2,"div",6)(3,"a",7),x("click",function(){_(e);let l=s();return f(l.back())}),n(4,"mat-icon"),o(5,"arrow_back"),i()(),n(6,"div",8)(7,"h2"),o(8),i(),n(9,"p",9),o(10),i()()(),n(11,"div",10),C(12,Ge,2,1)(13,Ke,3,2,"button",11),i()(),n(14,"form",12)(15,"div",13)(16,"div",14)(17,"mat-card",15)(18,"mat-card-header")(19,"mat-card-title"),o(20,"Rate Configuration"),i()(),n(21,"mat-card-content",16)(22,"mat-form-field",17)(23,"mat-label"),o(24,"Customer Account (Optional)"),i(),n(25,"mat-select",18)(26,"mat-option",19),o(27,"Default (All Accounts)"),i(),b(28,je,2,2,"mat-option",19,Ve),i(),n(30,"mat-hint",20),o(31,"Leave blank for a default rate applicable to all accounts."),i()(),n(32,"mat-form-field",17)(33,"mat-label"),o(34,"Service Type"),i(),n(35,"mat-select",21),b(36,Ye,2,2,"mat-option",19,k),i(),M(38,Je,2,0,"mat-error",22),i(),n(39,"mat-form-field",17)(40,"mat-label"),o(41,"Unit of Measure (UOM)"),i(),n(42,"mat-select",23),b(43,Qe,2,2,"mat-option",19,k),i(),M(45,We,2,0,"mat-error",22),i(),n(46,"mat-form-field",17)(47,"mat-label"),o(48,"Tier / Sub-Category"),i(),n(49,"mat-select",24),b(50,Xe,2,2,"mat-option",19,k),i(),n(52,"mat-hint",20),o(53,"Billing key (e.g., 'FrozenStorage' for Storage type)."),i()(),n(54,"mat-form-field",17)(55,"mat-label"),o(56,"Rate Value (\u20B1)"),i(),u(57,"input",25),M(58,Ze,2,0,"mat-error",22)(59,et,2,0,"mat-error",22),i()()()(),n(60,"div",26)(61,"mat-card",15)(62,"mat-card-header")(63,"mat-card-title"),o(64,"Effective Dates"),i()(),n(65,"mat-card-content",16)(66,"mat-form-field",17)(67,"mat-label"),o(68,"Effective Start Date"),i(),u(69,"input",27)(70,"mat-datepicker-toggle",28)(71,"mat-datepicker",null,0),M(73,tt,2,0,"mat-error",22),i(),n(74,"mat-form-field",17)(75,"mat-label"),o(76,"Effective End Date (Optional)"),i(),u(77,"input",29)(78,"mat-datepicker-toggle",28)(79,"mat-datepicker",null,1),n(81,"mat-hint",20),o(82,"Leave blank if the rate does not expire."),i()()()()()()()()}if(t&2){let e,d,l,O,F,w=P(72),V=P(80),c=s();r(8),S(c.rateId()?"Edit Rate":"New Rate"),r(2),q(" ",c.rateId()?"Update the details for the selected billing rate.":"Create a new billing rate."," "),r(2),v(c.rateId()?12:13),r(2),m("formGroup",c.rateForm),r(12),m("value",null),r(2),E(c.accounts()),r(8),E(c.serviceTypes),r(2),m("ngIf",(e=c.rateForm.get("serviceType"))==null?null:e.hasError("required")),r(5),E(c.uoms),r(2),m("ngIf",(d=c.rateForm.get("uom"))==null?null:d.hasError("required")),r(5),E(c.validRateTiers),r(8),m("ngIf",(l=c.rateForm.get("value"))==null?null:l.hasError("required")),r(),m("ngIf",(O=c.rateForm.get("value"))==null?null:O.hasError("min")),r(10),m("matDatepicker",w),r(),m("for",w),r(3),m("ngIf",(F=c.rateForm.get("effectiveStartDate"))==null?null:F.hasError("required")),r(4),m("matDatepicker",V),r(),m("for",V)}}var we=class t{fb=p(re);route=p(G);router=p($);adminApi=p(Fe);http=p(z);snackBar=p(Ee);dialog=p(Re);rateForm;rateId=g(null);isEditMode=g(!1);isLoading=g(!0);isSaving=g(!1);isDeleting=g(!1);accounts=g([]);EMPTY_GUID="00000000-0000-0000-0000-000000000000";serviceTypes=["Storage","Blasting","Handling","VAS","FrozenStorage","Chilling","CoolStorage","DeepFrozenStorage","ULTStorage","Repack","Split","Labeling","CrossDock","Fumigation","Surcharge","CycleCount","Kitting"];validRateTiers=["","FrozenStorage","Chilling","CoolStorage","DeepFrozen","ULT","Kg","Each","Hour","Shipment","Expedited"];uoms=["Pallet","Kg","Day","Cycle","Each","Hour","Shipment","Percent"];constructor(){this.rateForm=this.fb.group({accountId:[null],serviceType:["",h.required],uom:["",h.required],tier:[""],value:[null,[h.required,h.min(0)]],effectiveStartDate:[new Date,h.required],effectiveEndDate:[null]})}ngOnInit(){this.loadLookups(),this.route.paramMap.pipe(A(a=>{let e=a.get("id");return e&&e!=="new"?(this.rateId.set(e),this.isEditMode.set(!1),this.rateForm.disable(),this.adminApi.getRateById(e)):(this.rateId.set(null),this.isEditMode.set(!0),this.rateForm.enable(),this.isLoading.set(!1),Promise.resolve(null))})).subscribe(a=>{if(a){let e=R(y({},a),{accountId:a.accountId===this.EMPTY_GUID?null:a.accountId});this.rateForm.patchValue(e)}this.isLoading.set(!1)})}loadLookups(){this.http.get(`${H.apiUrl}/Lookups/accounts`).subscribe(a=>this.accounts.set(a))}toggleEditMode(a){this.isEditMode.set(a),a?this.rateForm.enable():this.rateForm.disable()}save(){if(this.rateForm.invalid)return;this.isSaving.set(!0);let a=this.rateForm.value,e=a.accountId===null?this.EMPTY_GUID:a.accountId;if(this.rateId()){let d=R(y({id:this.rateId()},a),{accountId:e});this.adminApi.updateRate(this.rateId(),d).subscribe({next:()=>this.handleSaveSuccess("Rate updated successfully (New Revision Created)."),error:l=>this.handleSaveError(l)})}else{let d=R(y({},a),{accountId:e});this.adminApi.createRate(d).subscribe({next:l=>{this.handleSaveSuccess("Rate created successfully."),this.router.navigate(["/admin/rates/detail",l],{replaceUrl:!0})},error:l=>this.handleSaveError(l)})}}handleSaveSuccess(a){this.isSaving.set(!1),this.isEditMode.set(!1),this.rateForm.disable(),this.snackBar.open(a,"OK",{duration:3e3}),this.router.navigate(["/admin/rates"])}handleSaveError(a){this.isSaving.set(!1),this.snackBar.open(`Error: ${a.error?.title||"Failed to save rate."}`,"Close")}delete(){this.dialog.open(Oe,{data:{title:"Delete Rate",message:"Are you sure you want to delete this rate? This action cannot be undone."}}).afterClosed().pipe(N(e=>e===!0)).subscribe(()=>{this.isDeleting.set(!0),this.adminApi.deleteRate(this.rateId()).subscribe({next:()=>{this.snackBar.open("Rate deleted successfully.","OK",{duration:3e3}),this.router.navigate(["/admin/rates"])},error:e=>{this.snackBar.open(`Error: ${e.error?.title||"Failed to delete rate."}`,"Close"),this.isDeleting.set(!1)}})})}back(){this.router.navigate(["/admin/rates"])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=B({type:t,selectors:[["app-rate-detail"]],decls:2,vars:1,consts:[["startPicker",""],["endPicker",""],[1,"spinner-container"],[1,"detail-container"],["mode","indeterminate"],[1,"detail-header"],[1,"header-main"],["mat-icon-button","","matTooltip","Back to List",3,"click"],[1,"title-group"],[1,"subtitle"],[1,"header-actions"],["mat-flat-button","","color","primary",3,"disabled"],[1,"detail-form",3,"formGroup"],[1,"layout-grid"],[1,"column","left-column"],[1,"detail-card"],[1,"form-grid"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","accountId"],[3,"value"],["align","start"],["formControlName","serviceType","required",""],[4,"ngIf"],["formControlName","uom","required",""],["formControlName","tier"],["matInput","","type","number","formControlName","value","placeholder","0.0000","min","0","required",""],[1,"column","right-column"],["matInput","","formControlName","effectiveStartDate","required","",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","effectiveEndDate",3,"matDatepicker"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20","mode","indeterminate"],["mat-stroked-button","","color","warn",3,"click","disabled"],["mat-stroked-button","","color","primary",3,"click"]],template:function(e,d){e&1&&C(0,Ne,4,0,"div",2)(1,it,83,14,"div",3),e&2&&v(d.isLoading()?0:1)},dependencies:[U,L,le,ee,W,te,X,Z,oe,ae,ie,ne,be,xe,he,Me,Se,ue,pe,me,ce,de,se,fe,_e,ve,Ce,ge,Q,J,Y,j,K,ye,De,Pe,ke,Te,Ie],styles:["[_nghost-%COMP%]{display:block;height:100%}.spinner-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:1rem;padding:3rem;min-height:300px;color:var(--mat-sys-on-surface-variant)}.detail-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;padding-bottom:1rem;border-bottom:1px solid var(--mat-sys-outline-variant);margin-bottom:.5rem}.header-main[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-grow:1;min-width:0}.title-group[_ngcontent-%COMP%]{min-width:0}.title-group[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.75rem}.title-group[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:var(--mat-sys-on-surface-variant)}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-shrink:0}.detail-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.layout-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;align-items:start}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.detail-card[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);box-shadow:0 2px 4px #0000000a;border-radius:8px}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:.75rem 1.25rem .5rem;border-bottom:1px solid var(--mat-sys-outline-variant);background-color:var(--mat-sys-surface-container-lowest)}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:1.25rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}.full-width[_ngcontent-%COMP%]{grid-column:1/-1}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%] + span[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + mat-icon[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:8px}@media (max-width: 1024px){.layout-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{we as RateDetailComponent};
