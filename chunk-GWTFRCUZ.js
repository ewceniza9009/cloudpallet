import{a as tt,b as it}from"./chunk-PFLXRLFW.js";import{a as Xe}from"./chunk-KZ426JC4.js";import{a as et}from"./chunk-EZUOKNIG.js";import"./chunk-JJ2A35WS.js";import"./chunk-MS4AQ6UA.js";import{d as Ne,h as Ve,i as Ae}from"./chunk-LDLFMV26.js";import{c as Je}from"./chunk-MXUZQ3DV.js";import"./chunk-LYOC6WUO.js";import{a as fe,b as ge}from"./chunk-JKSDCMLK.js";import"./chunk-KMQDKAAG.js";import{b as Be,c as Le}from"./chunk-RFTLLO7Q.js";import{b as Pe,c as ke,d as Oe,i as we,j as qe}from"./chunk-LJJEMR6T.js";import{b as me,d as de}from"./chunk-QKDH2S6W.js";import"./chunk-PVDG46DZ.js";import{a as Re}from"./chunk-2PH2G5FJ.js";import{a as Ze}from"./chunk-BVME6BF5.js";import{b as Ue}from"./chunk-4467KL4X.js";import"./chunk-3HUEUM62.js";import"./chunk-2G5JFWHB.js";import{b as Ce,d as s,g as xe,h as he,l as Me,m as be,o as ve,p as Se,q as ye,r as Ee,s as De,t as Te,u as Fe,w as Ie}from"./chunk-AMYPGFIW.js";import"./chunk-KS7NA3UJ.js";import{m as pe,o as ue,p as _e}from"./chunk-2LKGOGN5.js";import{a as je,b as Ye}from"./chunk-NAFMYLXR.js";import{a as q}from"./chunk-2G4RJFBR.js";import{a as Qe,b as $e,c as Ge,d as Ke,e as We,f as ze,i as He}from"./chunk-NCMEPRDZ.js";import{G as se,H as ce}from"./chunk-3GOW57GU.js";import{B as le,j as re,t as oe}from"./chunk-HYNCXMIA.js";import{$ as ee,$b as D,Aa as x,Ab as f,Ac as ne,H as J,J as X,Ob as g,Pb as C,Qb as ie,Rb as O,Sb as y,Tb as E,Ub as m,Vb as i,Wb as e,Xb as u,Xc as ae,a as k,ac as T,cc as S,hb as o,hc as b,jc as p,la as v,p as Y,qa as h,ra as M,ub as te,xc as a,yc as F,zc as w}from"./chunk-N46UG6V3.js";var B=(t,n)=>n.id;function at(t,n){t&1&&(i(0,"div",0),u(1,"mat-progress-spinner",2),i(2,"span"),a(3,"Loading material..."),e()())}function rt(t,n){t&1&&(u(0,"mat-progress-spinner",47),i(1,"span"),a(2,"Saving..."),e())}function ot(t,n){t&1&&(D(0),i(1,"mat-icon"),a(2,"save"),e(),i(3,"span"),a(4,"Save Changes"),e(),T())}function lt(t,n){if(t&1){let r=S();i(0,"button",45),b("click",function(){h(r);let l=p(3);return M(l.toggleEditMode(!1))}),i(1,"mat-icon"),a(2,"cancel"),e(),i(3,"span"),a(4,"Cancel"),e()(),i(5,"button",46),b("click",function(){h(r);let l=p(3);return M(l.save())}),g(6,rt,3,0)(7,ot,5,0,"ng-container"),e()}if(t&2){let r=p(3);o(5),m("disabled",r.isSaving()),o(),C(r.isSaving()?6:7)}}function mt(t,n){t&1&&(u(0,"mat-progress-spinner",47),i(1,"span"),a(2,"Deleting..."),e())}function dt(t,n){t&1&&(D(0),i(1,"mat-icon"),a(2,"delete"),e(),i(3,"span"),a(4,"Delete"),e(),T())}function st(t,n){if(t&1){let r=S();i(0,"button",48),b("click",function(){h(r);let l=p(3);return M(l.delete())}),g(1,mt,3,0)(2,dt,5,0,"ng-container"),e(),i(3,"button",49),b("click",function(){h(r);let l=p(3);return M(l.toggleEditMode(!0))}),i(4,"mat-icon"),a(5,"edit"),e(),i(6,"span"),a(7,"Edit"),e()()}if(t&2){let r=p(3);m("disabled",r.isDeleting()),o(),C(r.isDeleting()?1:2)}}function ct(t,n){if(t&1&&g(0,lt,8,2)(1,st,8,2),t&2){let r=p(2);C(r.isEditMode()?0:1)}}function pt(t,n){t&1&&(u(0,"mat-progress-spinner",47),i(1,"span"),a(2,"Saving..."),e())}function ut(t,n){t&1&&(D(0),i(1,"mat-icon"),a(2,"save"),e(),i(3,"span"),a(4,"Save Material"),e(),T())}function _t(t,n){if(t&1){let r=S();i(0,"button",46),b("click",function(){h(r);let l=p(2);return M(l.save())}),g(1,pt,3,0)(2,ut,5,0,"ng-container"),e()}if(t&2){let r=p(2);m("disabled",r.isSaving()),o(),C(r.isSaving()?1:2)}}function ft(t,n){t&1&&(i(0,"mat-error"),a(1,"Name is required"),e())}function gt(t,n){t&1&&(i(0,"mat-error"),a(1,"SKU is required"),e())}function Ct(t,n){t&1&&(i(0,"mat-hint",19),a(1,"SKU cannot be changed after creation."),e())}function xt(t,n){if(t&1&&(i(0,"mat-option",23),a(1),e()),t&2){let r=n.$implicit;m("value",r.id),o(),F(r.name)}}function ht(t,n){t&1&&(i(0,"mat-error"),a(1,"Category is required"),e())}function Mt(t,n){if(t&1&&(i(0,"mat-option",23),a(1),e()),t&2){let r=n.$implicit;m("value",r.id),o(),F(r.name)}}function bt(t,n){t&1&&(i(0,"mat-error"),a(1,"UOM is required"),e())}function vt(t,n){if(t&1&&(i(0,"mat-option",23),a(1),e()),t&2){let r=n.$implicit;m("value",r),o(),F(r)}}function St(t,n){t&1&&(i(0,"mat-hint",19),a(1,"Type cannot be changed after creation."),e())}function yt(t,n){t&1&&(i(0,"mat-error"),a(1,"Zone is required"),e())}function Et(t,n){t&1&&(i(0,"mat-error"),a(1,"Weight is required"),e())}function Dt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function Tt(t,n){t&1&&(i(0,"mat-error"),a(1,"Cost is required"),e())}function Ft(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function It(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function Pt(t,n){t&1&&(i(0,"mat-error"),a(1,"Required if perishable"),e())}function kt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function Ot(t,n){t&1&&(i(0,"mat-hint",19),a(1,"Only applicable if Perishable is enabled."),e())}function wt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function qt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function Bt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function Lt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function Nt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be >= 0"),e())}function Vt(t,n){if(t&1&&(i(0,"mat-option",23),a(1),e()),t&2){let r=n.$implicit;m("value",r),o(),F(r)}}function At(t,n){t&1&&(i(0,"mat-error"),a(1,"Format is required"),e())}function Ut(t,n){t&1&&(i(0,"mat-card-title"),a(1,"Kitting Recipe (Bill of Materials)"),e(),i(2,"mat-card-subtitle"),a(3,"Define the components needed to build this Kit."),e())}function Rt(t,n){t&1&&(i(0,"mat-card-title"),a(1,"Repackaging Recipe (Bill of Materials)"),e(),i(2,"mat-card-subtitle"),a(3,"Define the single component used to create this Repack."),e())}function Qt(t,n){t&1&&(i(0,"mat-error"),a(1,"Output Qty is required"),e())}function $t(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be > 0"),e())}function Gt(t,n){if(t&1){let r=S();i(0,"button",62),b("click",function(){h(r);let l=p(3);return M(l.addBomLine())}),i(1,"mat-icon"),a(2,"add"),e(),i(3,"span"),a(4,"Add Component"),e()()}}function Kt(t,n){t&1&&(i(0,"p",58),a(1,"Add components to define the recipe."),e())}function Wt(t,n){if(t&1&&(i(0,"mat-option",23),a(1),e()),t&2){let r=p().$implicit;m("value",r.id),o(),ne("",r.name," (",r.sku,")")}}function zt(t,n){if(t&1&&g(0,Wt,2,3,"mat-option",23),t&2){let r=n.$implicit,c=p(4);C(r.id!==c.materialId()?0:-1)}}function Ht(t,n){t&1&&(i(0,"mat-error"),a(1,"Material is required"),e())}function Zt(t,n){t&1&&(i(0,"mat-error"),a(1,"Qty is required"),e())}function jt(t,n){t&1&&(i(0,"mat-error"),a(1,"Must be > 0"),e())}function Yt(t,n){if(t&1){let r=S();i(0,"button",68),b("click",function(){h(r);let l=p().$index,_=p(3);return M(_.removeBomLine(l))}),i(1,"mat-icon"),a(2,"delete_outline"),e()()}if(t&2){let r,c=p().$implicit,l=p(3);m("disabled",l.bomLines.length<=1&&!((r=c.get("inputMaterialId"))!=null&&r.value))}}function Jt(t,n){if(t&1&&(i(0,"div",59)(1,"mat-form-field",63)(2,"mat-label"),a(3,"Input Material"),e(),i(4,"mat-select",64),y(5,zt,1,1,null,null,B),e(),f(7,Ht,2,0,"mat-error",17),e(),i(8,"mat-form-field",65)(9,"mat-label"),a(10,"Input Qty"),e(),u(11,"input",66),f(12,Zt,2,0,"mat-error",17)(13,jt,2,0,"mat-error",17),e(),g(14,Yt,3,1,"button",67),e()),t&2){let r,c,l,_=n.$implicit,P=n.$index,I=p(3);m("formGroupName",P),o(5),E(I.allMaterials()),o(2),m("ngIf",(r=_.get("inputMaterialId"))==null?null:r.hasError("required")),o(5),m("ngIf",(c=_.get("inputQuantity"))==null?null:c.hasError("required")),o(),m("ngIf",(l=_.get("inputQuantity"))==null?null:l.hasError("min")),o(),C(I.currentMaterialType==="Kit"?14:-1)}}function Xt(t,n){t&1&&(u(0,"mat-progress-spinner",47),i(1,"span"),a(2,"Saving Recipe..."),e())}function ei(t,n){if(t&1&&(D(0),i(1,"mat-icon"),a(2,"save"),e(),i(3,"span"),a(4),e(),T()),t&2){let r=p(3);o(4),F(r.bom()?"Update Recipe":"Save Recipe")}}function ti(t,n){if(t&1){let r=S();i(0,"mat-card",13)(1,"mat-card-header"),D(2),g(3,Ut,4,0)(4,Rt,4,0),T(),e(),i(5,"mat-card-content")(6,"form",50),b("ngSubmit",function(){h(r);let l=p(2);return M(l.onBomSubmit())}),i(7,"div",51)(8,"mat-form-field",52)(9,"mat-label"),a(10,"Output Quantity (Yield)"),e(),u(11,"input",53),f(12,Qt,2,0,"mat-error",17)(13,$t,2,0,"mat-error",17),i(14,"mat-hint",19),a(15,"How many units of this item are created from the components below."),e()()(),u(16,"mat-divider",54),i(17,"div",55)(18,"div",56)(19,"h3"),a(20,"Components (Inputs)"),e(),g(21,Gt,5,0,"button",57),e(),g(22,Kt,2,0,"p",58),y(23,Jt,15,5,"div",59,ie),e(),i(25,"mat-card-actions",60)(26,"button",61),g(27,Xt,3,0)(28,ei,5,1,"ng-container"),e()()()()()}if(t&2){let r,c,l,_=p(2);o(3),C(_.currentMaterialType==="Kit"?3:4),o(3),m("formGroup",_.bomForm),o(6),m("ngIf",(r=_.bomForm.get("outputQuantity"))==null?null:r.hasError("required")),o(),m("ngIf",(c=_.bomForm.get("outputQuantity"))==null?null:c.hasError("min")),o(8),C(_.currentMaterialType==="Kit"?21:-1),o(),C(_.bomLines.controls.length===0?22:-1),o(),E(_.bomLines.controls),o(3),m("disabled",_.bomForm.invalid||_.isSubmittingBom()||_.bomLines.length===0||!((l=_.bomLines.at(0).get("inputMaterialId"))!=null&&l.value)),o(),C(_.isSubmittingBom()?27:28)}}function ii(t,n){if(t&1){let r=S();i(0,"div",1)(1,"div",3)(2,"div",4)(3,"a",5),b("click",function(){h(r);let l=p();return M(l.back())}),i(4,"mat-icon"),a(5,"arrow_back"),e()(),i(6,"div",6)(7,"h2"),a(8),e(),i(9,"p",7),a(10),e()()(),i(11,"div",8),g(12,ct,2,1)(13,_t,3,2,"button",9),e()(),i(14,"form",10)(15,"div",11)(16,"div",12)(17,"mat-card",13)(18,"mat-card-header")(19,"mat-card-title"),a(20,"Basic Information"),e()(),i(21,"mat-card-content",14)(22,"mat-form-field",15)(23,"mat-label"),a(24,"Material Name"),e(),u(25,"input",16),f(26,ft,2,0,"mat-error",17),e(),i(27,"mat-form-field",15)(28,"mat-label"),a(29,"SKU / Material Code"),e(),u(30,"input",18),f(31,gt,2,0,"mat-error",17),g(32,Ct,2,0,"mat-hint",19),e(),i(33,"mat-form-field",20)(34,"mat-label"),a(35,"Description"),e(),u(36,"textarea",21),e()()(),i(37,"mat-card",13)(38,"mat-card-header")(39,"mat-card-title"),a(40,"Classification & Logistics"),e()(),i(41,"mat-card-content",14)(42,"mat-form-field",15)(43,"mat-label"),a(44,"Category"),e(),i(45,"mat-select",22),y(46,xt,2,2,"mat-option",23,B),e(),f(48,ht,2,0,"mat-error",17),e(),i(49,"mat-form-field",15)(50,"mat-label"),a(51,"Unit of Measure (UOM)"),e(),i(52,"mat-select",24),y(53,Mt,2,2,"mat-option",23,B),e(),f(55,bt,2,0,"mat-error",17),e(),i(56,"mat-form-field",15)(57,"mat-label"),a(58,"Material Type"),e(),i(59,"mat-select",25),y(60,vt,2,2,"mat-option",23,O),e(),g(62,St,2,0,"mat-hint",19),e(),i(63,"mat-form-field",15)(64,"mat-label"),a(65,"Required Temperature Zone"),e(),i(66,"mat-select",26)(67,"mat-option",27),a(68,"FrozenStorage"),e(),i(69,"mat-option",28),a(70,"Chilling"),e()(),f(71,yt,2,0,"mat-error",17),e(),i(72,"mat-form-field",15)(73,"mat-label"),a(74,"Base Weight (Kg per UOM)"),e(),u(75,"input",29),f(76,Et,2,0,"mat-error",17)(77,Dt,2,0,"mat-error",17),e(),i(78,"mat-form-field",15)(79,"mat-label"),a(80,"Cost (\u20B1 per UOM)"),e(),u(81,"input",30),f(82,Tt,2,0,"mat-error",17)(83,Ft,2,0,"mat-error",17),e(),i(84,"mat-form-field",15)(85,"mat-label"),a(86,"Package Tare Weight (Kg per UOM)"),e(),u(87,"input",31),i(88,"mat-hint",19),a(89,"Weight of the packaging itself."),e(),f(90,It,2,0,"mat-error",17),e()()()(),i(91,"div",32)(92,"mat-card",13)(93,"mat-card-header")(94,"mat-card-title"),a(95,"Handling & Storage Rules"),e()(),i(96,"mat-card-content",14)(97,"div",33)(98,"mat-slide-toggle",34),a(99,"Perishable"),e(),i(100,"mat-slide-toggle",35),a(101,"Hazardous"),e(),i(102,"mat-slide-toggle",36),a(103,"Is Active"),e()(),i(104,"mat-form-field",15)(105,"mat-label"),a(106,"Shelf Life (Days)"),e(),u(107,"input",37),f(108,Pt,2,0,"mat-error",17)(109,kt,2,0,"mat-error",17),g(110,Ot,2,0,"mat-hint",19),e(),i(111,"mat-form-field",15)(112,"mat-label"),a(113,"Min Stock Level"),e(),u(114,"input",38),f(115,wt,2,0,"mat-error",17),e(),i(116,"mat-form-field",15)(117,"mat-label"),a(118,"Max Stock Level"),e(),u(119,"input",39),f(120,qt,2,0,"mat-error",17),e()()(),i(121,"mat-card",13)(122,"mat-card-header")(123,"mat-card-title"),a(124,"Dimensions & Barcoding"),e()(),i(125,"mat-card-content",14)(126,"mat-form-field",15)(127,"mat-label"),a(128,"Length (cm)"),e(),u(129,"input",40),f(130,Bt,2,0,"mat-error",17),e(),i(131,"mat-form-field",15)(132,"mat-label"),a(133,"Width (cm)"),e(),u(134,"input",41),f(135,Lt,2,0,"mat-error",17),e(),i(136,"mat-form-field",15)(137,"mat-label"),a(138,"Height (cm)"),e(),u(139,"input",42),f(140,Nt,2,0,"mat-error",17),e(),i(141,"mat-form-field",15)(142,"mat-label"),a(143,"GS1 Barcode Prefix"),e(),u(144,"input",43),i(145,"mat-hint",19),a(146,"Used for barcode generation if applicable."),e()(),i(147,"mat-form-field",15)(148,"mat-label"),a(149,"Default Barcode Format"),e(),i(150,"mat-select",44),y(151,Vt,2,2,"mat-option",23,O),e(),f(153,At,2,0,"mat-error",17),e()()()()()(),g(154,ti,29,8,"mat-card",13),e()}if(t&2){let r,c,l,_,P,I,L,N,V,A,U,R,Q,$,G,K,W,z,H,Z,j,d=p();o(8),w(" ",d.materialId()?(r=d.materialForm.get("name"))==null?null:r.value:"New Material"," "),o(2),w("SKU: ",((c=d.materialForm.get("sku"))==null?null:c.value)||"Not yet assigned"),o(2),C(d.materialId()?12:13),o(2),m("formGroup",d.materialForm),o(12),m("ngIf",(l=d.materialForm.get("name"))==null?null:l.hasError("required")),o(4),m("readonly",!!d.materialId()),o(),m("ngIf",(_=d.materialForm.get("sku"))==null?null:_.hasError("required")),o(),C(d.materialId()?32:-1),o(14),E(d.categories()),o(2),m("ngIf",(P=d.materialForm.get("categoryId"))==null?null:P.hasError("required")),o(5),E(d.uoms()),o(2),m("ngIf",(I=d.materialForm.get("uomId"))==null?null:I.hasError("required")),o(4),m("disabled",!!d.materialId()),o(),E(d.materialTypes),o(2),C(d.materialId()?62:-1),o(9),m("ngIf",(L=d.materialForm.get("requiredTempZone"))==null?null:L.hasError("required")),o(5),m("ngIf",(N=d.materialForm.get("baseWeight"))==null?null:N.hasError("required")),o(),m("ngIf",(V=d.materialForm.get("baseWeight"))==null?null:V.hasError("min")),o(5),m("ngIf",(A=d.materialForm.get("costPerUnit"))==null?null:A.hasError("required")),o(),m("ngIf",(U=d.materialForm.get("costPerUnit"))==null?null:U.hasError("min")),o(7),m("ngIf",(R=d.materialForm.get("packageTareWeightPerUom"))==null?null:R.hasError("min")),o(18),m("ngIf",(Q=d.materialForm.get("shelfLifeDays"))==null?null:Q.hasError("required")),o(),m("ngIf",($=d.materialForm.get("shelfLifeDays"))==null?null:$.hasError("min")),o(),C((G=d.materialForm.get("perishable"))!=null&&G.value?-1:110),o(5),m("ngIf",(K=d.materialForm.get("minStockLevel"))==null?null:K.hasError("min")),o(5),m("ngIf",(W=d.materialForm.get("maxStockLevel"))==null?null:W.hasError("min")),o(10),m("ngIf",(z=d.materialForm.get("dimensionsLength"))==null?null:z.hasError("min")),o(5),m("ngIf",(H=d.materialForm.get("dimensionsWidth"))==null?null:H.hasError("min")),o(5),m("ngIf",(Z=d.materialForm.get("dimensionsHeight"))==null?null:Z.hasError("min")),o(11),E(d.barcodeFormats),o(2),m("ngIf",(j=d.materialForm.get("defaultBarcodeFormat"))==null?null:j.hasError("required")),o(),C(d.materialId()&&d.currentMaterialType!=="Normal"?154:-1)}}var nt=class t{fb=v(Fe);route=v(me);router=v(de);adminApi=v(et);http=v(le);snackBar=v(Ze);dialog=v(Je);materialForm;bomForm;materialId=x(null);isEditMode=x(!1);isLoading=x(!0);isSaving=x(!1);isDeleting=x(!1);isSubmittingBom=x(!1);categories=x([]);uoms=x([]);allMaterials=x([]);bom=x(null);materialTypes=["Normal","Kit","Repack"];barcodeFormats=["GS1_128","UPC"];constructor(){this.materialForm=this.fb.group({name:["",s.required],sku:["",s.required],description:[""],categoryId:["",s.required],uomId:["",s.required],requiredTempZone:["FrozenStorage",s.required],baseWeight:[0,[s.required,s.min(0)]],costPerUnit:[0,[s.required,s.min(0)]],materialType:["Normal",s.required],perishable:[!1],shelfLifeDays:[{value:0,disabled:!0},[s.required,s.min(0)]],isHazardous:[!1],gs1BarcodePrefix:[""],isActive:[!0],defaultBarcodeFormat:["GS1_128",s.required],dimensionsLength:[0,[s.required,s.min(0)]],dimensionsWidth:[0,[s.required,s.min(0)]],dimensionsHeight:[0,[s.required,s.min(0)]],minStockLevel:[0,[s.required,s.min(0)]],maxStockLevel:[0,[s.required,s.min(0)]],packageTareWeightPerUom:[0,[s.required,s.min(0)]]}),this.bomForm=this.fb.group({outputQuantity:[1,[s.required,s.min(.001)]],lines:this.fb.array([])}),ae(()=>{let n=this.materialForm.get("perishable")?.value,r=this.materialForm.get("shelfLifeDays");n?r?.enable():(r?.disable(),r?.setValue(0))})}ngOnInit(){this.loadLookups(),this.route.paramMap.pipe(ee(n=>{let r=n.get("id");return r&&r!=="new"?(this.materialId.set(r),this.isEditMode.set(!1),this.materialForm.disable(),this.adminApi.getMaterialById(r)):(this.materialId.set(null),this.isEditMode.set(!0),this.materialForm.enable(),this.materialForm.get("perishable")?.value||this.materialForm.get("shelfLifeDays")?.disable(),this.isLoading.set(!1),this.addBomLine(),Promise.resolve(null))})).subscribe(n=>{n&&(this.materialForm.patchValue(n),this.loadBom(n.id),n.perishable||this.materialForm.get("shelfLifeDays")?.disable()),this.isLoading.set(!1)})}get bomLines(){return this.bomForm.get("lines")}get currentMaterialType(){return this.materialForm.get("materialType")?.value||"Normal"}createBomLine(){return this.fb.group({inputMaterialId:["",s.required],inputQuantity:[1,[s.required,s.min(.001)]]})}addBomLine(){if(this.currentMaterialType==="Repack"&&this.bomLines.length>=1){this.snackBar.open('A "Repack" material can only have one component.',"Close",{duration:3e3});return}this.bomLines.push(this.createBomLine())}removeBomLine(n){this.bomLines.length>1&&this.bomLines.removeAt(n)}loadLookups(){this.http.get(`${q.apiUrl}/Lookups/material-categories`).subscribe(n=>this.categories.set(n)),this.http.get(`${q.apiUrl}/Lookups/uoms`).subscribe(n=>this.uoms.set(n)),this.adminApi.getMaterials().subscribe(n=>this.allMaterials.set(n))}loadBom(n){this.adminApi.getBomForMaterial(n).pipe(X(()=>(this.bom.set(null),this.addBomLine(),Y))).subscribe(r=>{this.bom.set(r),r?(this.bomForm.patchValue({outputQuantity:r.outputQuantity}),this.bomLines.clear(),r.lines.forEach(c=>{this.bomLines.push(this.fb.group({inputMaterialId:[c.inputMaterialId,s.required],inputQuantity:[c.inputQuantity,[s.required,s.min(.001)]]}))})):(this.bomLines.clear(),this.addBomLine())})}toggleEditMode(n){this.isEditMode.set(n),n?(this.materialForm.enable(),this.materialId()&&(this.materialForm.get("sku")?.disable(),this.materialForm.get("materialType")?.disable()),this.materialForm.get("perishable")?.value||this.materialForm.get("shelfLifeDays")?.disable()):this.materialForm.disable()}save(){if(this.materialForm.invalid){this.snackBar.open("Please fill in all required fields.","Close",{duration:3e3}),this.materialForm.markAllAsTouched();return}this.isSaving.set(!0);let n=this.materialForm.getRawValue(),r=n.materialType!=="Normal"&&this.bomLines.length>0&&this.bomForm.valid&&this.bomLines.at(0).get("inputMaterialId")?.value;if(this.materialId()){let c=k({id:this.materialId()},n);this.adminApi.updateMaterial(this.materialId(),c).subscribe({next:()=>{this.handleSaveSuccess("Material updated successfully."),r?this.onBomSubmit():(this.isSaving.set(!1),this.toggleEditMode(!1))},error:l=>this.handleSaveError(l)})}else{let c=k({},n);this.adminApi.createMaterial(c).subscribe({next:l=>{this.handleSaveSuccess("Material created successfully."),this.materialId.set(l),r?this.onBomSubmit():(this.isSaving.set(!1),this.router.navigate(["/admin/materials/detail",l],{replaceUrl:!0}))},error:l=>this.handleSaveError(l)})}}onBomSubmit(){if(this.bomForm.invalid||!this.materialId()){this.snackBar.open("Please fill out all required fields in the recipe.","Close",{duration:3e3}),this.bomForm.markAllAsTouched(),this.isSaving.set(!1);return}let n=this.bomForm.value,r=n.lines.filter(l=>l.inputMaterialId&&l.inputQuantity>0);if(r.length===0){this.snackBar.open("Material saved. No BOM recipe was defined.","OK",{duration:3e3}),this.isSaving.set(!1),this.isEditMode()?this.toggleEditMode(!1):this.router.navigate(["/admin/materials/detail",this.materialId()],{replaceUrl:!0});return}this.isSubmittingBom.set(!0);let c={outputMaterialId:this.materialId(),outputQuantity:n.outputQuantity,lines:r};this.adminApi.createBillOfMaterial(c).subscribe({next:()=>{this.snackBar.open("Recipe saved successfully!","OK",{duration:3e3}),this.loadBom(this.materialId()),this.isSubmittingBom.set(!1),this.isSaving.set(!1),this.isEditMode()?this.toggleEditMode(!1):this.router.navigate(["/admin/materials/detail",this.materialId()],{replaceUrl:!0})},error:l=>{this.snackBar.open(`Error: ${l.error?.title||l.error?.detail||"Failed to save recipe."}`,"Close",{duration:7e3}),this.isSubmittingBom.set(!1),this.isSaving.set(!1)}})}handleSaveSuccess(n){this.router.navigate(["/admin/materials"]),this.snackBar.open(n,"OK",{duration:3e3})}handleSaveError(n){this.isSaving.set(!1),this.snackBar.open(`Error: ${n.error?.title||"Failed to save material."}`,"Close")}delete(){this.dialog.open(Xe,{data:{title:"Delete Material",message:`Are you sure you want to delete "${this.materialForm.value.name}"? This action cannot be undone.`}}).afterClosed().pipe(J(r=>r===!0)).subscribe(()=>{this.isDeleting.set(!0),this.adminApi.deleteMaterial(this.materialId()).subscribe({next:()=>{this.snackBar.open("Material deleted successfully.","OK",{duration:3e3}),this.router.navigate(["/admin/materials"])},error:r=>{this.snackBar.open(`Error: ${r.error?.title||"Failed to delete material."}`,"Close"),this.isDeleting.set(!1)}})})}back(){this.router.navigate(["/admin/materials"])}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=te({type:t,selectors:[["app-material-detail"]],decls:2,vars:1,consts:[[1,"spinner-container"],[1,"detail-container"],["mode","indeterminate"],[1,"detail-header"],[1,"header-main"],["mat-icon-button","","matTooltip","Back to List",3,"click"],[1,"title-group"],[1,"subtitle"],[1,"header-actions"],["mat-flat-button","","color","primary",3,"disabled"],[1,"detail-form",3,"formGroup"],[1,"layout-grid"],[1,"column","left-column"],[1,"detail-card"],[1,"form-grid"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["matInput","","formControlName","sku","required","",3,"readonly"],["align","start"],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["matInput","","formControlName","description","rows","3"],["formControlName","categoryId","required",""],[3,"value"],["formControlName","uomId","required",""],["formControlName","materialType","required","",3,"disabled"],["formControlName","requiredTempZone","required",""],["value","FrozenStorage"],["value","Chilling"],["matInput","","type","number","formControlName","baseWeight","min","0","required",""],["matInput","","type","number","formControlName","costPerUnit","min","0","required",""],["matInput","","type","number","formControlName","packageTareWeightPerUom","min","0"],[1,"column","right-column"],[1,"toggle-group","full-width"],["formControlName","perishable","color","primary"],["formControlName","isHazardous","color","warn"],["formControlName","isActive","color","primary"],["matInput","","type","number","formControlName","shelfLifeDays","min","0"],["matInput","","type","number","formControlName","minStockLevel","min","0"],["matInput","","type","number","formControlName","maxStockLevel","min","0"],["matInput","","type","number","formControlName","dimensionsLength","min","0"],["matInput","","type","number","formControlName","dimensionsWidth","min","0"],["matInput","","type","number","formControlName","dimensionsHeight","min","0"],["matInput","","formControlName","gs1BarcodePrefix"],["formControlName","defaultBarcodeFormat","required",""],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20","mode","indeterminate"],["mat-stroked-button","","color","warn",3,"click","disabled"],["mat-stroked-button","","color","primary",3,"click"],[3,"ngSubmit","formGroup"],[1,"output-section"],["appearance","outline"],["matInput","","type","number","formControlName","outputQuantity","min","0.001","required",""],[2,"margin","1rem 0"],["formArrayName","lines",1,"lines-section"],[1,"lines-header"],["mat-stroked-button","","type","button"],[1,"empty-bom-message"],[1,"bom-line-row",3,"formGroupName"],["align","end",1,"bom-actions"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["mat-stroked-button","","type","button",3,"click"],["appearance","outline",1,"line-material"],["formControlName","inputMaterialId","required",""],["appearance","outline",1,"line-quantity"],["matInput","","type","number","formControlName","inputQuantity","min","0.001","required",""],["mat-icon-button","","color","warn","type","button","matTooltip","Remove Component",1,"remove-button",3,"disabled"],["mat-icon-button","","color","warn","type","button","matTooltip","Remove Component",1,"remove-button",3,"click","disabled"]],template:function(r,c){r&1&&g(0,at,4,0,"div",0)(1,ii,155,28,"div",1),r&2&&C(c.isLoading()?0:1)},dependencies:[oe,re,Ie,Me,Ce,be,xe,he,Te,De,ve,Ee,Se,ye,He,Qe,We,Ge,ze,Ke,$e,qe,we,Pe,Oe,ke,Le,Be,Ae,Ve,Ne,_e,ue,pe,ce,se,Ye,je,it,tt,ge,fe,Re,Ue],styles:['[_nghost-%COMP%]{display:block;height:100%}.spinner-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:1rem;padding:3rem;min-height:300px;color:var(--mat-sys-on-surface-variant)}.detail-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;padding-bottom:1rem;border-bottom:1px solid var(--mat-sys-outline-variant);margin-bottom:.5rem}.header-main[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-grow:1;min-width:0}.title-group[_ngcontent-%COMP%]{min-width:0}.title-group[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.75rem}.title-group[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:var(--mat-sys-on-surface-variant);font-family:monospace}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-shrink:0}.detail-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.layout-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;align-items:start}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.detail-card[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);box-shadow:0 2px 4px #0000000a;border-radius:8px}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:.75rem 1.25rem .5rem;border-bottom:1px solid var(--mat-sys-outline-variant);background-color:var(--mat-sys-surface-container-lowest);display:flex;flex-direction:column}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}.detail-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:1.25rem}.detail-card[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]{border-top:1px solid var(--mat-sys-outline-variant);background-color:var(--mat-sys-surface-container-lowest);border-radius:10px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}.form-grid.four-columns[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.toggle-group[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem;align-items:center;margin-bottom:.5rem}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%] + span[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + mat-icon[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:8px}@media (max-width: 1024px){.layout-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.output-section[_ngcontent-%COMP%]{padding:.5rem 0 1rem}.output-section[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:250px}.lines-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem;margin-top:1rem}.lines-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.lines-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:500;color:var(--mat-sys-on-surface-variant)}.empty-bom-message[_ngcontent-%COMP%]{text-align:center;font-style:italic;color:var(--mat-sys-on-surface-variant);padding:1rem;background-color:var(--mat-sys-surface-container-lowest);border-radius:4px}.bom-line-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(200px,1fr) 130px auto;gap:1rem;align-items:start;padding-bottom:1rem;border-bottom:1px dashed var(--mat-sys-outline-variant)}.bom-line-row[_ngcontent-%COMP%]:last-child{border-bottom:none;padding-bottom:0}.line-material[_ngcontent-%COMP%]{flex-grow:1}.remove-button[_ngcontent-%COMP%]{margin-top:8px}.bom-actions[_ngcontent-%COMP%]{margin-top:1rem}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%] + span[_ngcontent-%COMP%], button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + mat-icon[_ngcontent-%COMP%]{margin-left:8px}button[_ngcontent-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:8px}@media (max-width: 768px){.detail-container[_ngcontent-%COMP%]{padding:1rem}.form-grid.four-columns[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.bom-line-row[_ngcontent-%COMP%]{grid-template-columns:1fr auto;grid-template-areas:"material remove" "quantity remove"}.bom-line-row[_ngcontent-%COMP%]   .line-material[_ngcontent-%COMP%]{grid-area:material}.bom-line-row[_ngcontent-%COMP%]   .line-quantity[_ngcontent-%COMP%]{grid-area:quantity;width:auto}.bom-line-row[_ngcontent-%COMP%]   .remove-button[_ngcontent-%COMP%]{grid-area:remove;align-self:center}}']})};export{nt as MaterialDetailComponent};
