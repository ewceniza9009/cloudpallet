import{a as Pe}from"./chunk-CAC7JEQ5.js";import{a as Ce}from"./chunk-JBTOMD6F.js";import{a as be,b as ye,c as xe}from"./chunk-SVUTEW5N.js";import"./chunk-MS4AQ6UA.js";import{d as ue,i as ge}from"./chunk-JD7VERCS.js";import"./chunk-S7GFW5PD.js";import{b as se,c as de}from"./chunk-7T4FYH4B.js";import{e as ce,f as le,i as me,j as pe}from"./chunk-NRJELJJX.js";import{a as _e,b as Me}from"./chunk-ORD52YGC.js";import"./chunk-LOWV2IZF.js";import"./chunk-JYCF7ZPK.js";import{b as X,d as u,g as Y,h as Z,l as ee,m as te,o as ne,r as ie,s as oe,u as re,w as ae}from"./chunk-33GO6BEM.js";import"./chunk-RZ3EY26M.js";import{l as J}from"./chunk-5JMQ54DL.js";import{p as Q,q as K}from"./chunk-AFJ6IJZO.js";import{a as he,b as ve}from"./chunk-67FWL4YT.js";import"./chunk-W24IOO4C.js";import"./chunk-VD2AZ2LQ.js";import{a as T}from"./chunk-LWYKMW7M.js";import{i as fe}from"./chunk-TFYOF5WW.js";import"./chunk-ZKJQ6NKM.js";import{H as U,I as j}from"./chunk-6GGLSGMC.js";import{B as H,m as z,q as G,t as W}from"./chunk-GEABFLPO.js";import{E as A,G as D,Gc as x,Hc as P,Jb as C,Kb as b,L as R,Nb as I,Ob as w,Pb as m,Qb as n,Rb as i,Sb as y,V as O,W as V,Z as N,Zb as E,cb as r,cc as _,ec as B,ga as h,la as g,ma as f,n as S,oc as M,pb as q,qc as F,r as k,sc as o,tc as s,uc as $,va as v,vc as L}from"./chunk-FZDPWNP7.js";import"./chunk-AP4OEWII.js";var Se=(a,e)=>e.id,we=(a,e)=>e.inventoryId;function Ae(a,e){if(a&1&&(n(0,"mat-option",20),o(1),i()),a&2){let t=e.$implicit;m("value",t),r(),s(t.name)}}function Ee(a,e){if(a&1&&(n(0,"mat-option",20),o(1),i()),a&2){let t=e.$implicit;m("value",t),r(),L("",t.name," (",t.sku,")")}}function Fe(a,e){a&1&&y(0,"mat-spinner",27)}function Te(a,e){a&1&&(n(0,"span"),o(1,"Record Repack"),i())}function De(a,e){a&1&&(n(0,"div",30)(1,"mat-icon"),o(2,"inventory_2"),i(),n(3,"p"),o(4,"Select a Target Material to view available source inventory."),i()())}function Re(a,e){a&1&&y(0,"mat-spinner",34)}function Ve(a,e){if(a&1&&(n(0,"mat-option",36)(1,"div",38)(2,"div",39)(3,"span",40),o(4),i(),n(5,"span",41),o(6),i()(),n(7,"div",42)(8,"span",43),o(9),i(),n(10,"span",44),o(11),i(),n(12,"span",45),o(13),i()()()()),a&2){let t=e.$implicit;m("value",t),r(4),s(t.materialName),r(2),s(t.sku),r(3),s(t.palletBarcode),r(2),s(t.location),r(2),$("Qty: ",t.quantity)}}function Ne(a,e){if(a&1&&(n(0,"div",37)(1,"div",46)(2,"div",47)(3,"mat-icon"),o(4,"check_circle"),i()(),n(5,"div",48)(6,"span",49),o(7,"Selected Source"),i(),n(8,"span",50),o(9,"Inventory to be consumed"),i()()(),n(10,"div",51)(11,"div",52)(12,"div",53)(13,"span",54),o(14,"Material"),i(),n(15,"span",55),o(16),i()(),n(17,"div",53)(18,"span",54),o(19,"Pallet ID"),i(),n(20,"span",56),o(21),i()(),n(22,"div",53)(23,"span",54),o(24,"Location"),i(),n(25,"span",55),o(26),i()(),n(27,"div",53)(28,"span",54),o(29,"Available Qty"),i(),n(30,"span",57),o(31),x(32,"number"),i()()()()()),a&2){let t=e;r(16),s(t.materialName),r(5),s(t.palletBarcode),r(5),s(t.location),r(5),s(P(32,4,t.quantity))}}function qe(a,e){if(a&1){let t=E();n(0,"div",31)(1,"mat-form-field",32)(2,"mat-icon",17),o(3,"search"),i(),n(4,"input",33,4),_("click",function(){g(t);let l=M(5);return f(l.openPanel())}),i(),C(6,Re,1,0,"mat-spinner",34),n(7,"mat-autocomplete",35,5),I(9,Ve,14,6,"mat-option",36,we),x(11,"async"),i()()(),C(12,Ne,33,6,"div",37)}if(a&2){let t,c=M(8),l=B();r(4),m("matAutocomplete",c),r(2),b(l.isLoadingSources()?6:-1),r(),m("displayWith",l.displaySource),r(2),w(P(11,4,l.filteredSourceInventories$)),r(3),b((t=l.selectedSourceInventory)?12:-1,t)}}var ke=class a{fb=h(re);http=h(H);inventoryApi=h(Ce);adminApi=h(Pe);snackBar=h(_e);repackForm;accounts=v([]);allMaterials=v([]);requiredInputMaterialId=v(null);filteredAccounts$;filteredTargetMaterials$;filteredSourceInventories$;isSubmitting=v(!1);isLoadingSources=v(!1);constructor(){this.repackForm=this.fb.group({account:[null,u.required],sourceInventory:[{value:null,disabled:!0},u.required],targetMaterial:[{value:null,disabled:!0},u.required],quantityToProcess:[1,[u.required,u.min(1)]],durationHours:[null,[u.required,u.min(.1)]]})}ngOnInit(){this.loadInitialLookups(),this.setupFilters()}loadInitialLookups(){this.http.get(`${T.apiUrl}/Lookups/accounts`).subscribe(e=>{this.accounts.set(e),this.repackForm.get("account")?.updateValueAndValidity({emitEvent:!0})}),this.http.get(`${T.apiUrl}/Lookups/materials`).subscribe(e=>{this.allMaterials.set(e.filter(t=>t.materialType==="Repack")),this.repackForm.get("targetMaterial")?.updateValueAndValidity({emitEvent:!0})})}setupFilters(){this.filteredAccounts$=this.repackForm.get("account").valueChanges.pipe(O(""),k(e=>this._filterAccounts(e))),this.filteredTargetMaterials$=this.repackForm.get("targetMaterial").valueChanges.pipe(O(""),k(e=>this._filterMaterials(e))),this.filteredSourceInventories$=this.repackForm.get("sourceInventory").valueChanges.pipe(O(""),D(300),R(),V(e=>{let t=this.repackForm.get("account")?.value?.id,c=this.requiredInputMaterialId();if(!t||!c)return S([]);let l=typeof e=="string"?e:"";return this.isLoadingSources.set(!0),this.inventoryApi.getRepackableInventory(t,c,l,1,20).pipe(k(d=>d.items),N(()=>this.isLoadingSources.set(!1)),A(()=>(this.isLoadingSources.set(!1),S([]))))}))}onAccountSelected(e){this.repackForm.get("targetMaterial")?.reset(),this.repackForm.get("sourceInventory")?.reset(),this.repackForm.get("sourceInventory")?.disable(),this.requiredInputMaterialId.set(null),e?.id&&this.repackForm.get("targetMaterial")?.enable()}onTargetMaterialSelected(e){this.repackForm.get("sourceInventory")?.reset(),this.repackForm.get("sourceInventory")?.disable(),this.requiredInputMaterialId.set(null),e?.id&&(this.isLoadingSources.set(!0),this.adminApi.getBomForMaterial(e.id).pipe(A(()=>(this.snackBar.open(`No repackaging recipe found for ${e.name}.`,"Close",{duration:4e3}),S(null)))).subscribe(t=>{if(this.isLoadingSources.set(!1),t&&t.lines.length>0){let c=t.lines[0].inputMaterialId;this.requiredInputMaterialId.set(c),this.repackForm.get("sourceInventory")?.enable(),this.repackForm.get("sourceInventory")?.updateValueAndValidity({emitEvent:!0})}else this.snackBar.open("No stock of the required input material was found for this account.","Close",{duration:4e3})}))}_filterAccounts(e){let t=(typeof e=="string"?e:e?.name||"").toLowerCase();return this.accounts().filter(c=>c.name.toLowerCase().includes(t))}_filterMaterials(e){let t=(typeof e=="string"?e:e?.name||"").toLowerCase();return this.allMaterials().filter(c=>c.name.toLowerCase().includes(t)||c.sku.toLowerCase().includes(t))}displayAccount(e){return e?.name||""}displaySource(e){return e?`${e.materialName} (${e.palletBarcode})`:""}displayMaterial(e){return e?.name||""}get selectedSourceInventory(){let e=this.repackForm.get("sourceInventory")?.value;return e&&typeof e=="object"&&"inventoryId"in e?e:null}onSubmit(){if(this.repackForm.invalid)return;this.isSubmitting.set(!0);let e=this.repackForm.getRawValue();if(!e.sourceInventory||typeof e.sourceInventory=="string"){this.snackBar.open("Invalid source inventory selected.","Close"),this.isSubmitting.set(!1);return}this.inventoryApi.recordRepack(e.sourceInventory.inventoryId,e.targetMaterial.id,e.quantityToProcess,e.durationHours).subscribe({next:()=>{this.snackBar.open("Repackaging transaction recorded successfully!","OK",{duration:4e3}),this.repackForm.reset({quantityToProcess:1}),this.repackForm.get("targetMaterial")?.disable(),this.repackForm.get("sourceInventory")?.disable(),this.isSubmitting.set(!1)},error:t=>{this.snackBar.open(`Error: ${t.error?.title||"Failed to record transaction."}`,"Close"),this.isSubmitting.set(!1)}})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=q({type:a,selectors:[["app-repack"]],decls:63,vars:16,consts:[["triggerAccount","matAutocompleteTrigger"],["autoAccount","matAutocomplete"],["triggerTarget","matAutocompleteTrigger"],["autoTarget","matAutocomplete"],["triggerSource","matAutocompleteTrigger"],["autoSource","matAutocomplete"],[1,"repack-container"],[1,"page-header"],[1,"header-content"],[1,"repack-layout",3,"ngSubmit","formGroup"],[1,"config-panel"],[1,"panel-section"],[1,"section-title"],[1,"card-base","config-card"],[1,"form-group"],[1,"form-label"],["appearance","outline",1,"custom-field"],["matPrefix",""],["type","text","matInput","","formControlName","account","placeholder","Select Account",3,"click","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value"],["type","text","matInput","","formControlName","targetMaterial","placeholder","Search Target SKU",3,"click","matAutocomplete"],[1,"row-group"],["matInput","","type","number","formControlName","quantityToProcess","min","1","placeholder","0"],["matInput","","type","number","formControlName","durationHours","min","0.1","step","0.1","placeholder","0.0"],[1,"form-actions"],["mat-flat-button","","color","primary","type","submit",1,"submit-button",3,"disabled"],["diameter","20"],[1,"source-panel"],[1,"source-selection-area"],[1,"empty-state"],[1,"search-box"],["appearance","outline",1,"custom-field","search"],["type","text","matInput","","formControlName","sourceInventory","placeholder","Search by material or pallet...",3,"click","matAutocomplete"],["matSuffix","","diameter","20"],[3,"displayWith"],[1,"rich-option",3,"value"],[1,"selected-source-card","card-base"],[1,"inventory-option-row"],[1,"main-info"],[1,"mat-name"],[1,"mat-sku"],[1,"meta-info"],[1,"badge","pallet"],[1,"badge","loc"],[1,"badge","qty"],[1,"card-header"],[1,"header-icon"],[1,"header-text"],[1,"title"],[1,"subtitle"],[1,"card-content"],[1,"detail-grid"],[1,"detail-item"],[1,"label"],[1,"value"],[1,"value","mono"],[1,"value","highlight"]],template:function(t,c){if(t&1){let l=E();n(0,"div",6)(1,"header",7)(2,"div",8)(3,"h1"),o(4,"Repackaging Service"),i(),n(5,"p"),o(6,"Inventory Transformation & Processing"),i()()(),n(7,"form",9),_("ngSubmit",function(){return g(l),f(c.onSubmit())}),n(8,"div",10)(9,"div",11)(10,"h3",12),o(11,"Job Configuration"),i(),n(12,"div",13)(13,"div",14)(14,"label",15),o(15,"Customer Account"),i(),n(16,"mat-form-field",16)(17,"mat-icon",17),o(18,"business"),i(),n(19,"input",18,0),_("click",function(){g(l);let p=M(20);return f(p.openPanel())}),i(),n(21,"mat-autocomplete",19,1),_("optionSelected",function(p){return g(l),f(c.onAccountSelected(p.option.value))}),I(23,Ae,2,2,"mat-option",20,Se),x(25,"async"),i()()(),n(26,"div",14)(27,"label",15),o(28,"Target Material (Output)"),i(),n(29,"mat-form-field",16)(30,"mat-icon",17),o(31,"category"),i(),n(32,"input",21,2),_("click",function(){g(l);let p=M(33);return f(p.openPanel())}),i(),n(34,"mat-autocomplete",19,3),_("optionSelected",function(p){return g(l),f(c.onTargetMaterialSelected(p.option.value))}),I(36,Ee,2,3,"mat-option",20,Se),x(38,"async"),i()()(),n(39,"div",22)(40,"div",14)(41,"label",15),o(42,"Quantity (Units)"),i(),n(43,"mat-form-field",16),y(44,"input",23),i()(),n(45,"div",14)(46,"label",15),o(47,"Labor Time (Hours)"),i(),n(48,"mat-form-field",16)(49,"mat-icon",17),o(50,"timer"),i(),y(51,"input",24),i()()(),n(52,"div",25)(53,"button",26),C(54,Fe,1,0,"mat-spinner",27)(55,Te,2,0,"span"),i()()()()(),n(56,"div",28)(57,"div",11)(58,"h3",12),o(59,"Source Inventory"),i(),n(60,"div",29),C(61,De,5,0,"div",30)(62,qe,13,6),i()()()()()}if(t&2){let l,d,p,Oe=M(22),Ie=M(35);r(7),m("formGroup",c.repackForm),r(12),m("matAutocomplete",Oe),r(2),m("displayWith",c.displayAccount),r(2),w(P(25,12,c.filteredAccounts$)),r(3),F("disabled",!((l=c.repackForm.get("account"))!=null&&l.value)),r(6),m("matAutocomplete",Ie),r(2),m("displayWith",c.displayMaterial),r(2),w(P(38,14,c.filteredTargetMaterials$)),r(4),F("disabled",!((d=c.repackForm.get("targetMaterial"))!=null&&d.value)),r(13),m("disabled",c.repackForm.invalid||c.isSubmitting()),r(),b(c.isSubmitting()?54:55),r(7),b((p=c.repackForm.get("targetMaterial"))!=null&&p.value?62:61)}},dependencies:[W,ae,ee,X,te,Y,Z,oe,ne,ie,fe,pe,me,ce,le,de,se,ge,ue,K,Q,j,U,xe,be,ye,ve,he,Me,J,z,G],styles:["[_nghost-%COMP%]{display:block;background-color:#f8fafc;min-height:100vh;font-family:Inter,system-ui,-apple-system,sans-serif}.repack-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2.5rem}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#0f172a;margin:0;letter-spacing:-.02em}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#64748b;font-size:.9rem;margin:0}.repack-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:400px 1fr;gap:2rem;align-items:start}.section-title[_ngcontent-%COMP%]{font-size:.85rem;text-transform:uppercase;letter-spacing:.05em;font-weight:600;color:#64748b;margin-bottom:1rem;padding-left:.25rem}.card-base[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:10px;box-shadow:0 1px 2px #0000000d;overflow:hidden}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:500;color:#0f172a;margin-bottom:.5rem}.form-group.disabled[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.row-group[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.config-panel[_ngcontent-%COMP%]{position:sticky;top:2rem}.config-panel[_ngcontent-%COMP%]   .config-card[_ngcontent-%COMP%]{padding:1.5rem}.config-panel[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{margin-top:2rem}.config-panel[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   .submit-button[_ngcontent-%COMP%]{width:100%;height:44px;font-size:.95rem;font-weight:600;border-radius:8px}.source-selection-area[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.search-box[_ngcontent-%COMP%]{width:100%}.selected-source-card[_ngcontent-%COMP%]{border-color:#0f766e;box-shadow:0 4px 12px #0f766e14}.selected-source-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{background:#f0fdfa;padding:1rem 1.5rem;display:flex;align-items:center;gap:1rem;border-bottom:1px solid rgba(15,118,110,.1)}.selected-source-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-icon[_ngcontent-%COMP%]{color:#0f766e}.selected-source-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.selected-source-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.selected-source-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-text[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;color:#0f766e;font-size:.95rem}.selected-source-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .header-text[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:.8rem;color:#0f766ecc}.selected-source-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{padding:1.5rem}.selected-source-card[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1.5rem}.selected-source-card[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.selected-source-card[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;color:#64748b;font-weight:600}.selected-source-card[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#0f172a}.selected-source-card[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .value.mono[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace}.selected-source-card[_ngcontent-%COMP%]   .detail-grid[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .value.highlight[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#0f766e}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem;background:#fff;border:2px dashed #e2e8f0;border-radius:10px;color:#64748b}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:#cbd5e1;margin-bottom:1rem}  .custom-field{width:100%}  .custom-field .mat-mdc-text-field-wrapper{height:42px!important;padding:0 12px!important;background-color:#fff!important}  .custom-field .mat-mdc-form-field-flex{height:100%!important;align-items:center!important;padding:0!important}  .custom-field .mat-mdc-form-field-infix{padding:0!important;min-height:unset!important;border-top:0!important;width:auto!important}  .custom-field .mat-mdc-input-element{padding:0!important;margin:0!important;top:0!important;position:relative!important;font-size:.9rem!important;line-height:42px!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-prefix{padding:0 8px 0 0!important;display:flex!important;align-items:center!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-prefix .mat-icon{font-size:18px;width:18px;height:18px;color:#64748b}  .custom-field .mat-mdc-form-field-subscript-wrapper{display:none}  .custom-field.search .mat-mdc-text-field-wrapper{height:48px!important}  .custom-field.search .mat-mdc-input-element{font-size:1rem!important;line-height:48px!important}.inventory-option-row[_ngcontent-%COMP%]{padding:8px 0;border-bottom:1px solid #f1f5f9}.inventory-option-row[_ngcontent-%COMP%]   .main-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:4px}.inventory-option-row[_ngcontent-%COMP%]   .main-info[_ngcontent-%COMP%]   .mat-name[_ngcontent-%COMP%]{font-weight:600;color:#0f172a;font-size:.9rem}.inventory-option-row[_ngcontent-%COMP%]   .main-info[_ngcontent-%COMP%]   .mat-sku[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.inventory-option-row[_ngcontent-%COMP%]   .meta-info[_ngcontent-%COMP%]{display:flex;gap:8px}.inventory-option-row[_ngcontent-%COMP%]   .meta-info[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;padding:2px 6px;border-radius:4px;background:#f1f5f9;color:#64748b}.inventory-option-row[_ngcontent-%COMP%]   .meta-info[_ngcontent-%COMP%]   .badge.qty[_ngcontent-%COMP%]{background:#f0fdfa;color:#0f766e;font-weight:600}@media (max-width: 992px){.repack-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.config-panel[_ngcontent-%COMP%]{position:static}}"]})};export{ke as RepackComponent};
