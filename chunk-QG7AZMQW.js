import{a as te}from"./chunk-3CXTO4SV.js";import{a as At,b as Ft,c as Tt,d as Vt,e as Nt,f as Bt,g as Rt,h as Gt,i as Ht,j as zt,l as $t}from"./chunk-SOKAJ55K.js";import{c as Kt,d as Ut,e as Jt,f as Xt,g as Yt,h as Zt}from"./chunk-WGGDG2GO.js";import{a as jt,b as qt,c as Qt}from"./chunk-4MA2X27T.js";import{a as Wt}from"./chunk-D743XRKB.js";import"./chunk-OUNZMEYF.js";import"./chunk-JJ2A35WS.js";import"./chunk-MS4AQ6UA.js";import{d as bt,i as yt}from"./chunk-LDLFMV26.js";import"./chunk-KMQDKAAG.js";import{b as xt,c as Mt}from"./chunk-RFTLLO7Q.js";import{b as _t,f as Ct,i as ht,j as vt}from"./chunk-LJJEMR6T.js";import{e as J,h as X}from"./chunk-QKDH2S6W.js";import{a as Ot,b as kt}from"./chunk-BVME6BF5.js";import"./chunk-4467KL4X.js";import"./chunk-3HUEUM62.js";import"./chunk-2G5JFWHB.js";import{b as lt,d as b,g as mt,h as ct,l as dt,o as st,p as pt,r as ut,u as ft,w as gt}from"./chunk-AMYPGFIW.js";import{e as ot,i as M,j as at,l as rt}from"./chunk-KS7NA3UJ.js";import{m as et,o as it,p as nt}from"./chunk-2LKGOGN5.js";import{a as Et,b as Lt}from"./chunk-NAFMYLXR.js";import{a as Y}from"./chunk-2G4RJFBR.js";import{a as It,b as St,c as wt,f as Dt,i as Pt}from"./chunk-NCMEPRDZ.js";import{G as Z,H as tt}from"./chunk-3GOW57GU.js";import{B as U,h as j,m as q,o as Q,r as W,t as K}from"./chunk-HYNCXMIA.js";import{$ as L,$b as p,Aa as _,Ab as d,Ac as G,Ic as H,Lc as f,Mc as z,Nc as x,Ob as h,Pb as v,Pc as $,Ub as m,Vb as n,Wb as o,Xb as s,_ as E,ac as u,ca as A,cc as T,hb as r,hc as D,jc as P,la as g,nc as V,oc as N,pc as B,qa as S,ra as w,tc as O,ub as F,w as I,xc as a,yc as C,zc as R}from"./chunk-N46UG6V3.js";var ie=t=>["/billing",t];function ne(t,e){if(t&1&&(n(0,"mat-option",24),a(1),o()),t&2){let i=e.$implicit;m("value",i),r(),R(" ",i.name," ")}}function oe(t,e){t&1&&(s(0,"mat-progress-spinner",25),n(1,"span"),a(2,"Generating..."),o())}function ae(t,e){t&1&&(p(0),n(1,"mat-icon"),a(2,"add_circle"),o(),n(3,"span"),a(4,"Generate Invoice"),o(),u())}function re(t,e){t&1&&(n(0,"div",23),s(1,"mat-progress-spinner",26),o())}function le(t,e){t&1&&(n(0,"th",41),a(1,"Invoice #"),o())}function me(t,e){if(t&1&&(n(0,"td",42)(1,"strong"),a(2),o()()),t&2){let i=e.$implicit;r(2),C(i.invoiceNumber)}}function ce(t,e){t&1&&(n(0,"th",41),a(1,"Period"),o())}function de(t,e){if(t&1&&(n(0,"td",42),a(1),f(2,"date"),f(3,"date"),o()),t&2){let i=e.$implicit;r(),G(" ",x(2,2,i.periodStart,"MMM d, y")," - ",x(3,5,i.periodEnd,"MMM d, y")," ")}}function se(t,e){t&1&&(n(0,"th",41),a(1,"Due Date"),o())}function pe(t,e){if(t&1&&(n(0,"td",42),a(1),f(2,"date"),o()),t&2){let i=e.$implicit;r(),C(x(2,1,i.dueDate,"MMM d, y"))}}function ue(t,e){t&1&&(n(0,"th",43),a(1,"Total"),o())}function fe(t,e){if(t&1&&(n(0,"td",44),a(1),f(2,"currency"),o()),t&2){let i=e.$implicit;r(),C($(2,1,i.totalAmount,"PHP","symbol","1.2-2"))}}function ge(t,e){t&1&&(n(0,"th",41),a(1,"Status"),o())}function _e(t,e){if(t&1&&(n(0,"td",42)(1,"span",45),a(2),o()()),t&2){let i=e.$implicit;r(),m("ngClass",i.status.toLowerCase()),r(),C(i.status)}}function Ce(t,e){t&1&&s(0,"th",41)}function he(t,e){if(t&1&&(n(0,"td",44)(1,"a",46)(2,"mat-icon"),a(3,"visibility"),o()()()),t&2){let i=e.$implicit;r(),m("routerLink",H(1,ie,i.id))}}function ve(t,e){t&1&&s(0,"tr",47)}function xe(t,e){t&1&&s(0,"tr",48)}function Me(t,e){if(t&1&&(n(0,"table",27),p(1,29),d(2,le,2,0,"th",30)(3,me,3,1,"td",31),u(),p(4,32),d(5,ce,2,0,"th",30)(6,de,4,8,"td",31),u(),p(7,33),d(8,se,2,0,"th",30)(9,pe,3,4,"td",31),u(),p(10,34),d(11,ue,2,0,"th",35)(12,fe,3,6,"td",36),u(),p(13,37),d(14,ge,2,0,"th",30)(15,_e,3,2,"td",31),u(),p(16,38),d(17,Ce,1,0,"th",30)(18,he,4,3,"td",36),u(),d(19,ve,1,0,"tr",39)(20,xe,1,0,"tr",40),o()),t&2){let i=P(2);m("dataSource",i.invoices()),r(19),m("matHeaderRowDef",i.displayedColumns),r(),m("matRowDefColumns",i.displayedColumns)}}function be(t,e){t&1&&(n(0,"div",28)(1,"mat-icon"),a(2,"receipt_long"),o(),n(3,"h3"),a(4,"No Invoices Found"),o(),n(5,"p"),a(6,"Select an account to view its invoice history or generate a new one."),o()())}function ye(t,e){if(t&1&&h(0,Me,21,3,"table",27)(1,be,7,0,"div",28),t&2){let i=P();v(i.invoices().length>0?0:1)}}var ee=class t{virtualScrollViewport;fb=g(ft);http=g(U);billingApi=g(te);snackBar=g(Ot);accounts=_([]);filteredAccounts;invoices=_([]);isLoading=_(!1);isGenerating=_(!1);billingForm=this.fb.group({accountId:[null,b.required],period:this.fb.group({start:[new Date(2025,9,1),b.required],end:[new Date(2025,9,31),b.required]})});displayedColumns=["invoiceNumber","period","dueDate","totalAmount","status","actions"];ngOnInit(){this.http.get(`${Y.apiUrl}/Lookups/accounts`).subscribe(e=>{this.accounts.set(e),this.filteredAccounts=this.billingForm.get("accountId").valueChanges.pipe(E(""),I(i=>(typeof i=="string"?i:i?.name)||""),I(i=>i?this._filter(i):this.accounts().slice()))}),this.billingForm.get("accountId")?.valueChanges.pipe(A(()=>{let e=this.billingForm.get("accountId")?.value;e&&typeof e!="string"&&this.isLoading.set(!0)}),L(e=>e&&typeof e!="string"?this.billingApi.getInvoices(e.id):[])).subscribe(e=>{this.invoices.set(e),this.isLoading.set(!1)})}_filter(e){let i=e.toLowerCase();return this.accounts().filter(l=>l.name.toLowerCase().includes(i))}displayFn(e){return e&&e.name?e.name:""}generateInvoice(){if(this.billingForm.invalid){this.snackBar.open("Please select an account and a valid date range.","Close");return}let e=this.billingForm.get("accountId")?.value;if(!e||typeof e=="string"){this.snackBar.open("Please select a valid account from the list.","Close");return}this.isGenerating.set(!0);let i=this.billingForm.getRawValue(),l={accountId:e.id,periodStart:i.period.start.toISOString(),periodEnd:i.period.end.toISOString()};this.billingApi.generateInvoice(l).subscribe({next:c=>{this.snackBar.open("Successfully generated new invoice!","OK",{duration:5e3}),this.refreshInvoices(),this.isGenerating.set(!1)},error:c=>{this.snackBar.open("Invoice generation failed.","Close"),this.isGenerating.set(!1)}})}refreshInvoices(){let e=this.billingForm.get("accountId")?.value;if(e&&typeof e!="string"){let i=e.id;this.isLoading.set(!0),this.billingApi.getInvoices(i).subscribe(l=>{this.invoices.set(l),this.isLoading.set(!1)})}}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=F({type:t,selectors:[["app-invoice-list"]],viewQuery:function(i,l){if(i&1&&V(M,5),i&2){let c;N(c=B())&&(l.virtualScrollViewport=c.first)}},decls:43,vars:12,consts:[["auto","matAutocomplete"],["picker",""],[1,"billing-container"],[1,"header-section"],[1,"mat-headline-6"],[1,"mat-body-1"],[1,"filter-grid",3,"formGroup"],["appearance","outline",1,"custom-field"],["type","text","placeholder","Select Account","matInput","","formControlName","accountId",3,"matAutocomplete"],[3,"displayWith"],["itemSize","48","minBufferPx","200","maxBufferPx","400",1,"autocomplete-viewport"],[3,"value",4,"cdkVirtualFor","cdkVirtualForOf"],["formGroupName","period",1,"filter-grid",2,"gap","1rem","margin","0","padding","0"],["appearance","outline",1,"custom-field","date-field"],[3,"rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matSuffix","",3,"for"],[1,"filter-actions"],["mat-stroked-button","","color","primary","type","button",3,"click","disabled"],["mat-flat-button","","color","primary","type","button",3,"click","disabled"],[1,"invoice-list-card"],[2,"padding","0"],[1,"spinner-container"],[3,"value"],["diameter","20","mode","indeterminate"],["mode","indeterminate"],["mat-table","",3,"dataSource"],[1,"empty-message"],["matColumnDef","invoiceNumber"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","period"],["matColumnDef","dueDate"],["matColumnDef","totalAmount"],["mat-header-cell","","class","align-right",4,"matHeaderCellDef"],["mat-cell","","class","align-right",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"align-right"],["mat-cell","",1,"align-right"],[1,"status-badge",3,"ngClass"],["mat-icon-button","","color","primary","title","View Details",3,"routerLink"],["mat-header-row",""],["mat-row",""]],template:function(i,l){if(i&1){let c=T();n(0,"div",2)(1,"div",3)(2,"div")(3,"h1",4),a(4,"Run Billing Cycle"),o(),n(5,"p",5),a(6,"Generate new invoices or view history for a customer account."),o()()(),n(7,"form",6)(8,"mat-form-field",7)(9,"mat-label"),a(10,"Customer Account"),o(),s(11,"input",8),n(12,"mat-autocomplete",9,0)(14,"cdk-virtual-scroll-viewport",10),d(15,ne,2,2,"mat-option",11),f(16,"async"),o()()(),n(17,"div",12)(18,"mat-form-field",13)(19,"mat-label"),a(20,"Billing Period"),o(),n(21,"mat-date-range-input",14),s(22,"input",15)(23,"input",16),o(),s(24,"mat-datepicker-toggle",17)(25,"mat-date-range-picker",null,1),o()(),n(27,"div",18)(28,"button",19),D("click",function(){return S(c),w(l.refreshInvoices())}),n(29,"mat-icon"),a(30,"refresh"),o(),n(31,"span"),a(32,"Refresh"),o()(),n(33,"button",20),D("click",function(){return S(c),w(l.generateInvoice())}),h(34,oe,3,0)(35,ae,5,0,"ng-container"),o()()(),n(36,"mat-card",21)(37,"mat-card-header")(38,"mat-card-title"),a(39,"Invoice History"),o()(),n(40,"mat-card-content",22),h(41,re,2,0,"div",23)(42,ye,2,1),o()()()}if(i&2){let c,y=O(13),k=O(26);r(7),m("formGroup",l.billingForm),r(4),m("matAutocomplete",y),r(),m("displayWith",l.displayFn),r(3),m("cdkVirtualForOf",z(16,10,l.filteredAccounts)),r(6),m("rangePicker",k),r(3),m("for",k),r(4),m("disabled",!((c=l.billingForm.get("accountId"))!=null&&c.value)),r(5),m("disabled",l.billingForm.invalid||l.isGenerating()),r(),v(l.isGenerating()?34:35),r(7),v(l.isLoading()?41:42)}},dependencies:[K,j,gt,dt,lt,mt,ct,st,ut,pt,X,J,Pt,It,wt,Dt,St,nt,it,et,kt,vt,ht,_t,Ct,Mt,xt,yt,bt,Zt,Kt,Ut,Jt,Xt,Yt,Wt,$t,At,Tt,Rt,Vt,Ft,Gt,Nt,Bt,Ht,zt,Lt,Et,tt,Z,Qt,jt,qt,rt,ot,at,M,q,W,Q],styles:["[_nghost-%COMP%]{display:block}.billing-container[_ngcontent-%COMP%]{padding:1.5rem 2.5rem;max-width:1600px;margin:0 auto;display:grid;gap:2rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:1rem;border-bottom:1px solid var(--mat-sys-outline-variant)}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:1.75rem}.header-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant);margin-top:4px}.filter-grid[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}.filter-grid[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{width:300px;margin-bottom:-1.25em}.filter-grid[_ngcontent-%COMP%]   .custom-field.date-field[_ngcontent-%COMP%]{width:240px}.filter-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-left:auto;margin-bottom:-1.25em}.filter-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:42px}.invoice-list-card[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-outline-variant);box-shadow:0 4px 6px -1px #0000000d,0 2px 4px -2px #0000000d;border-radius:8px;padding:0;overflow:hidden;background:var(--mat-sys-surface)}table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td.mat-cell[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{padding:0 1rem;border-bottom-color:var(--mat-sys-outline-variant)}table[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.5px;color:var(--mat-sys-on-surface-variant);height:48px;background-color:var(--mat-sys-surface-container-lowest)}table[_ngcontent-%COMP%]   td.mat-cell[_ngcontent-%COMP%]{font-size:.875rem;height:48px;color:var(--mat-sys-on-surface)}tr.mat-row[_ngcontent-%COMP%]:hover{background-color:var(--mat-sys-surface-container-high)}.align-right[_ngcontent-%COMP%]{text-align:right}.status-badge[_ngcontent-%COMP%]{display:inline-flex;padding:4px 12px;border-radius:16px;font-size:.75rem;font-weight:600;text-transform:uppercase}.status-badge.draft[_ngcontent-%COMP%]{background-color:#f1f5f9;color:#475569}.status-badge.pending[_ngcontent-%COMP%]{background-color:#fff7ed;color:#c2410c}.status-badge.paid[_ngcontent-%COMP%]{background-color:#dcfce7;color:#16a34a}.status-badge.overdue[_ngcontent-%COMP%]{background-color:#fef2f2;color:#dc2626}.status-badge.cancelled[_ngcontent-%COMP%]{background-color:#f1f5f9;color:#94a3b8;text-decoration:line-through}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:4rem}.empty-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:48px 24px;text-align:center;color:var(--mat-sys-on-surface-variant);gap:1rem}.empty-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:var(--mat-sys-outline)}.empty-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:500;margin:0;color:var(--mat-sys-on-surface)}  .custom-field{width:100%}  .custom-field .mat-mdc-text-field-wrapper{height:42px!important;padding:0 12px!important;background-color:#fff!important}  .custom-field .mat-mdc-form-field-flex{height:100%!important;align-items:center!important;padding:0!important}  .custom-field .mat-mdc-form-field-infix{padding:0!important;min-height:unset!important;border-top:0!important;width:auto!important}  .custom-field .mat-mdc-input-element{padding:0!important;margin:0!important;top:0!important;position:relative!important;font-size:.9rem!important;line-height:42px!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-prefix{padding:0 8px 0 0!important;display:flex!important;align-items:center!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-prefix .mat-icon{font-size:18px;width:18px;height:18px}  .custom-field .mat-mdc-form-field-icon-suffix{padding:0 0 0 8px!important;display:flex!important;align-items:center!important;height:100%!important}  .custom-field .mat-mdc-form-field-icon-suffix .mat-icon{font-size:18px;width:18px;height:18px}  .custom-field .mat-mdc-form-field-icon-suffix .mat-datepicker-toggle-default-icon{width:18px;height:18px}  .custom-field .mat-mdc-form-field-icon-suffix button.mat-icon-button{width:24px;height:24px;line-height:24px;padding:0}  .custom-field .mat-mdc-form-field-subscript-wrapper{display:none}  .custom-field .mdc-line-ripple{display:none}.autocomplete-viewport[_ngcontent-%COMP%]{height:200px;width:100%}"]})};export{ee as InvoiceListComponent};
